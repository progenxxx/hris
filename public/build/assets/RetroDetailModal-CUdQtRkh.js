import{r as d,j as e}from"./app-D-TNKEQL.js";import L from"./RetroStatusBadge-DrELLyOl.js";import{D as w}from"./dollar-sign-Boh72rKp.js";import{X as U}from"./x-fQrOvEob.js";import{U as I}from"./user-DhodrGY1.js";import{C as E}from"./calendar-DhTYrr3L.js";import{C as F}from"./clock-D8g538AG.js";import{C as x}from"./circle-check-big-BKozuvyq.js";import{F as T}from"./file-text-QjoOwKBJ.js";import{C as H}from"./circle-x-Ty60vMKt.js";import"./createLucideIcon-DEWnkTLV.js";const W=({retro:s,onClose:o,onStatusUpdate:_,userRoles:n={}})=>{var j,f,N,y,b,v;const[t,i]=d.useState("approved"),[c,A]=d.useState(""),[l,u]=d.useState(!1),p=()=>{var a,r;return s.status!=="pending"?!1:!!(n.isSuperAdmin||n.isHrdManager||n.isDepartmentManager&&((r=n.managedDepartments)!=null&&r.includes((a=s.employee)==null?void 0:a.Department)))},D=()=>{if(l)return;if(t==="rejected"&&!c.trim()){alert("Please provide remarks for rejection");return}u(!0);const a={status:t,remarks:c};_(s.id,a),u(!1)},k=a=>{try{return new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid date"}},h=a=>{try{return new Date(a).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Invalid date"}},m=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"PHP"}).format(a||0),C=a=>a?`${a.Lname||""}, ${a.Fname||""}`.trim():"Unknown Employee",S=a=>({DAYS:"Regular Days",OVERTIME:"Overtime Hours",SLVL:"Sick/Vacation Leave",HOLIDAY:"Holiday Work",RD_OT:"Rest Day Overtime"})[a]||(a==null?void 0:a.charAt(0).toUpperCase())+(a==null?void 0:a.slice(1)),R=a=>({increase:"Increase",decrease:"Decrease",correction:"Correction",backdated:"Backdated Adjustment"})[a]||(a==null?void 0:a.charAt(0).toUpperCase())+(a==null?void 0:a.slice(1)),g=a=>({DAYS:"Days",OVERTIME:"Hours",SLVL:"Days",HOLIDAY:"Hours",RD_OT:"Hours"})[a]||"Units";return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg leading-6 font-medium text-gray-900 flex items-center",children:[e.jsx(w,{className:"h-6 w-6 mr-2 text-indigo-600"}),"Retro Request Details"]}),e.jsx("button",{onClick:o,className:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:e.jsx(U,{className:"h-6 w-6"})})]})}),e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(I,{className:"h-5 w-5 mr-2 text-gray-600"}),"Employee Information"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Name:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:C(s.employee)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Employee ID:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:((j=s.employee)==null?void 0:j.idno)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Department:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:((f=s.employee)==null?void 0:f.Department)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Position:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:((N=s.employee)==null?void 0:N.Jobtitle)||"N/A"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(E,{className:"h-5 w-5 mr-2 text-gray-600"}),"Retro Information"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Type:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:S(s.retro_type)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Adjustment:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:R(s.adjustment_type)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Retro Date:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:k(s.retro_date)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Status:"}),e.jsx("span",{className:"ml-2",children:e.jsx(L,{status:s.status})})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(F,{className:"h-5 w-5 mr-2 text-gray-600"}),"Time & Rate Details"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[g(s.retro_type),":"]}),e.jsxs("span",{className:"ml-2 text-sm text-gray-900",children:[s.hours_days||"N/A"," ",(y=g(s.retro_type))==null?void 0:y.toLowerCase()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Multiplier Rate:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:s.multiplier_rate?`${s.multiplier_rate}x`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Base Rate:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:s.base_rate?m(s.base_rate):"N/A"})]}),s.hours_days&&s.multiplier_rate&&s.base_rate&&e.jsxs("div",{className:"mt-3 p-2 bg-blue-50 rounded border",children:[e.jsx("div",{className:"text-xs text-blue-600 mb-1",children:"Calculation:"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[s.hours_days," × ",s.multiplier_rate," × ",m(s.base_rate)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(w,{className:"h-5 w-5 mr-2 text-gray-600"}),"Financial Details"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Computed Amount:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900 font-semibold",children:m(s.computed_amount||s.requested_total_amount)})]}),s.original_total_amount!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Original Amount:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:m(s.original_total_amount)})]}),s.requested_total_amount!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Requested Amount:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:m(s.requested_total_amount)})]})]})]}),e.jsxs("div",{className:"md:col-span-2 bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(x,{className:"h-5 w-5 mr-2 text-gray-600"}),"Approval Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Created By:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:((b=s.creator)==null?void 0:b.name)||"System"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Created At:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:h(s.created_at)})]})]}),s.approved_by&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Approved By:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:((v=s.approver)==null?void 0:v.name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Approved At:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:h(s.approved_at)})]})]})]})]}),e.jsxs("div",{className:"md:col-span-2 bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(T,{className:"h-5 w-5 mr-2 text-gray-600"}),"Reason for Adjustment"]}),e.jsx("p",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:s.reason||"No reason provided"})]}),s.remarks&&e.jsxs("div",{className:"md:col-span-2 bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Remarks"}),e.jsx("p",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:s.remarks})]}),p()&&e.jsxs("div",{className:"md:col-span-2 bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-3",children:"Update Status"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-700 mb-1",children:"Action"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-green-600",name:"status",value:"approved",checked:t==="approved",onChange:()=>i("approved")}),e.jsx("span",{className:"ml-2 text-green-700",children:"Approve"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-red-600",name:"status",value:"rejected",checked:t==="rejected",onChange:()=>i("rejected")}),e.jsx("span",{className:"ml-2 text-red-700",children:"Reject"})]}),n.isSuperAdmin&&e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-purple-600",name:"status",value:"force_approved",checked:t==="force_approved",onChange:()=>i("force_approved")}),e.jsx("span",{className:"ml-2 text-purple-700",children:"Force Approve"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-blue-700 mb-1",children:["Remarks ",t==="rejected"&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",rows:3,value:c,onChange:a=>A(a.target.value),placeholder:"Enter remarks for this decision"})]})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[p()&&e.jsx("button",{type:"button",className:`w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 ${t==="rejected"?"bg-red-600 hover:bg-red-700 focus:ring-red-500":t==="force_approved"?"bg-purple-600 hover:bg-purple-700 focus:ring-purple-500":"bg-green-600 hover:bg-green-700 focus:ring-green-500"} text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm`,onClick:D,disabled:l,children:l?"Processing...":e.jsx(e.Fragment,{children:t==="rejected"?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-1"})," Reject"]}):t==="force_approved"?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"h-4 w-4 mr-1"})," Force Approve"]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"h-4 w-4 mr-1"})," Approve"]})})}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:o,disabled:l,children:"Close"})]})]})]})})};export{W as default};
