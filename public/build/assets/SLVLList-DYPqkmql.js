import{r as i,j as t}from"./app-C_ClQmDY.js";import ne from"./SLVLStatusBadge-BHge3ilW.js";import oe from"./SLVLDetailModal-aPYHkfyM.js";import ie from"./MultiBulkActionModal-J63Uwl4j.js";import{D as ce}from"./download-BQI3-SNa.js";import{S as le}from"./search-BDKFcNkb.js";import{X as de}from"./x-Q1lJB2Tb.js";import{f as me}from"./format-Ur_Fko9Q.js";import"./createLucideIcon-D1ADp28Z.js";const Ne=({leaves:y,onStatusUpdate:j,onDelete:$,refreshInterval:L=5e3})=>{const[k,C]=i.useState(null),[q,_]=i.useState(!1),[l,A]=i.useState(""),[d,E]=i.useState(""),[N,H]=i.useState(y||[]),[w,D]=i.useState(y||[]),h=i.useRef(null),[m,F]=i.useState(""),[n,M]=i.useState({from:"",to:""}),[f,v]=i.useState([]),[W,P]=i.useState(!1),[S,R]=i.useState(!1);i.useEffect(()=>{D(y||[]),p(y||[],l,d,m,n)},[y]),i.useEffect(()=>{const e=async()=>{try{if(typeof window.refreshLeaves=="function"){const s=await window.refreshLeaves();D(s),p(s,l,d,m,n)}}catch(s){console.error("Error refreshing leave data:",s)}};return h.current=setInterval(e,L),()=>{h.current&&clearInterval(h.current)}},[L,l,d,m,n]);const p=(e,s,u,x,c)=>{let o=[...e];if(s&&(o=o.filter(r=>r.status===s)),u&&(o=o.filter(r=>r.type===u)),x){const r=x.toLowerCase();o=o.filter(a=>a.employee&&(a.employee.Fname&&a.employee.Fname.toLowerCase().includes(r)||a.employee.Lname&&a.employee.Lname.toLowerCase().includes(r))||a.employee&&a.employee.idno&&a.employee.idno.toString().includes(r)||a.employee&&a.employee.Department&&a.employee.Department.toLowerCase().includes(r)||a.reason&&a.reason.toLowerCase().includes(r))}c.from&&c.to?o=o.filter(r=>{if(!r.start_date)return!1;const a=new Date(r.start_date),g=new Date(c.from),V=new Date(c.to);return V.setHours(23,59,59),a>=g&&a<=V}):c.from?o=o.filter(r=>{if(!r.start_date)return!1;const a=new Date(r.start_date),g=new Date(c.from);return a>=g}):c.to&&(o=o.filter(r=>{if(!r.start_date)return!1;const a=new Date(r.start_date),g=new Date(c.to);return g.setHours(23,59,59),a<=g})),H(o)},z=e=>{const s=e.target.value;A(s),p(w,s,d,m,n)},O=e=>{const s=e.target.value;E(s),p(w,l,s,m,n)},X=e=>{const s=e.target.value;F(s),p(w,l,d,s,n)},T=(e,s)=>{const u={...n,[e]:s};M(u),p(w,l,d,m,u)},G=()=>{A(""),E(""),F(""),M({from:"",to:""}),p(w,"","","",{from:"",to:""})},B=e=>{try{return me(new Date(e),"yyyy-MM-dd")}catch(s){return console.error("Error formatting date:",s),"Invalid date"}},J=e=>{switch(e){case"sick":return"Sick Leave";case"vacation":return"Vacation Leave";case"emergency":return"Emergency Leave";case"bereavement":return"Bereavement Leave";case"maternity":return"Maternity Leave";case"paternity":return"Paternity Leave";default:return e?e.charAt(0).toUpperCase()+e.slice(1)+" Leave":"N/A"}},K=e=>{if(!e.start_date||!e.end_date)return"N/A";try{const s=new Date(e.start_date),u=new Date(e.end_date),x=Math.abs(u-s),c=Math.ceil(x/(1e3*60*60*24))+1;return e.half_day?(c-.5).toFixed(1):c.toString()}catch(s){return console.error("Error calculating leave days:",s),"N/A"}},Q=e=>{h.current&&clearInterval(h.current),C(e),_(!0)},I=()=>{_(!1),C(null);const e=async()=>{try{if(typeof window.refreshLeaves=="function"){const s=await window.refreshLeaves();D(s),p(s,l,d,m,n)}}catch(s){console.error("Error refreshing leave data:",s)}};h.current=setInterval(e,L)},Y=(e,s)=>{typeof j=="function"?j(e,s):(console.error("onStatusUpdate prop is not a function"),alert("Error: Unable to update status. Please refresh the page and try again.")),I()},Z=e=>{confirm("Are you sure you want to delete this leave request?")&&$(e)},ee=()=>{if(R(!S),S)v([]);else{const e=N.filter(s=>s.status==="pending").map(s=>s.id);v(e)}},te=e=>{v(s=>s.includes(e)?s.filter(u=>u!==e):[...s,e])},se=()=>{if(f.length===0){alert("Please select at least one leave request");return}P(!0)},U=()=>{P(!1)},re=(e,s)=>{if(typeof j=="function"){const u=f.map(x=>new Promise((c,o)=>{try{j(x,{status:e,remarks:s}),c()}catch(r){o(r)}}));Promise.all(u).then(()=>{v([]),R(!1)}).catch(x=>{console.error("Error during bulk update:",x)})}U()},ae=()=>{const e=new URLSearchParams;l&&e.append("status",l),d&&e.append("type",d),m&&e.append("search",m),n.from&&e.append("from_date",n.from),n.to&&e.append("to_date",n.to);const s=`/slvl/export?${e.toString()}`;window.open(s,"_blank")},b=N.filter(e=>e.status==="pending").length;return t.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden flex flex-col h-[62vh]",children:[t.jsxs("div",{className:"p-4 border-b",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Leave Requests"}),t.jsxs("div",{className:"flex flex-wrap gap-2 w-full md:w-auto",children:[t.jsxs("button",{onClick:ae,className:"px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center",title:"Export to Excel",children:[t.jsx(ce,{className:"h-4 w-4 mr-1"}),"Export"]}),f.length>0&&t.jsxs("button",{onClick:se,className:"px-3 py-1 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:["Bulk Action (",f.length,")"]}),t.jsx("div",{className:"flex items-center",children:t.jsxs("select",{id:"statusFilter",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:l,onChange:z,children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"approved",children:"Approved"}),t.jsx("option",{value:"rejected",children:"Rejected"})]})}),t.jsx("div",{className:"flex items-center",children:t.jsxs("select",{id:"typeFilter",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:d,onChange:O,children:[t.jsx("option",{value:"",children:"All Types"}),t.jsx("option",{value:"sick",children:"Sick Leave"}),t.jsx("option",{value:"vacation",children:"Vacation Leave"}),t.jsx("option",{value:"emergency",children:"Emergency Leave"}),t.jsx("option",{value:"bereavement",children:"Bereavement Leave"}),t.jsx("option",{value:"maternity",children:"Maternity Leave"}),t.jsx("option",{value:"paternity",children:"Paternity Leave"})]})})]})]}),t.jsxs("div",{className:"mt-4 flex flex-col md:flex-row gap-3",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(le,{className:"h-4 w-4 text-gray-400"})}),t.jsx("input",{type:"text",placeholder:"Search by name, ID, department, or reason",className:"pl-10 w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:m,onChange:X})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"fromDate",className:"mr-2 text-sm font-medium text-gray-700",children:"From:"}),t.jsx("input",{id:"fromDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:n.from,onChange:e=>T("from",e.target.value)})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"toDate",className:"mr-2 text-sm font-medium text-gray-700",children:"To:"}),t.jsx("input",{id:"toDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:n.to,onChange:e=>T("to",e.target.value)})]}),(l||d||m||n.from||n.to)&&t.jsxs("button",{onClick:G,className:"px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md text-sm flex items-center",title:"Clear all filters",children:[t.jsx(de,{className:"h-4 w-4 mr-1"}),"Clear"]})]})]})]}),t.jsx("div",{className:"overflow-auto flex-grow",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:t.jsxs("tr",{children:[b>0&&t.jsx("th",{scope:"col",className:"px-4 py-3 w-10",children:t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:S&&f.length===b,onChange:ee})}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Leave Type"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date Range"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Days"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pay"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:b>0?"8":"7",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No leave records found"})}):N.map(e=>{var s;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[b>0&&t.jsx("td",{className:"px-4 py-4",children:e.status==="pending"&&t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:f.includes(e.id),onChange:()=>te(e.id)})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.employee?`${e.employee.Lname}, ${e.employee.Fname}`:"Unknown employee"}),t.jsx("div",{className:"text-sm text-gray-500",children:((s=e.employee)==null?void 0:s.idno)||"N/A"})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:J(e.type)}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm text-gray-900",children:e.start_date&&e.end_date?`${B(e.start_date)} - ${B(e.end_date)}`:"N/A"}),e.half_day&&t.jsxs("div",{className:"text-sm text-gray-500",children:[e.am_pm.toUpperCase()," Half-Day"]})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:K(e)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.with_pay?"With Pay":"Without Pay"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx(ne,{status:e.status})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[t.jsx("button",{onClick:()=>Q(e),className:"text-indigo-600 hover:text-indigo-900 mr-3",children:"View"}),e.status==="pending"&&t.jsx("button",{onClick:()=>Z(e.id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id)})})]})}),q&&k&&t.jsx(oe,{leave:k,onClose:I,onStatusUpdate:Y}),W&&t.jsx(ie,{selectedCount:f.length,onClose:U,onSubmit:re})]})};export{Ne as default};
