import{r as i,j as t}from"./app-C_ClQmDY.js";import se from"./StatusBadge-Bvd18zn6.js";import ae from"./TravelOrderDetailModal-BVDo1oL7.js";import re from"./MultiBulkActionModal-BJEyYUOT.js";import{D as oe}from"./download-BQI3-SNa.js";import{S as ne}from"./search-BDKFcNkb.js";import{X as le}from"./x-Q1lJB2Tb.js";import{f as ce}from"./format-Ur_Fko9Q.js";import{p as S}from"./parseISO-y7BAppcC.js";import{d as ie}from"./differenceInDays-Dw6PLei1.js";import{a as de}from"./addDays-Bd4xD-lv.js";import"./createLucideIcon-D1ADp28Z.js";const De=({travelOrders:h,onStatusUpdate:g,onDelete:U,refreshInterval:b=5e3})=>{const[C,k]=i.useState(null),[$,T]=i.useState(!1),[d,_]=i.useState(""),[y,V]=i.useState(h||[]),[w,D]=i.useState(h||[]),x=i.useRef(null),[m,A]=i.useState(""),[n,E]=i.useState({from:"",to:""}),[p,j]=i.useState([]),[q,L]=i.useState(!1),[v,F]=i.useState(!1);i.useEffect(()=>{D(h||[]),u(h||[],d,m,n)},[h]),i.useEffect(()=>{const e=async()=>{try{if(typeof window.refreshTravelOrders=="function"){const s=await window.refreshTravelOrders();D(s),u(s,d,m,n)}}catch(s){console.error("Error refreshing travel order data:",s)}};return x.current=setInterval(e,b),()=>{x.current&&clearInterval(x.current)}},[b,d,m,n]);const u=(e,s,c,l)=>{let o=[...e];if(s&&(o=o.filter(r=>r.status===s)),c){const r=c.toLowerCase();o=o.filter(a=>a.employee&&(a.employee.Fname&&a.employee.Fname.toLowerCase().includes(r)||a.employee.Lname&&a.employee.Lname.toLowerCase().includes(r))||a.employee&&a.employee.idno&&a.employee.idno.toString().includes(r)||a.employee&&a.employee.Department&&a.employee.Department.toLowerCase().includes(r)||a.destination&&a.destination.toLowerCase().includes(r)||a.purpose&&a.purpose.toLowerCase().includes(r))}l.from&&l.to?o=o.filter(r=>{if(!r.start_date)return!1;const a=new Date(r.start_date),f=new Date(l.from),B=new Date(l.to);return B.setHours(23,59,59),a>=f&&a<=B}):l.from?o=o.filter(r=>{if(!r.start_date)return!1;const a=new Date(r.start_date),f=new Date(l.from);return a>=f}):l.to&&(o=o.filter(r=>{if(!r.start_date)return!1;const a=new Date(r.start_date),f=new Date(l.to);return f.setHours(23,59,59),a<=f})),V(o)},H=e=>{const s=e.target.value;_(s),u(w,s,m,n)},z=e=>{const s=e.target.value;A(s),u(w,d,s,n)},M=(e,s)=>{const c={...n,[e]:s};E(c),u(w,d,m,c)},X=()=>{_(""),A(""),E({from:"",to:""}),u(w,"","",{from:"",to:""})},G=e=>{x.current&&clearInterval(x.current),k(e),T(!0)},P=()=>{T(!1),k(null);const e=async()=>{try{if(typeof window.refreshTravelOrders=="function"){const s=await window.refreshTravelOrders();D(s),u(s,d,m,n)}}catch(s){console.error("Error refreshing travel order data:",s)}};x.current=setInterval(e,b)},J=(e,s)=>{typeof g=="function"?g(e,s):(console.error("onStatusUpdate prop is not a function"),alert("Error: Unable to update status. Please refresh the page and try again.")),P()},K=e=>{U(e)},R=e=>{try{return ce(S(e),"yyyy-MM-dd")}catch(s){return console.error("Error formatting date:",s),"Invalid date"}},Q=(e,s)=>{if(!e||!s)return"N/A";try{const c=S(e),l=S(s),o=ie(de(l,1),c);return o===1?"1 day":`${o} days`}catch(c){return console.error("Error calculating duration:",c),"N/A"}},W=()=>{if(F(!v),v)j([]);else{const e=y.filter(s=>s.status==="pending").map(s=>s.id);j(e)}},Y=e=>{j(s=>s.includes(e)?s.filter(c=>c!==e):[...s,e])},Z=()=>{if(p.length===0){alert("Please select at least one travel order");return}L(!0)},I=()=>{L(!1)},O=(e,s)=>{if(typeof g=="function"){const c=p.map(l=>new Promise((o,r)=>{try{g(l,{status:e,remarks:s}),o()}catch(a){r(a)}}));Promise.all(c).then(()=>{j([]),F(!1)}).catch(l=>{console.error("Error during bulk update:",l)})}I()},ee=()=>{const e=new URLSearchParams;d&&e.append("status",d),m&&e.append("search",m),n.from&&e.append("from_date",n.from),n.to&&e.append("to_date",n.to);const s=`/travel-orders/export?${e.toString()}`;window.open(s,"_blank")},N=y.filter(e=>e.status==="pending").length,te=e=>{switch(e){case"company_vehicle":return"Company Vehicle";case"personal_vehicle":return"Personal Vehicle";case"public_transport":return"Public Transport";case"plane":return"Plane";case"other":return"Other";default:return e||"N/A"}};return t.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden flex flex-col h-[62vh]",children:[t.jsxs("div",{className:"p-4 border-b",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Travel Order Requests"}),t.jsxs("div",{className:"flex flex-wrap gap-2 w-full md:w-auto",children:[t.jsxs("button",{onClick:ee,className:"px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center",title:"Export to Excel",children:[t.jsx(oe,{className:"h-4 w-4 mr-1"}),"Export"]}),p.length>0&&t.jsxs("button",{onClick:Z,className:"px-3 py-1 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:["Bulk Action (",p.length,")"]}),t.jsx("div",{className:"flex items-center",children:t.jsxs("select",{id:"statusFilter",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:d,onChange:H,children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"approved",children:"Approved"}),t.jsx("option",{value:"rejected",children:"Rejected"}),t.jsx("option",{value:"completed",children:"Completed"}),t.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]})]}),t.jsxs("div",{className:"mt-4 flex flex-col md:flex-row gap-3",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(ne,{className:"h-4 w-4 text-gray-400"})}),t.jsx("input",{type:"text",placeholder:"Search by name, ID, department, destination, or purpose",className:"pl-10 w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:m,onChange:z})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"fromDate",className:"mr-2 text-sm font-medium text-gray-700",children:"From:"}),t.jsx("input",{id:"fromDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:n.from,onChange:e=>M("from",e.target.value)})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"toDate",className:"mr-2 text-sm font-medium text-gray-700",children:"To:"}),t.jsx("input",{id:"toDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:n.to,onChange:e=>M("to",e.target.value)})]}),(d||m||n.from||n.to)&&t.jsxs("button",{onClick:X,className:"px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md text-sm flex items-center",title:"Clear all filters",children:[t.jsx(le,{className:"h-4 w-4 mr-1"}),"Clear"]})]})]})]}),t.jsx("div",{className:"overflow-auto flex-grow",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:t.jsxs("tr",{children:[N>0&&t.jsx("th",{scope:"col",className:"px-4 py-3 w-10",children:t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:v&&p.length===N,onChange:W})}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Destination"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date Range"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Duration"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transport"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:N>0?"8":"7",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No travel order records found"})}):y.map(e=>{var s;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[N>0&&t.jsx("td",{className:"px-4 py-4",children:e.status==="pending"&&t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:p.includes(e.id),onChange:()=>Y(e.id)})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.employee?`${e.employee.Lname}, ${e.employee.Fname}`:"Unknown employee"}),t.jsx("div",{className:"text-sm text-gray-500",children:((s=e.employee)==null?void 0:s.idno)||"N/A"})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.destination||"N/A"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"text-sm text-gray-900",children:[e.start_date?R(e.start_date):"N/A",e.start_date!==e.end_date&&e.end_date?` to ${R(e.end_date)}`:""]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:Q(e.start_date,e.end_date)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:te(e.transportation_type)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx(se,{status:e.status})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[t.jsx("button",{onClick:()=>G(e),className:"text-indigo-600 hover:text-indigo-900 mr-3",children:"View"}),e.status==="pending"&&t.jsx("button",{onClick:()=>K(e.id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id)})})]})}),$&&C&&t.jsx(ae,{travelOrder:C,onClose:P,onStatusUpdate:J}),q&&t.jsx(re,{selectedCount:p.length,onClose:I,onSubmit:O})]})};export{De as default};
