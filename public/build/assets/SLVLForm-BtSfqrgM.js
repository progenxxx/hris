import{r as n,j as e}from"./app-D-TNKEQL.js";import{C as ae}from"./calendar-DhTYrr3L.js";import{L as se}from"./loader-zY545RmG.js";import{C as te}from"./circle-alert-DRTaAOqF.js";import{U as re}from"./upload-Cz6lxnvX.js";import{F as ne}from"./file-text-QjoOwKBJ.js";import{X as le}from"./x-fQrOvEob.js";import{f as ie}from"./format-Bw_hER4B.js";import{d as de}from"./differenceInDays-BVuYXEfI.js";import"./createLucideIcon-DEWnkTLV.js";const be=({employees:D,leaveTypes:S,payOptions:Y,departments:J,onSubmit:V})=>{var M,A,T,$,R,G,O,U;const h=ie(new Date,"yyyy-MM-dd"),x=new Date().getFullYear(),C=[];for(let s=x-3;s<=x+3;s++)C.push(s);const[a,c]=n.useState({employee_id:"",type:"",start_date:h,end_date:h,half_day:!1,am_pm:"AM",pay_type:"with_pay",reason:"",supporting_documents:null,bank_year:x}),[F,z]=n.useState([]),[y,E]=n.useState(""),[f,L]=n.useState(""),[m,P]=n.useState(null),[p,q]=n.useState(1),[_,B]=n.useState(!1),[d,g]=n.useState(null),[X,I]=n.useState(!1),[o,w]=n.useState(null),[W,b]=n.useState(null);n.useEffect(()=>{let s=D||[];if(y){const t=y.toLowerCase();s=s.filter(r=>{var l;return r.name.toLowerCase().includes(t)||((l=r.idno)==null?void 0:l.toString().includes(t))})}f&&(s=s.filter(t=>t.department===f)),z(s)},[y,f,D]),n.useEffect(()=>{if(a.start_date&&a.end_date)if(a.half_day)q(.5);else{const s=new Date(a.start_date),t=new Date(a.end_date),r=de(t,s)+1;q(r)}},[a.start_date,a.end_date,a.half_day]),n.useEffect(()=>{a.employee_id&&a.bank_year?H(a.employee_id,a.bank_year):g(null)},[a.employee_id,a.bank_year]);const H=async(s,t)=>{I(!0);try{const r=await fetch(`/slvl/bank/${s}?year=${t}`);if(!r.ok)throw new Error("Failed to fetch bank data");const l=await r.json();g(l)}catch(r){console.error("Error fetching bank data:",r),g(null)}finally{I(!1)}},i=s=>{const{name:t,value:r,type:l,checked:N}=s.target;let u=l==="checkbox"?N:r;t==="bank_year"&&(u=parseInt(r,10),console.log("Bank year changed to:",u)),c({...a,[t]:u}),t==="start_date"&&a.end_date<r&&c(k=>({...k,[t]:u,end_date:r})),t==="half_day"&&!N&&c(k=>({...k,[t]:u,am_pm:"AM"}))},K=s=>{const t=s.target.files[0];if(t){if(t.size>5*1024*1024){alert("File size must be less than 5MB"),s.target.value="";return}if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/jpg"].includes(t.type)){alert("Only PDF, DOC, DOCX, JPG, JPEG, and PNG files are allowed"),s.target.value="";return}if(w(t),c({...a,supporting_documents:t}),t.type.startsWith("image/")){const l=new FileReader;l.onload=N=>b(N.target.result),l.readAsDataURL(t)}else b(null)}},Q=()=>{w(null),b(null),c({...a,supporting_documents:null});const s=document.getElementById("supporting_documents");s&&(s.value="")},Z=s=>{c({...a,employee_id:s.id}),P(s)},j=()=>{const s=S.find(t=>t.value===a.type);return s?s.requires_documents:!1},v=()=>{var s,t,r,l;return!d||!a.type?0:a.type==="sick"?((t=(s=d.slvl_banks)==null?void 0:s.sick)==null?void 0:t.remaining_days)||0:a.type==="vacation"&&((l=(r=d.slvl_banks)==null?void 0:r.vacation)==null?void 0:l.remaining_days)||0},ee=s=>{if(s.preventDefault(),!_){if(!a.employee_id){alert("Please select an employee");return}if(!a.type){alert("Please select a leave type");return}if(!a.start_date||!a.end_date){alert("Please specify both start and end dates");return}if(a.start_date>a.end_date){alert("End date must be after or equal to start date");return}if(!a.reason.trim()){alert("Please provide a reason for the leave");return}if(j()&&!o){alert(`Supporting documents are required for ${a.type} leave`);return}if(["sick","vacation"].includes(a.type)&&a.pay_type==="with_pay"){const t=v();if(p>t){alert(`Insufficient ${a.type} leave days for ${a.bank_year}. Employee only has ${t} days available.`);return}}B(!0);try{const t=new FormData;t.append("employee_id",a.employee_id),t.append("type",a.type),t.append("start_date",a.start_date),t.append("end_date",a.end_date),t.append("half_day",a.half_day?"1":"0"),a.am_pm&&t.append("am_pm",a.am_pm),t.append("pay_type",a.pay_type),t.append("reason",a.reason),t.append("bank_year",parseInt(a.bank_year,10)),o&&t.append("supporting_documents",o),console.log("Submitting form with bank_year:",a.bank_year),V(t),c({employee_id:"",type:"",start_date:h,end_date:h,half_day:!1,am_pm:"AM",pay_type:"with_pay",reason:"",supporting_documents:null,bank_year:x}),P(null),E(""),L(""),w(null),b(null),g(null);const r=document.getElementById("supporting_documents");r&&(r.value="")}catch(t){console.error("Error during form submission:",t),alert("An error occurred while submitting the form. Please try again.")}finally{B(!1)}window.scrollTo({top:0,behavior:"smooth"})}};return e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Request Leave (SLVL)"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Create leave request for employee"})]}),e.jsxs("form",{onSubmit:ee,encType:"multipart/form-data",children:[e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsx("h4",{className:"font-medium text-blue-800",children:"Leave Bank Year Selection"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:"bank_year",className:"block text-sm font-medium text-blue-700 mb-1",children:["Select Bank Year ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("select",{id:"bank_year",name:"bank_year",className:"w-full rounded-md border-blue-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50",value:a.bank_year,onChange:i,required:!0,children:C.map(s=>e.jsxs("option",{value:s,children:[s," ",s===x&&"(Current)"]},s))})]}),e.jsx("div",{className:"flex-2",children:e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsxs("p",{className:"font-medium",children:["Selected Year: ",a.bank_year]}),e.jsx("p",{className:"text-xs mt-1",children:"Leave days will be deducted from this year's bank"})]})})]})]}),e.jsxs("div",{className:"md:col-span-2 bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Select Employee"}),e.jsxs("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by name or ID",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:y,onChange:s=>E(s.target.value)})}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:f,onChange:s=>L(s.target.value),children:[e.jsx("option",{value:"",children:"All Departments"}),J.map((s,t)=>e.jsx("option",{value:s,children:s},t))]})})]}),e.jsx("div",{className:"border rounded-md overflow-hidden max-h-60 overflow-y-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Position"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:F.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-4 py-3 text-center text-sm text-gray-500",children:"No employees match your search criteria"})}):F.map(s=>e.jsxs("tr",{className:`hover:bg-gray-50 cursor-pointer ${a.employee_id===s.id?"bg-indigo-50":""}`,onClick:()=>Z(s),children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:s.idno}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:s.department}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:s.position})]},s.id))})]})}),e.jsx("div",{className:"mt-3",children:m?e.jsx("div",{className:"bg-white border border-gray-200 rounded-md p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-gray-900",children:["Selected: ",m.name]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Employee ID: ",m.idno," • Department: ",m.department]})]}),e.jsx("div",{className:"text-right",children:X?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"w-4 h-4 animate-spin text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Loading bank data..."})]}):d?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium text-blue-600",children:["Sick Leave (",a.bank_year,"):"]}),e.jsxs("span",{className:`ml-1 font-bold ${((A=(M=d.slvl_banks)==null?void 0:M.sick)==null?void 0:A.remaining_days)>0?"text-green-600":"text-red-600"}`,children:[(($=(T=d.slvl_banks)==null?void 0:T.sick)==null?void 0:$.remaining_days)||0," days"]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium text-green-600",children:["Vacation Leave (",a.bank_year,"):"]}),e.jsxs("span",{className:`ml-1 font-bold ${((G=(R=d.slvl_banks)==null?void 0:R.vacation)==null?void 0:G.remaining_days)>0?"text-green-600":"text-red-600"}`,children:[((U=(O=d.slvl_banks)==null?void 0:O.vacation)==null?void 0:U.remaining_days)||0," days"]})]})]}):e.jsxs("div",{className:"text-sm text-gray-500",children:["No bank data available for ",a.bank_year]})})]})}):e.jsx("div",{className:"text-sm text-yellow-600 bg-yellow-50 border border-yellow-200 rounded-md p-2",children:"No employee selected"})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Leave Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 mb-1",children:["Leave Type ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{id:"type",name:"type",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:a.type,onChange:i,required:!0,children:[e.jsx("option",{value:"",children:"Select Leave Type"}),S.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),a.type&&j()&&e.jsxs("div",{className:"mt-1 flex items-center text-xs text-amber-600",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),"Supporting documents required for this leave type"]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"start_date",className:"block text-sm font-medium text-gray-700 mb-1",children:["Start Date ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"date",id:"start_date",name:"start_date",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:a.start_date,onChange:i,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"end_date",className:"block text-sm font-medium text-gray-700 mb-1",children:["End Date ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"date",id:"end_date",name:"end_date",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:a.end_date,onChange:i,min:a.start_date,required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",name:"half_day",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:a.half_day,onChange:i}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Half Day"})]}),a.half_day&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"am_pm",value:"AM",className:"text-indigo-600 border-gray-300 focus:ring-indigo-500",checked:a.am_pm==="AM",onChange:i}),e.jsx("span",{className:"ml-1 text-sm text-gray-700",children:"AM"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"am_pm",value:"PM",className:"text-indigo-600 border-gray-300 focus:ring-indigo-500",checked:a.am_pm==="PM",onChange:i}),e.jsx("span",{className:"ml-1 text-sm text-gray-700",children:"PM"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Pay Type ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("div",{className:"space-y-2",children:Y.map(s=>e.jsxs("label",{className:"inline-flex items-center mr-4",children:[e.jsx("input",{type:"radio",name:"pay_type",value:s.value,className:"text-indigo-600 border-gray-300 focus:ring-indigo-500",checked:a.pay_type===s.value,onChange:i}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:s.label})]},s.value))}),a.pay_type==="non_pay"&&e.jsx("div",{className:"mt-1 text-xs text-blue-600",children:"Non-pay leave will not deduct from leave bank balance"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-md border border-blue-200",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800 mb-2",children:"Leave Request Summary"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-blue-700",children:"Total Days:"}),e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[p," ",p===1?"day":"days"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-blue-700",children:"Bank Year:"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:a.bank_year})]}),m&&["sick","vacation"].includes(a.type)&&a.pay_type==="with_pay"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm text-blue-700",children:["Available ",a.type," days:"]}),e.jsxs("span",{className:`text-sm font-medium ${v()>=p?"text-green-700":"text-red-700"}`,children:[v()," days"]})]}),m&&["sick","vacation"].includes(a.type)&&a.pay_type==="with_pay"&&p>v()&&e.jsxs("div",{className:"mt-2 text-xs text-red-700 bg-red-100 p-2 rounded border border-red-200",children:["⚠️ Insufficient leave days available for ",a.bank_year]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Additional Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700 mb-1",children:["Reason ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{id:"reason",name:"reason",rows:"4",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",placeholder:"Please provide a detailed reason for your leave request",value:a.reason,onChange:i,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"supporting_documents",className:"block text-sm font-medium text-gray-700 mb-1",children:["Supporting Documents ",j()&&e.jsx("span",{className:"text-red-600",children:"*"})]}),o?e.jsx("div",{className:"mt-1 bg-white border border-gray-300 rounded-md p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:o.type.startsWith("image/")?e.jsx("img",{src:W,alt:"Preview",className:"h-10 w-10 object-cover rounded border"}):e.jsx(ne,{className:"h-10 w-10 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:o.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(o.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsx("button",{type:"button",onClick:Q,className:"ml-3 flex-shrink-0 bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:e.jsx(le,{className:"h-5 w-5"})})]})}):e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(re,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"flex text-sm text-gray-600",children:[e.jsxs("label",{htmlFor:"supporting_documents",className:"relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{id:"supporting_documents",name:"supporting_documents",type:"file",className:"sr-only",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",onChange:K})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PDF, DOC, DOCX, JPG, JPEG, PNG up to 5MB"})]})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:j()?`Supporting documents are required for ${a.type} leave`:"Supporting documents are optional for this leave type"})]})]})]})]}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6 border-t",children:e.jsx("button",{type:"submit",disabled:_,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:_?"Submitting...":"Submit Leave Request"})})]})]})};export{be as default};
