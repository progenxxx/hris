import{r as m,j as e}from"./app-7K62fd2B.js";import{B as d}from"./Button-B-ixrUdq.js";import{A as D,a as S}from"./alert-Cw6Swk3l.js";import{M as F,S as B}from"./sun-DGcVySav.js";import{X as G}from"./x-4sBMcqny.js";import{T as R}from"./triangle-alert-BFKAbd31.js";import{C as J}from"./circle-check-big-CdHds-fH.js";import{C as N}from"./clock-r6FcyLKi.js";import{C as z}from"./car-HfwOmSbn.js";import{I as K}from"./info-CNKW5Dcc.js";import{L as O}from"./loader-circle-CCcIPQox.js";import{T as Q}from"./trash-2-CLTfogtc.js";import{R as V}from"./refresh-cw-DqcGqKqT.js";import{c as Y}from"./createLucideIcon-BK5csKvN.js";import{S as Z}from"./save-BqIq9Yvz.js";import"./clsx-B-dksMZM.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=Y("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),c=t=>{if(!t)return"";try{let s;if(t.includes("T")){const[,o]=t.split("T");s=o.slice(0,5)}else if(t.includes(" ")){const o=t.split(" ");s=o[o.length-1].slice(0,5)}else s=t.slice(0,5);return s}catch(s){return console.error("Time formatting error for input:",s,t),""}},n=t=>{if(!t)return"-";try{let s;if(t.includes("T")){const[,x]=t.split("T");s=x.slice(0,5)}else{const x=t.split(" ");s=x[x.length-1].slice(0,5)}const[o,g]=s.split(":"),u=parseInt(o,10),f=u>=12?"PM":"AM";return`${u%12||12}:${g} ${f}`}catch(s){return console.error("Time formatting error:",s),"-"}},_=({name:t,value:s,onChange:o,placeholder:g,required:u=!1,disabled:f=!1})=>e.jsx("input",{type:"time",name:t,value:s,onChange:o,placeholder:g,required:u,disabled:f,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm ${f?"bg-gray-100 cursor-not-allowed":""}`}),je=({isOpen:t,attendance:s,onClose:o,onSave:g,onDelete:u,onSync:f})=>{const[r,x]=m.useState({id:"",time_in:"",time_out:"",break_in:"",break_out:"",next_day_timeout:"",is_nightshift:!1,trip:0}),[v,l]=m.useState(""),[k,p]=m.useState(""),[a,E]=m.useState(!1),[b,I]=m.useState(!1),[h,A]=m.useState(!1),[M,T]=m.useState(!1);m.useEffect(()=>{s&&x({id:s.id,time_in:c(s.time_in),time_out:c(s.time_out),break_in:c(s.break_in),break_out:c(s.break_out),next_day_timeout:c(s.next_day_timeout),is_nightshift:s.is_nightshift||!1,trip:s.trip||0})},[s]);const j=i=>{const{name:w,value:C,type:y,checked:$}=i.target;x(X=>({...X,[w]:y==="checkbox"?$:C}))},L=i=>{const w=i.target.checked;x(C=>{const y={...C,is_nightshift:w};return w?C.next_day_timeout&&(y.time_out=""):y.next_day_timeout="",y})},q=()=>{if(!r.time_in)return l("Time In is required"),!1;if(r.is_nightshift){if(!r.time_out&&!r.next_day_timeout)return l("Either Time Out (same day) or Next Day Timeout is required for night shifts"),!1;if(r.time_out&&r.next_day_timeout)return l("Please use either Time Out OR Next Day Timeout, not both"),!1}else if(!r.time_out)return l("Time Out is required for regular shifts"),!1;return r.break_out&&!r.break_in?(l("Break In time is required when Break Out is specified"),!1):r.break_in&&!r.break_out?(l("Break Out time is required when Break In is specified"),!1):r.trip&&(isNaN(r.trip)||r.trip<0)?(l("Trip must be a valid positive number"),!1):!0},P=async()=>{if(l(""),p(""),!!q()){E(!0);try{const i={id:r.id,time_in:r.time_in,time_out:r.time_out,break_in:r.break_in,break_out:r.break_out,next_day_timeout:r.next_day_timeout,is_nightshift:r.is_nightshift,trip:parseFloat(r.trip)||0};await g(i),p("Attendance updated successfully!"),window.location.reload()}catch(i){console.error("Error saving attendance:",i),l("Failed to save attendance: "+(i.message||"Unknown error"))}finally{E(!1)}}},U=async()=>{if(s!=null&&s.id){I(!0),l("");try{await f(s.id),p("Record synced successfully!")}catch(i){console.error("Error syncing record:",i),l("Failed to sync record: "+(i.message||"Unknown error"))}finally{I(!1)}}},H=async()=>{if(s!=null&&s.id){A(!0),l("");try{await u(s.id),p("Record deleted successfully!"),T(!1),o()}catch(i){console.error("Error deleting record:",i),l("Failed to delete record: "+(i.message||"Unknown error"))}finally{A(!1)}}},W=()=>{s&&(x({id:s.id,time_in:c(s.time_in),time_out:c(s.time_out),break_in:c(s.break_in),break_out:c(s.break_out),next_day_timeout:c(s.next_day_timeout),is_nightshift:s.is_nightshift||!1,trip:s.trip||0}),l(""),p(""))};return m.useEffect(()=>{if(k){const i=setTimeout(()=>p(""),3e3);return()=>clearTimeout(i)}},[k]),m.useEffect(()=>{if(v){const i=setTimeout(()=>l(""),5e3);return()=>clearTimeout(i)}},[v]),t?e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Edit Attendance Times"}),r.is_nightshift&&e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-sm",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{children:"Night Shift"})]}),!r.is_nightshift&&e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:"Regular Shift"})]})]}),e.jsx("button",{onClick:o,className:"text-gray-500 hover:text-gray-700","aria-label":"Close",disabled:a||b||h,children:e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"font-medium text-gray-900 mb-2",children:[s==null?void 0:s.employee_name," (ID: ",s==null?void 0:s.idno,")"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Department:"})," ",(s==null?void 0:s.department)||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",s!=null&&s.attendance_date?new Date(s.attendance_date).toLocaleDateString():"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Hours Worked:"})," ",(s==null?void 0:s.hours_worked)||"N/A"]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-200",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Current Times:"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"In:"})," ",e.jsx("span",{className:"font-mono",children:n(s==null?void 0:s.time_in)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Out:"})," ",e.jsx("span",{className:"font-mono",children:n(s==null?void 0:s.time_out)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Break Out:"})," ",e.jsx("span",{className:"font-mono",children:n(s==null?void 0:s.break_out)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Break In:"})," ",e.jsx("span",{className:"font-mono",children:n(s==null?void 0:s.break_in)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Next Day:"})," ",e.jsx("span",{className:"font-mono",children:n(s==null?void 0:s.next_day_timeout)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Trips:"})," ",e.jsx("span",{className:"font-mono",children:(s==null?void 0:s.trip)||0})]})]})]})]}),v&&e.jsxs(D,{variant:"destructive",className:"mb-4",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),e.jsx(S,{children:v})]}),k&&e.jsxs(D,{className:"mb-4 border-green-200 bg-green-50",children:[e.jsx(J,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx(S,{className:"text-green-800",children:k})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("input",{type:"checkbox",id:"is_nightshift",name:"is_nightshift",className:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded",checked:r.is_nightshift,onChange:L,disabled:a}),e.jsx("label",{htmlFor:"is_nightshift",className:"text-sm font-medium text-gray-900",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[r.is_nightshift?e.jsx(F,{className:"h-4 w-4 text-purple-600"}):e.jsx(B,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{children:"Night Shift"})]})})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-7",children:r.is_nightshift?"Employee works overnight and may clock out the next day":"Employee clocks in and out on the same day"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"time_in",className:"block text-sm font-medium text-gray-700 mb-2",children:["Time In ",e.jsx("span",{className:"text-red-500",children:"*"}),(s==null?void 0:s.time_in)&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(Current: ",n(s.time_in),")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 z-10"}),e.jsx("div",{className:"pl-10",children:e.jsx(_,{name:"time_in",value:r.time_in,onChange:j,placeholder:"9:30 AM",required:!0,disabled:a})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"break_out",className:"block text-sm font-medium text-gray-700 mb-2",children:["Break Out (Optional)",(s==null?void 0:s.break_out)&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(Current: ",n(s.break_out),")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 z-10"}),e.jsx("div",{className:"pl-10",children:e.jsx(_,{name:"break_out",value:r.break_out,onChange:j,placeholder:"12:00 PM",disabled:a})})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"When employee leaves for break/lunch"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"break_in",className:"block text-sm font-medium text-gray-700 mb-2",children:["Break In (Optional)",(s==null?void 0:s.break_in)&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(Current: ",n(s.break_in),")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 z-10"}),e.jsx("div",{className:"pl-10",children:e.jsx(_,{name:"break_in",value:r.break_in,onChange:j,placeholder:"1:00 PM",disabled:a})})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"When employee returns from break/lunch"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"time_out",className:"block text-sm font-medium text-gray-700 mb-2",children:["Time Out ",r.is_nightshift?"(Same Day)":e.jsx("span",{className:"text-red-500",children:"*"}),(s==null?void 0:s.time_out)&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(Current: ",n(s.time_out),")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 z-10"}),e.jsx("div",{className:"pl-10",children:e.jsx(_,{name:"time_out",value:r.time_out,onChange:j,placeholder:"5:30 PM",required:!r.is_nightshift,disabled:r.is_nightshift&&r.next_day_timeout||a})})]}),r.is_nightshift&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Only use if employee clocks out the same day"})]}),r.is_nightshift&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"next_day_timeout",className:"block text-sm font-medium text-gray-700 mb-2",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(F,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{children:"Next Day Timeout"}),!r.time_out&&e.jsx("span",{className:"text-red-500",children:"*"}),(s==null?void 0:s.next_day_timeout)&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(Current: ",n(s.next_day_timeout),")"]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-purple-600 z-10"}),e.jsx("div",{className:"pl-10",children:e.jsx(_,{name:"next_day_timeout",value:r.next_day_timeout,onChange:j,placeholder:"6:00 AM",disabled:!!r.time_out||a})})]}),e.jsx("p",{className:"mt-1 text-xs text-purple-600",children:"When employee clocks out the following day"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip",className:"block text-sm font-medium text-gray-700 mb-2",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(z,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"Number of Trips"}),(s==null?void 0:s.trip)&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(Current: ",s.trip,")"]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-blue-600 z-10"}),e.jsx("input",{type:"number",id:"trip",name:"trip",min:"0",max:"999.99",step:"0.01",value:r.trip,onChange:j,disabled:a,className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"0.00"})]}),e.jsx("p",{className:"mt-1 text-xs text-blue-600",children:"Enter number of trips (e.g., 1.5)"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(K,{className:"h-5 w-5 text-blue-600 mt-0.5 mr-2 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("h4",{className:"font-medium mb-2",children:"How to Use:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Regular Shifts:"}),' Use "Time In" and "Time Out" for same-day attendance']}),e.jsxs("p",{children:[e.jsx("strong",{children:"Night Shifts:"}),' Check "Night Shift" box, then either:']}),e.jsxs("ul",{className:"ml-4 mt-1 space-y-1",children:[e.jsx("li",{children:'• Use "Time Out" if employee clocks out the same day'}),e.jsx("li",{children:'• Use "Next Day Timeout" if employee clocks out the following day'})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Break Times:"}),' "Break Out" = leaving for break, "Break In" = returning from break']}),e.jsxs("p",{children:[e.jsx("strong",{children:"Trips:"})," Enter the number of trips completed (supports decimals like 1.5)"]})]})]})]})}),M&&e.jsxs(D,{variant:"destructive",className:"mb-6",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{children:"Are you sure you want to delete this attendance record? This action cannot be undone."}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>T(!1),disabled:h,children:"Cancel"}),e.jsx(d,{size:"sm",onClick:H,disabled:h,className:"bg-red-600 hover:bg-red-700 text-white",children:h?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-1 animate-spin"}),"Deleting..."]}):"Delete Record"})]})]})})]}),e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(d,{type:"button",variant:"outline",onClick:()=>T(!0),disabled:h||a,className:"text-red-600 border-red-300 hover:bg-red-50",size:"sm",children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Delete"]}),e.jsx(d,{type:"button",variant:"outline",onClick:U,disabled:b||a,className:"text-blue-600 border-blue-300 hover:bg-blue-50",title:"Sync this attendance record with related data",size:"sm",children:b?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-1 animate-spin"}),"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"Sync Record"]})}),e.jsxs(d,{type:"button",variant:"outline",onClick:W,disabled:a,className:"text-gray-600 border-gray-300 hover:bg-gray-50",size:"sm",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),"Reset"]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(d,{type:"button",variant:"outline",onClick:o,disabled:a||b||h,children:"Cancel"}),e.jsx(d,{onClick:P,disabled:a||b||h,className:"bg-blue-600 hover:bg-blue-700",children:a?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})]})]})]})]})}):null};export{je as default};
