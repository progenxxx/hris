import{r as d,j as e}from"./app-7K62fd2B.js";const O=({employees:p,departments:C,onSubmit:D})=>{var v,w,S;const g=new Date().toISOString().split("T")[0],[r,o]=d.useState({employee_ids:[],retro_type:"DAYS",adjustment_type:"increase",retro_date:g,hours_days:"",multiplier_rate:"",base_rate:"",reason:""}),[m,k]=d.useState(p||[]),[x,f]=d.useState(""),[u,y]=d.useState(""),h=[{value:"DAYS",label:"Regular Days",defaultMultiplier:1,unit:"Days"},{value:"OVERTIME",label:"Overtime Hours",defaultMultiplier:1.25,unit:"Hours"},{value:"SLVL",label:"Sick/Vacation Leave",defaultMultiplier:1,unit:"Days"},{value:"HOLIDAY",label:"Holiday Work",defaultMultiplier:2,unit:"Hours"},{value:"RD_OT",label:"Rest Day Overtime",defaultMultiplier:1.3,unit:"Hours"}],F=[{value:"increase",label:"Increase"},{value:"decrease",label:"Decrease"},{value:"correction",label:"Correction"},{value:"backdated",label:"Backdated Adjustment"}],l=h.find(s=>s.value===r.retro_type);d.useEffect(()=>{const s=h.find(t=>t.value===r.retro_type);s&&!r.multiplier_rate&&o(t=>({...t,multiplier_rate:s.defaultMultiplier.toString()}))},[r.retro_type]),d.useEffect(()=>{let s=[...p];if(x){const t=x.toLowerCase();s=s.filter(a=>a.name&&a.name.toLowerCase().includes(t)||a.Fname&&a.Fname.toLowerCase().includes(t)||a.Lname&&a.Lname.toLowerCase().includes(t)||a.idno&&a.idno.toString().includes(t))}u&&(s=s.filter(t=>t.department===u||t.Department===u)),s.sort((t,a)=>{const i=r.employee_ids.includes(t.id),n=r.employee_ids.includes(a.id);return i&&!n?-1:!i&&n?1:0}),k(s)},[x,u,p,r.employee_ids]);const E=d.useMemo(()=>{const s=parseFloat(r.hours_days)||0,t=parseFloat(r.multiplier_rate)||0,a=parseFloat(r.base_rate)||0;return s*t*a},[r.hours_days,r.multiplier_rate,r.base_rate]),c=s=>{const{name:t,value:a}=s.target;o({...r,[t]:a})},P=s=>{const t=s.target.value,a=h.find(i=>i.value===t);o(i=>({...i,retro_type:t,multiplier_rate:a?a.defaultMultiplier.toString():""}))},b=s=>{const t=parseInt(s,10);o(a=>a.employee_ids.includes(t)?{...a,employee_ids:a.employee_ids.filter(i=>i!==t)}:{...a,employee_ids:[...a.employee_ids,t]})},L=(s,t)=>{s.stopPropagation(),b(t)},I=()=>{o(s=>{const t=m.map(i=>i.id);if(t.every(i=>s.employee_ids.includes(i)))return{...s,employee_ids:s.employee_ids.filter(i=>!t.includes(i))};{const i=s.employee_ids.filter(n=>!t.includes(n));return{...s,employee_ids:[...i,...t]}}})},A=s=>{var t;if(s.preventDefault(),r.employee_ids.length===0){alert("Please select at least one employee");return}if(!r.retro_date){alert("Please select a retro date");return}if(!r.hours_days||parseFloat(r.hours_days)<=0){alert(`Please enter valid ${((t=l==null?void 0:l.unit)==null?void 0:t.toLowerCase())||"hours/days"}`);return}if(!r.multiplier_rate||parseFloat(r.multiplier_rate)<=0){alert("Please enter a valid multiplier rate");return}if(!r.base_rate||parseFloat(r.base_rate)<=0){alert("Please enter a valid base rate");return}if(!r.reason.trim()){alert("Please provide a reason for the retro adjustment");return}D(r),o({employee_ids:[],retro_type:"DAYS",adjustment_type:"increase",retro_date:g,hours_days:"",multiplier_rate:"",base_rate:"",reason:""}),f(""),y(""),window.scrollTo({top:0,behavior:"smooth"})},j=s=>{if(s.name)return s.name;const t=s.Fname||"",a=s.Lname||"",i=s.MName||"";let n=a;return t&&(n+=n?", "+t:t),i&&(n+=" "+i),n||`Employee #${s.id}`},M=s=>s.department||s.Department||"",q=s=>s.position||s.Jobtitle||"",_=m.length>0&&m.every(s=>r.employee_ids.includes(s.id)),R=p.filter(s=>r.employee_ids.includes(s.id)),N=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"PHP"}).format(s||0);return e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"File Retro Request"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Create retrospective adjustment request for one or multiple employees"})]}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Select Employees"}),e.jsxs("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by name or ID",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:x,onChange:s=>f(s.target.value)})}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:u,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"",children:"All Departments"}),C.map((s,t)=>e.jsx("option",{value:s,children:s},t))]})}),e.jsx("div",{className:"md:flex-initial",children:e.jsx("button",{type:"button",className:`w-full px-4 py-2 rounded-md ${_?"bg-indigo-700 hover:bg-indigo-800":"bg-indigo-500 hover:bg-indigo-600"} text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500`,onClick:I,children:_?"Deselect All":"Select All"})})]}),e.jsx("div",{className:"border rounded-md overflow-hidden max-h-60 overflow-y-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12",children:"Select"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Position"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-3 text-center text-sm text-gray-500",children:"No employees match your search criteria"})}):m.map(s=>e.jsxs("tr",{className:`hover:bg-gray-50 cursor-pointer ${r.employee_ids.includes(s.id)?"bg-indigo-50":""}`,onClick:()=>b(s.id),children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:r.employee_ids.includes(s.id),onChange:t=>L(t,s.id),onClick:t=>t.stopPropagation()})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:s.idno||""}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:j(s)})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:M(s)}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:q(s)})]},s.id))})]})}),e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:r.employee_ids.length>0?e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[r.employee_ids.length," employee(s) selected"]}),r.employee_ids.length<=5&&e.jsxs("span",{className:"ml-2",children:["(",R.map(s=>j(s).split(",")[0]).join(", "),")"]})]}):e.jsx("span",{className:"text-yellow-600",children:"No employees selected"})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Retro Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"retro_type",className:"block text-sm font-medium text-gray-700 mb-1",children:["Retro Type ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("select",{id:"retro_type",name:"retro_type",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:r.retro_type,onChange:P,required:!0,children:h.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Default multiplier: ",l==null?void 0:l.defaultMultiplier,"x"]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"adjustment_type",className:"block text-sm font-medium text-gray-700 mb-1",children:["Adjustment Type ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("select",{id:"adjustment_type",name:"adjustment_type",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:r.adjustment_type,onChange:c,required:!0,children:F.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"retro_date",className:"block text-sm font-medium text-gray-700 mb-1",children:["Retro Date ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"date",id:"retro_date",name:"retro_date",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:r.retro_date,onChange:c,required:!0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Time & Rate Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"hours_days",className:"block text-sm font-medium text-gray-700 mb-1",children:[(l==null?void 0:l.unit)||"Hours/Days"," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",id:"hours_days",name:"hours_days",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:r.hours_days,onChange:c,placeholder:`Enter ${((v=l==null?void 0:l.unit)==null?void 0:v.toLowerCase())||"hours/days"}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"multiplier_rate",className:"block text-sm font-medium text-gray-700 mb-1",children:["Multiplier Rate ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0.1",max:"10",id:"multiplier_rate",name:"multiplier_rate",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:r.multiplier_rate,onChange:c,placeholder:"e.g., 1.25, 2.0",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Rate multiplier (1.0 = regular rate, 1.25 = overtime rate, etc.)"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"base_rate",className:"block text-sm font-medium text-gray-700 mb-1",children:["Base Rate (per ",((w=l==null?void 0:l.unit)==null?void 0:w.slice(0,-1))||"Hour/Day",") ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",id:"base_rate",name:"base_rate",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:r.base_rate,onChange:c,placeholder:"Base hourly/daily rate",required:!0})]}),r.hours_days&&r.multiplier_rate&&r.base_rate&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-md border border-blue-200",children:[e.jsx("h5",{className:"text-sm font-medium text-blue-800 mb-2",children:"Calculation Preview:"}),e.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("div",{children:[r.hours_days," ",(S=l==null?void 0:l.unit)==null?void 0:S.toLowerCase()," × ",r.multiplier_rate," multiplier × ",N(r.base_rate)," base rate"]}),e.jsxs("div",{className:"font-semibold border-t border-blue-300 pt-1",children:["= ",N(E)]})]})]})]})]}),e.jsxs("div",{className:"md:col-span-2 bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Reason for Adjustment"}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700 mb-1",children:["Reason ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{id:"reason",name:"reason",rows:"4",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",placeholder:"Provide a detailed reason for the retro adjustment request",value:r.reason,onChange:c,required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Please provide a clear justification for the retrospective adjustment."})]})]})]}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6 border-t",children:e.jsx("button",{type:"submit",className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Submit Retro Request"})})]})]})};export{O as default};
