import{r as N,j as e}from"./app-7K62fd2B.js";import{B as D}from"./Button-B-ixrUdq.js";import{C as U}from"./checkbox-BquKEMMq.js";import{u as R,w as ae}from"./xlsx-BBWTpfDg.js";import{C as re}from"./circle-alert-CGQbi50W.js";import{S as W}from"./save-BqIq9Yvz.js";import{S as Y,a as ne}from"./star-CXt9UVdz.js";import{P as ie}from"./plus-DDuyej1g.js";import{L as le}from"./lock-BxfVTUP9.js";import{D as ce}from"./download-DiYogtYp.js";import"./clsx-B-dksMZM.js";import"./createLucideIcon-BK5csKvN.js";const oe=({value:i,isEditing:h,onChange:p,onSave:b,isDisabled:C,onKeyDown:S,rowIndex:v,colIndex:z,field:B,onClick:u,onCreateAndEdit:P,deductionExists:m})=>{const[f,k]=N.useState(i!==void 0?i.toString():"0.00"),d=N.useRef(null);N.useEffect(()=>{h&&d.current&&(d.current.focus(),d.current.select())},[h]),N.useEffect(()=>{i!==void 0&&k(i.toString())},[i]);const y=l=>{k(l.target.value),p&&p(l.target.value)},M=()=>{b&&b(f)},E=l=>{l.key==="Enter"&&(b&&b(f),l.preventDefault()),S&&S(l,v,z,B)},j=l=>{const $=(l.clipboardData||window.clipboardData).getData("text");if($.includes("	")||$.includes(`
`)){l.preventDefault();const L=$.split(/\r\n|\n|\r/).filter(O=>O.trim()!=="").map(O=>O.split("	"));p&&p(f,{pastedData:L,rowIndex:v,colIndex:z})}};return C?e.jsx("div",{className:"px-3 py-2 text-right text-gray-700 cursor-default min-h-[36px] flex items-center justify-end",onClick:l=>{l.stopPropagation(),u&&u()},children:parseFloat(i||0).toFixed(2)}):h?e.jsx("div",{className:"px-3 py-2",children:e.jsx("input",{ref:d,type:"number",step:"0.01",min:"0",className:"w-full p-1 px-2 border border-blue-400 rounded text-right bg-white text-black font-medium focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:f,onChange:y,onBlur:M,onKeyDown:E,onPaste:j,"data-row":v,"data-col":z,"data-field":B,onClick:l=>l.stopPropagation(),style:{boxShadow:"0 0 0 1px rgba(59, 130, 246, 0.5)",fontSize:"14px",height:"32px"},autoComplete:"off"})}):e.jsx("div",{className:`px-3 py-2 text-right ${m?"text-gray-700":"text-gray-400"} cursor-pointer hover:bg-gray-100 min-h-[36px] flex items-center justify-end transition-colors`,onClick:l=>{l.stopPropagation(),m?u&&u():P&&P()},children:m?parseFloat(i||0).toFixed(2):"0.00"})},de=({selectedItems:i,onClearSelection:h,onBulkPost:p,onBulkSetDefault:b,onExportSelected:C,disabled:S})=>{const v=i.length;return v===0?null:e.jsxs("div",{className:"bg-blue-50 p-3 mb-4 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsxs("span",{className:"text-blue-700 font-medium",children:[v," ",v===1?"item":"items"," selected"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(D,{variant:"outline",size:"sm",className:"bg-white hover:bg-gray-50",onClick:h,children:"Clear Selection"}),e.jsxs(D,{variant:"outline",size:"sm",className:"bg-yellow-50 hover:bg-yellow-100 border-yellow-300",onClick:b,disabled:S,children:[e.jsx(Y,{className:"h-4 w-4 text-yellow-600 mr-1"}),"Set as Default"]}),e.jsxs(D,{variant:"outline",size:"sm",className:"bg-blue-50 hover:bg-blue-100 border-blue-300",onClick:C,disabled:S,children:[e.jsx(ce,{className:"h-4 w-4 text-blue-600 mr-1"}),"Export Selected"]}),e.jsxs(D,{variant:"outline",size:"sm",className:"bg-green-50 hover:bg-green-100 border-green-300",onClick:p,disabled:S,children:[e.jsx(W,{className:"h-4 w-4 text-green-600 mr-1"}),"Post Selected"]})]})]})},ue=({isOpen:i,title:h,message:p,onConfirm:b,onCancel:C})=>i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:h}),e.jsx("p",{className:"text-gray-600 mb-6",children:p}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(D,{variant:"outline",onClick:C,children:"Cancel"}),e.jsx(D,{variant:"default",className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:b,children:"Confirm"})]})]})}):null,De=({employees:i,loading:h,onCellUpdate:p,onCreateDeduction:b,onPostDeduction:C,onSetDefault:S,onBulkPostDeductions:v,onBulkSetDefaultDeductions:z,onExportToExcel:B,pagination:u,fieldColumnsParam:P=["advance","charge_store","charge","meals","miscellaneous","other_deductions"]})=>{const m=Array.isArray(P)&&typeof P[0]=="string"?P.map(t=>({id:t,label:t.replace("_"," ").replace(/\b\w/g,r=>r.toUpperCase()),width:"140px"})):P,[f,k]=N.useState(null),[d,y]=N.useState([]),[M,E]=N.useState(!1),[j,l]=N.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[T,$]=N.useState(null);N.useEffect(()=>{y([]),E(!1)},[i]);const K=(t,r,s,n,o)=>{r&&k({employeeId:t,deductionId:r,field:s,rowIndex:n,colIndex:o})},L=(t,r,s,n)=>{$({employeeId:t,field:r,rowIndex:s,colIndex:n}),b(t)};N.useEffect(()=>{if(T){const{employeeId:t,field:r,rowIndex:s,colIndex:n}=T,o=i.find(a=>a.id===t),x=o!=null&&o.deductions&&o.deductions.length>0?o.deductions[0]:null;x&&(k({employeeId:t,deductionId:x.id,field:r,rowIndex:s,colIndex:n}),$(null))}},[i,T]);const O=(t,r,s,n)=>{if(n&&n.pastedData){G(n.pastedData,n.rowIndex,n.colIndex);return}p(t,r,s),k(null)},G=(t,r,s)=>{const n=m.reduce((o,x,a)=>(o[a]=x.id,o),{});t.forEach((o,x)=>{o.forEach((a,c)=>{const w=r+x,g=s+c;if(w>=i.length||g>=m.length)return;const _=i[w],F=A(_);if(!F||F.is_posted)return;const q=n[g];if(q){const H=parseFloat(a);isNaN(H)||p(F.id,q,H)}})}),k(null)},J=(t,r,s,n)=>{const o=i[r],x=A(o);if(!x)return;let a=r,c=s;switch(t.key){case"ArrowUp":a=Math.max(0,r-1),t.preventDefault();break;case"ArrowDown":a=Math.min(i.length-1,r+1),t.preventDefault();break;case"ArrowLeft":c=Math.max(0,s-1),t.preventDefault();break;case"ArrowRight":c=Math.min(m.length-1,s+1),t.preventDefault();break;case"Tab":t.shiftKey?(c--,c<0&&(a=Math.max(0,a-1),c=m.length-1)):(c++,c>=m.length&&(a=Math.min(i.length-1,a+1),c=0)),t.preventDefault();break;default:return}if(a!==r||c!==s){const w=i[a],g=A(w),_=m[c].id;if(f){const F=document.querySelector(`input[data-row="${r}"][data-col="${s}"]`);F&&p(x.id,n,F.value)}g&&!g.is_posted?k({employeeId:w.id,deductionId:g.id,field:_,rowIndex:a,colIndex:c}):g||L(w.id,_,a,c)}},A=t=>t.deductions&&t.deductions.length>0?t.deductions[0]:null,Q=t=>t&&t.is_posted,X=t=>t&&t.is_default,V=t=>`${t.Lname}, ${t.Fname} ${t.MName||""}`.trim(),Z=(t,r)=>{r&&r.stopPropagation(),d.includes(t)?y(d.filter(s=>s!==t)):y([...d,t])},I=t=>{if(t&&t.stopPropagation(),M)y([]);else{const r=i.map(s=>A(s)).filter(s=>s&&!s.is_posted).map(s=>s.id);y(r)}E(!M)},ee=()=>{if(d.length===0)return;const t=i.filter(r=>{const s=A(r);return s&&d.includes(s.id)});if(B)B(t);else{const r=R.book_new(),s=t.map(c=>{const w=A(c),g={"Employee ID":c.idno||"","Employee Name":V(c),Department:c.Department||""};return m.forEach(_=>{g[_.label.toUpperCase()]=w?parseFloat(w[_.id]||0).toFixed(2):"0.00"}),g}),n=R.json_to_sheet(s),o=[{wch:15},{wch:30},{wch:20}];m.forEach(()=>{o.push({wch:15})}),n["!cols"]=o,R.book_append_sheet(r,n,"Deductions");const x=new Date,a=`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}-${String(x.getDate()).padStart(2,"0")}`;ae(r,`employee_deductions_${a}.xlsx`)}},te=()=>{d.length!==0&&l({isOpen:!0,title:"Post Selected Deductions",message:`Are you sure you want to post ${d.length} selected deductions? This action cannot be undone.`,onConfirm:()=>{v(d),y([]),E(!1),l({...j,isOpen:!1})}})},se=()=>{d.length!==0&&l({isOpen:!0,title:"Set as Default Deductions",message:`Are you sure you want to set ${d.length} selected deductions as default? This will override existing default values.`,onConfirm:()=>{z(d),y([]),E(!1),l({...j,isOpen:!1})}})};return i.length===0&&!h?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(re,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Deductions Found"}),e.jsx("p",{children:"There are no deductions to display for the selected filters."})]}):e.jsxs("div",{className:"overflow-hidden",children:[e.jsx(de,{selectedItems:d,onClearSelection:()=>{y([]),E(!1)},onBulkPost:te,onBulkSetDefault:se,onExportSelected:ee,disabled:h}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-12 px-3 py-3 text-center",children:e.jsx("div",{className:"flex items-center justify-center cursor-pointer",onClick:t=>I(t),children:e.jsx(U,{checked:M,onCheckedChange:t=>{},disabled:h,className:"h-4 w-4"})})}),e.jsx("th",{className:"w-24 px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"}),e.jsx("th",{className:"w-64 px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),m.map(t=>e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:t.width},children:t.label},t.id)),e.jsx("th",{className:"w-24 px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h?e.jsx("tr",{children:e.jsx("td",{colSpan:m.length+4,className:"px-3 py-4 text-center text-gray-500",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"}),e.jsx("span",{children:"Loading..."})]})})}):i.map((t,r)=>{const s=A(t),n=Q(s),o=X(s),x=s?d.includes(s.id):!1;return e.jsxs("tr",{className:`hover:bg-gray-50 ${n?"bg-gray-50":""} ${x?"bg-blue-50":""}`,children:[e.jsx("td",{className:"w-12 px-3 py-3 text-center",children:s&&!n?e.jsx("div",{className:"flex items-center justify-center cursor-pointer",onClick:a=>Z(s.id,a),children:e.jsx(U,{checked:x,onCheckedChange:a=>{},className:"h-4 w-4"})}):e.jsx("div",{className:"h-4 w-4"})}),e.jsx("td",{className:"w-24 px-3 py-3",children:e.jsx("div",{className:"flex space-x-1",children:s?e.jsxs(e.Fragment,{children:[!n&&e.jsx(D,{variant:"outline",size:"sm",className:"p-1 h-8 w-8",onClick:a=>{a.stopPropagation(),l({isOpen:!0,title:"Post Deduction",message:"Are you sure you want to post this deduction? This action cannot be undone.",onConfirm:()=>{C(s.id),l({...j,isOpen:!1})}})},title:"Post Deduction",children:e.jsx(W,{className:"h-3 w-3 text-green-600"})}),e.jsx(D,{variant:"outline",size:"sm",className:`p-1 h-8 w-8 ${o?"bg-yellow-50":""}`,onClick:a=>{a.stopPropagation(),l({isOpen:!0,title:"Set as Default",message:"Are you sure you want to set this deduction as the default? This will override the existing default value.",onConfirm:()=>{S(s.id),l({...j,isOpen:!1})}})},title:o?"Default Values":"Set as Default",children:e.jsx(Y,{className:`h-3 w-3 ${o?"text-yellow-500":"text-gray-400"}`})})]}):e.jsx(D,{variant:"outline",size:"sm",className:"p-1 h-8 w-8",onClick:a=>{a.stopPropagation(),b(t.id)},title:"Create Deduction",children:e.jsx(ie,{className:"h-3 w-3 text-blue-600"})})})}),e.jsx("td",{className:"w-64 px-3 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:V(t)}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:t.Department||"N/A"})]})}),m.map((a,c)=>e.jsx("td",{className:"relative border-l border-gray-100",style:{width:a.width},children:e.jsx(oe,{value:s&&s[a.id]||0,isEditing:(f==null?void 0:f.employeeId)===t.id&&(f==null?void 0:f.deductionId)===((s==null?void 0:s.id)||"pending")&&(f==null?void 0:f.field)===a.id,isDisabled:n,onSave:(w,g)=>s&&O(s.id,a.id,w,g),onKeyDown:J,rowIndex:r,colIndex:c,field:a.id,onClick:()=>!n&&s&&K(t.id,s.id,a.id,r,c),onCreateAndEdit:()=>!n&&L(t.id,a.id,r,c),deductionExists:!!s})},a.id)),e.jsx("td",{className:"w-24 px-3 py-3 text-center",children:s?n?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),"Posted"]}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Pending"}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"No Data"})})]},t.id)})})]})}),u&&u.total>u.perPage&&e.jsx("div",{className:"px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(u.currentPage-1)*u.perPage+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(u.currentPage*u.perPage,u.total)})," ","of ",e.jsx("span",{className:"font-medium",children:u.total})," results"]})}),e.jsx("div",{children:e.jsx("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:u.links&&u.links.map((t,r)=>t.url===null?null:e.jsx("button",{onClick:s=>{if(s.stopPropagation(),!t.url)return;const n=t.url.split("page=")[1];u.onPageChange(n)},className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${t.active?"z-10 bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,dangerouslySetInnerHTML:{__html:t.label}},r))})})]})}),e.jsx(ue,{isOpen:j.isOpen,title:j.title,message:j.message,onConfirm:j.onConfirm,onCancel:()=>l({...j,isOpen:!1})})]})};export{De as default};
