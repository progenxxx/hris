import{a as de,r as o,c as A,j as e,H as me}from"./app-D-TNKEQL.js";import{A as xe}from"./AuthenticatedLayout-PCqsYVxf.js";import{S as pe}from"./Sidebar-Cg7Kwp5t.js";import{B as F}from"./Button-SjHtsDzU.js";import"./alert-ttcl-5kV.js";import{l as ue}from"./lodash-BVV6_chf.js";import{M as K}from"./Modal-BZgEdwvb.js";import{C as he}from"./ConfirmModal-CYPZTY1S.js";import{A as ge}from"./arrow-up-BZ9K62Fy.js";import{P as je}from"./plus-DLMoKXB_.js";import{S as Q}from"./search-DZDiwkir.js";import{M as fe}from"./map-pin-CjLaSfKC.js";import{C as be}from"./car-Ul5GVFP6.js";import{X as B}from"./x-fQrOvEob.js";import{C as Z}from"./circle-check-big-BKozuvyq.js";import{C as X}from"./circle-x-Ty60vMKt.js";import{C as Y}from"./check-CBYNjjSz.js";import{C as ye}from"./clock-D8g538AG.js";import{S as Ne}from"./save-DYdKxaX2.js";import"./ApplicationLogo-Cn-MbvX-.js";import"./Dropdown-BOoMuW7P.js";import"./transition-DeCEAfJ2.js";import"./createLucideIcon-DEWnkTLV.js";/* empty css                */import"./users-Cw0U-ZsC.js";import"./file-text-QjoOwKBJ.js";import"./calendar-DhTYrr3L.js";import"./clsx-B-dksMZM.js";import"./index-CC88eXid.js";const ve=({message:p,type:f,onClose:l})=>{o.useEffect(()=>{const i=setTimeout(()=>{l()},3e3);return()=>clearTimeout(i)},[l]);const s=f==="success"?"bg-green-50 border-green-200":"bg-red-50 border-red-200",r=f==="success"?"text-green-700":"text-red-700",g=f==="success"?e.jsx(Y,{className:"h-5 w-5 text-green-500"}):e.jsx(X,{className:"h-5 w-5 text-red-500"});return e.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center p-4 mb-4 rounded-lg shadow-md border ${s}`,role:"alert",children:[e.jsx("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8 rounded-lg",children:g}),e.jsx("div",{className:`ml-3 text-sm font-normal ${r}`,children:p}),e.jsx("button",{type:"button",className:`ml-auto -mx-1.5 -my-1.5 rounded-lg focus:ring-2 p-1.5 inline-flex h-8 w-8 ${r} hover:bg-gray-100`,onClick:l,"aria-label":"Close",children:e.jsx(B,{className:"w-5 h-5"})})]})},O=({status:p})=>p==="approved"?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Approved"]}):p==="rejected"?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(X,{className:"w-3 h-3 mr-1"}),"Rejected"]}):p==="completed"?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),"Completed"]}):p==="cancelled"?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),"Cancelled"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(ye,{className:"w-3 h-3 mr-1"}),"Pending"]}),G=({isOpen:p,onClose:f,title:l,travelOrder:s,employees:r=[],departments:g=[],onChange:i,onSubmit:S,mode:v="create",errorMessages:n={}})=>{const m=v==="view",[b,w]=o.useState(""),[y,N]=o.useState([]),[k,j]=o.useState([]),[T,E]=o.useState("");o.useEffect(()=>{p&&(console.log("Modal opened with employees:",(r==null?void 0:r.length)||0),console.log("Departments:",g),console.log("Current travel order:",s))},[p,r,g,s]),o.useEffect(()=>{if(p){w(""),E(""),s&&s.employee_ids?j(Array.isArray(s.employee_ids)?s.employee_ids:[]):j([]);const t=Array.isArray(r)?r:[];console.log(`Setting filtered employees: ${t.length} items`),N(t)}},[p,r,s]),o.useEffect(()=>{if(!Array.isArray(r)){console.warn("employees is not an array:",r),N([]);return}let t=[...r];if(T&&(t=t.filter(c=>c.Department===T)),b.trim()){const c=b.toLowerCase();t=t.filter(L=>{const $=(L.Fname||"").toLowerCase(),q=(L.Lname||"").toLowerCase(),R=(L.idno||"").toLowerCase(),M=`${$} ${q}`.toLowerCase(),W=`${q} ${$}`.toLowerCase();return $.includes(c)||q.includes(c)||R.includes(c)||M.includes(c)||W.includes(c)})}console.log(`Filtered employees: ${t.length} matches`),N(t)},[b,T,r]);const z=t=>({company_vehicle:"Company Vehicle",personal_vehicle:"Personal Vehicle",public_transport:"Public Transport",plane:"Plane",other:"Other"})[t]||t,P=t=>{let c;k.includes(t)?c=k.filter(L=>L!==t):c=[...k,t],j(c),i({...s,employee_ids:c})};return e.jsx(K,{show:p,onClose:f,maxWidth:"2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:l}),e.jsx("button",{onClick:f,className:"text-gray-400 hover:text-gray-500",children:e.jsx(B,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee(s)"}),m?e.jsx("div",{className:"p-2 border rounded bg-gray-50",children:s.employee?`${s.employee.Lname||""}, ${s.employee.Fname||""} ${s.employee.idno?`(${s.employee.idno})`:""}`:"Unknown Employee"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2 grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Q,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Search employees by name or ID...",value:b,onChange:t=>w(t.target.value)})]}),e.jsx("div",{children:e.jsxs("select",{className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",value:T,onChange:t=>E(t.target.value),children:[e.jsx("option",{value:"",children:"All Departments"}),Array.isArray(g)&&g.map((t,c)=>e.jsx("option",{value:t.name||t,children:t.name||t},`dept-${t.id||c}`))]})})]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:[y.length===0?"No matching employees found":y.length===1?"1 employee found":`${y.length} employees found`,k.length>0&&` - ${k.length} employee${k.length>1?"s":""} selected`]}),e.jsx("div",{className:"max-h-40 overflow-y-auto border rounded-md",children:y.length>0?e.jsx("div",{className:"divide-y divide-gray-200",children:y.map(t=>e.jsxs("div",{className:"flex items-center p-2 hover:bg-gray-50 cursor-pointer",onClick:()=>P(t.id),children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:k.includes(t.id),onChange:()=>{}}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[t.Lname,", ",t.Fname," ",t.MName||""]}),e.jsxs("div",{className:"text-xs text-gray-500 flex space-x-2",children:[e.jsx("span",{children:t.idno||"No ID"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:t.Department||"No Dept"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:t.Jobtitle||"No Title"})]})]})]},t.id))}):e.jsx("div",{className:"p-3 text-center text-gray-500 text-sm",children:"No employees found matching your criteria"})}),n.employee_ids&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.employee_ids})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Form Date"}),m?e.jsx("div",{className:"p-2 border rounded bg-gray-50",children:s.date?new Date(s.date).toLocaleDateString():""}):e.jsx("input",{type:"date",className:`w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.date?"border-red-500":""}`,value:s.date||"",onChange:t=>i({...s,date:t.target.value}),required:!0}),n.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),m?e.jsx("div",{className:"p-2 border rounded bg-gray-50",children:s.start_date?new Date(s.start_date).toLocaleDateString():""}):e.jsx("input",{type:"date",className:`w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.start_date?"border-red-500":""}`,value:s.start_date||"",onChange:t=>i({...s,start_date:t.target.value}),required:!0}),n.start_date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.start_date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),m?e.jsx("div",{className:"p-2 border rounded bg-gray-50",children:s.end_date?new Date(s.end_date).toLocaleDateString():""}):e.jsx("input",{type:"date",className:`w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.end_date?"border-red-500":""}`,value:s.end_date||"",onChange:t=>i({...s,end_date:t.target.value}),required:!0}),n.end_date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.end_date})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Destination"}),m?e.jsx("div",{className:"p-2 border rounded bg-gray-50",children:s.destination||""}):e.jsx("input",{type:"text",className:`w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.destination?"border-red-500":""}`,value:s.destination||"",onChange:t=>i({...s,destination:t.target.value}),placeholder:"e.g. Manila, Philippines",required:!0}),n.destination&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.destination})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transportation Type"}),m?e.jsx("div",{className:"p-2 border rounded bg-gray-50",children:z(s.transportation_type)||""}):e.jsxs("select",{className:`w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.transportation_type?"border-red-500":""}`,value:s.transportation_type||"",onChange:t=>i({...s,transportation_type:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select Transportation"}),e.jsx("option",{value:"company_vehicle",children:"Company Vehicle"}),e.jsx("option",{value:"personal_vehicle",children:"Personal Vehicle"}),e.jsx("option",{value:"public_transport",children:"Public Transport"}),e.jsx("option",{value:"plane",children:"Plane"}),e.jsx("option",{value:"other",children:"Other"})]}),n.transportation_type&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.transportation_type})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purpose"}),m?e.jsx("div",{className:"p-2 border rounded bg-gray-50 whitespace-pre-line min-h-[80px]",children:s.purpose||""}):e.jsx("textarea",{className:`w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.purpose?"border-red-500":""}`,value:s.purpose||"",onChange:t=>i({...s,purpose:t.target.value}),placeholder:"Detailed purpose of travel",rows:"3",required:!0}),n.purpose&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.purpose})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Accommodation Required"}),m?e.jsx("div",{className:"p-2 border rounded bg-gray-50",children:s.accommodation_required?"Yes":"No"}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"accommodation_required",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:s.accommodation_required||!1,onChange:t=>i({...s,accommodation_required:t.target.checked})}),e.jsx("label",{htmlFor:"accommodation_required",className:"text-sm text-gray-700",children:"Required"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Meal Allowance"}),m?e.jsx("div",{className:"p-2 border rounded bg-gray-50",children:s.meal_allowance?"Yes":"No"}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"meal_allowance",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:s.meal_allowance||!1,onChange:t=>i({...s,meal_allowance:t.target.checked})}),e.jsx("label",{htmlFor:"meal_allowance",className:"text-sm text-gray-700",children:"Required"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estimated Cost"}),m?e.jsx("div",{className:"p-2 border rounded bg-gray-50",children:s.estimated_cost?`₱${parseFloat(s.estimated_cost).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`:"₱0.00"}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500",children:"₱"})}),e.jsx("input",{type:"number",className:`w-full pl-8 p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.estimated_cost?"border-red-500":""}`,value:s.estimated_cost||"",onChange:t=>i({...s,estimated_cost:t.target.value}),placeholder:"0.00",min:"0",step:"0.01"})]}),n.estimated_cost&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.estimated_cost})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Other Expenses"}),m?e.jsx("div",{className:"p-2 border rounded bg-gray-50 whitespace-pre-line min-h-[60px]",children:s.other_expenses||"None"}):e.jsx("textarea",{className:`w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.other_expenses?"border-red-500":""}`,value:s.other_expenses||"",onChange:t=>i({...s,other_expenses:t.target.value}),placeholder:"Detail any other expenses expected",rows:"2"}),n.other_expenses&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.other_expenses})]}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsx(O,{status:s.status})})]}),s.total_days&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Days"}),e.jsxs("div",{className:"mt-1 text-sm text-gray-900",children:[s.total_days," day",s.total_days!==1?"s":""]})]}),s.approved_by&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Approved By"}),e.jsx("div",{className:"mt-1 text-sm text-gray-900",children:s.approver?s.approver.name:"Unknown User"})]}),s.approved_at&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Approved At"}),e.jsx("div",{className:"mt-1 text-sm text-gray-900",children:new Date(s.approved_at).toLocaleString()})]}),s.remarks&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Remarks"}),e.jsx("div",{className:"mt-1 text-sm text-gray-900 whitespace-pre-line",children:s.remarks})]})]}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx(F,{type:"button",variant:"outline",onClick:f,className:"mr-2",children:m?"Close":"Cancel"}),!m&&e.jsxs(F,{type:"submit",className:"bg-blue-600 text-white hover:bg-blue-700",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),v==="create"?"Create Travel Order":"Update Travel Order"]})]})]})]})})},we=({isOpen:p,onClose:f,travelOrder:l,onSubmit:s})=>{var m,b,w;const[r,g]=o.useState("approved"),[i,S]=o.useState("");o.useEffect(()=>{p&&(l&&l.status==="approved"?(g("completed"),S("")):(g("approved"),S("")))},[p,l]);const v=y=>{y.preventDefault(),s({status:r,remarks:i})},n=()=>l&&l.status==="approved"?e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"status",value:"completed",checked:r==="completed",onChange:()=>g("completed"),className:"form-radio h-4 w-4 text-green-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Mark as Completed"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"status",value:"cancelled",checked:r==="cancelled",onChange:()=>g("cancelled"),className:"form-radio h-4 w-4 text-red-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Cancel"})]})]}):e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"status",value:"approved",checked:r==="approved",onChange:()=>g("approved"),className:"form-radio h-4 w-4 text-green-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Approve"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"status",value:"rejected",checked:r==="rejected",onChange:()=>g("rejected"),className:"form-radio h-4 w-4 text-red-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Reject"})]})]});return e.jsx(K,{show:p,onClose:f,maxWidth:"md",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:l&&l.status==="approved"?"Update Travel Order Status":"Review Travel Order Request"}),e.jsx("button",{onClick:f,className:"text-gray-400 hover:text-gray-500",children:e.jsx(B,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee"}),e.jsxs("div",{className:"p-2 border rounded bg-gray-50",children:[(m=l==null?void 0:l.employee)==null?void 0:m.Fname," ",(b=l==null?void 0:l.employee)==null?void 0:b.Lname," (",(w=l==null?void 0:l.employee)==null?void 0:w.idno,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Travel Dates"}),e.jsxs("div",{className:"p-2 border rounded bg-gray-50",children:[l!=null&&l.start_date?new Date(l.start_date).toLocaleDateString():""," - ",l!=null&&l.end_date?new Date(l.end_date).toLocaleDateString():""]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Destination"}),e.jsx("div",{className:"p-2 border rounded bg-gray-50",children:l==null?void 0:l.destination})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purpose"}),e.jsx("div",{className:"p-2 border rounded bg-gray-50 whitespace-pre-line",children:l==null?void 0:l.purpose})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Decision"}),n()]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Remarks"}),e.jsx("textarea",{className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:i,onChange:y=>S(y.target.value),placeholder:"Add your comments or reasons for the decision",rows:"3"})]}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx(F,{type:"button",variant:"outline",onClick:f,className:"mr-2",children:"Cancel"}),e.jsxs(F,{type:"submit",className:r==="approved"?"bg-green-600 text-white hover:bg-green-700":r==="completed"?"bg-blue-600 text-white hover:bg-blue-700":"bg-red-600 text-white hover:bg-red-700",children:[r==="approved"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Approve Travel Order"]}),r==="rejected"&&e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Reject Travel Order"]}),r==="completed"&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Mark as Completed"]}),r==="cancelled"&&e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Cancel Travel Order"]})]})]})]})]})})},Oe=()=>{const{auth:p,travelOrders:f=[],employees:l=[],departments:s=[]}=de().props;p!=null&&p.user;const[r,g]=o.useState(f),[i,S]=o.useState(l),[v,n]=o.useState(s),[m,b]=o.useState(!0),[w,y]=o.useState(""),[N,k]=o.useState("all"),[j,T]=o.useState({from:"",to:""}),[E,z]=o.useState({visible:!1,message:"",type:"success"}),P={employee_ids:[],date:new Date().toISOString().split("T")[0],start_date:"",end_date:"",destination:"",transportation_type:"",purpose:"",accommodation_required:!1,meal_allowance:!1,other_expenses:"",estimated_cost:""},[t,c]=o.useState(P),[L,$]=o.useState({}),[q,R]=o.useState(!1),[M,W]=o.useState(!1),[ee,H]=o.useState(!1),[_,I]=o.useState({isOpen:!1,title:"",message:"",confirmText:"",confirmVariant:"destructive",onConfirm:()=>{}});o.useEffect(()=>{(async()=>{var d;if(!i||i.length===0)try{b(!0),console.log("Initializing employee data...");const u=await A.get("/employees/list");console.log(`Loaded ${((d=u.data.data)==null?void 0:d.length)||0} employees`),S(u.data.data||[])}catch(u){console.error("Failed to load employees:",u)}finally{b(!1)}})()},[]);const V=o.useCallback(async()=>{var a,d,u;b(!0);try{const x=await A.get("/travel-orders",{params:{search:w,status:N!=="all"?N:null,from_date:j.from||null,to_date:j.to||null}});if(g(x.data.travelOrders||[]),!i||i.length===0)try{const h=await A.get("/employees/list");S(h.data.data||[]),console.log(`Loaded ${((a=h.data.data)==null?void 0:a.length)||0} employees in loadData`)}catch(h){console.error("Error loading employees:",h)}if(!v||v.length===0)try{const h=await A.get("/departments");h.data.data&&Array.isArray(h.data.data)?(n(h.data.data),console.log(`Loaded ${h.data.data.length} departments`)):n([])}catch(h){if(console.error("Error loading departments:",h),i&&i.length>0){console.log("Extracting departments from employee data as fallback");const U=[...new Set(i.map(C=>C.Department).filter(Boolean))];console.log(`Extracted ${U.length} unique departments from employee data`),n(U)}else n([])}}catch(x){console.error("Error loading travel orders:",x),D("Error loading travel orders: "+(((u=(d=x.response)==null?void 0:d.data)==null?void 0:u.message)||x.message),"error")}finally{b(!1)}},[w,N,j,i,v]);o.useEffect(()=>{V()},[V]);const D=(a,d="success")=>{z({visible:!0,message:a,type:d})},se=()=>{z({...E,visible:!1})},te=ue.debounce(a=>{y(a)},300),ae=()=>{c(P),$({}),R(!0)},le=a=>{c({...a}),W(!0)},J=a=>{c({...a}),H(!0)},ne=async a=>{var d,u,x,h,U;a.preventDefault(),$({});try{const C=await A.post("/travel-orders",t);await V(),c(P),R(!1),D(C.data.message||"Travel order created successfully")}catch(C){console.error("Error creating travel order:",C),((d=C.response)==null?void 0:d.status)===422&&((x=(u=C.response)==null?void 0:u.data)!=null&&x.errors)?$(C.response.data.errors):D(((U=(h=C.response)==null?void 0:h.data)==null?void 0:U.message)||"Error creating travel order","error")}},re=async a=>{var d,u;try{const x=await A.post(`/travel-orders/${t.id}/status`,a);await V(),H(!1),D(x.data.message||"Travel order status updated successfully")}catch(x){console.error("Error updating travel order status:",x),D(((u=(d=x.response)==null?void 0:d.data)==null?void 0:u.message)||"Error updating travel order status","error")}},oe=a=>{I({isOpen:!0,title:"Delete Travel Order",message:"Are you sure you want to delete this travel order? This action cannot be undone.",confirmText:"Delete",confirmVariant:"destructive",onConfirm:async()=>{var d,u;try{const x=await A.delete(`/travel-orders/${a.id}`);await V(),I({..._,isOpen:!1}),D(x.data.message||"Travel order deleted successfully")}catch(x){console.error("Error deleting travel order:",x),I({..._,isOpen:!1}),D(((u=(d=x.response)==null?void 0:d.data)==null?void 0:u.message)||"Error deleting travel order","error")}}})},ie=async()=>{try{const d=`/travel-orders/export?${new URLSearchParams({search:w||"",status:N!=="all"?N:"",from_date:j.from||"",to_date:j.to||""}).toString()}`;window.open(d,"_blank")}catch(a){console.error("Error exporting travel orders:",a),D("Error exporting travel orders: "+a.message,"error")}},ce=a=>({company_vehicle:"Company Vehicle",personal_vehicle:"Personal Vehicle",public_transport:"Public Transport",plane:"Plane",other:"Other"})[a]||a;return e.jsxs(xe,{children:[e.jsx(me,{title:"Travel Orders"}),e.jsxs("div",{className:"flex min-h-screen bg-gray-50/50",children:[e.jsx(pe,{}),e.jsx("div",{className:"flex-1 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[E.visible&&e.jsx(ve,{message:E.message,type:E.type,onClose:se}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Travel Orders"}),e.jsx("p",{className:"text-gray-600",children:"Manage employee official travel requests and approvals."})]}),e.jsxs("div",{className:"flex gap-3 mt-4 md:mt-0",children:[e.jsxs(F,{onClick:ie,variant:"outline",className:"px-4 py-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200 flex items-center",children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Export to Excel"]}),e.jsxs(F,{onClick:ae,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"New Travel Order"]})]})]}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Q,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Search by name, destination...",onChange:a=>te(a.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:N,onChange:a=>k(a.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:j.from,onChange:a=>T({...j,from:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:j.to,onChange:a=>T({...j,to:a.target.value})})]})]})}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-9 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:[e.jsx("div",{className:"px-6 py-3 col-span-1",children:"Actions"}),e.jsx("div",{className:"px-6 py-3 col-span-1",children:"Status"}),e.jsx("div",{className:"px-6 py-3 col-span-2",children:"Employee"}),e.jsx("div",{className:"px-6 py-3 col-span-1",children:"Travel Dates"}),e.jsx("div",{className:"px-6 py-3 col-span-1",children:"Duration"}),e.jsx("div",{className:"px-6 py-3 col-span-1",children:"Destination"}),e.jsx("div",{className:"px-6 py-3 col-span-1",children:"Transportation"}),e.jsx("div",{className:"px-6 py-3 col-span-1",children:"Purpose"})]}),m&&e.jsx("div",{className:"py-16 text-center text-gray-500",children:"Loading..."}),!m&&r.length===0&&e.jsx("div",{className:"py-16 text-center text-gray-500",children:w||N!=="all"||j.from||j.to?"No travel orders found matching your filters.":"No travel orders found. Create a new travel order to get started."}),!m&&r.length>0&&e.jsx("div",{className:"divide-y divide-gray-200",children:r.map(a=>{var d,u,x,h;return e.jsxs("div",{className:"grid grid-cols-9 items-center hover:bg-gray-50",children:[e.jsx("div",{className:"px-6 py-4 col-span-1 whitespace-nowrap",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>le(a),className:"text-gray-400 hover:text-gray-500",title:"View",type:"button",children:e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),a.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>J(a),className:"text-gray-400 hover:text-gray-500",title:"Update Status",type:"button",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("button",{onClick:()=>oe(a),className:"text-gray-400 hover:text-red-500",title:"Delete",type:"button",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),a.status==="approved"&&e.jsx("button",{onClick:()=>J(a),className:"text-gray-400 hover:text-gray-500",title:"Update Status",type:"button",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]})}),e.jsx("div",{className:"px-6 py-4 col-span-1 whitespace-nowrap",children:e.jsx(O,{status:a.status})}),e.jsxs("div",{className:"px-6 py-4 col-span-2 whitespace-nowrap",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[(d=a.employee)==null?void 0:d.Lname,", ",(u=a.employee)==null?void 0:u.Fname]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[(x=a.employee)==null?void 0:x.idno," • ",(h=a.employee)==null?void 0:h.Department]})]}),e.jsxs("div",{className:"px-6 py-4 col-span-1 whitespace-nowrap text-sm text-gray-500",children:[e.jsx("div",{children:new Date(a.start_date).toLocaleDateString()}),e.jsx("div",{children:new Date(a.end_date).toLocaleDateString()})]}),e.jsxs("div",{className:"px-6 py-4 col-span-1 whitespace-nowrap text-sm text-gray-500",children:[a.total_days," day",a.total_days!==1?"s":""]}),e.jsx("div",{className:"px-6 py-4 col-span-1 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"h-3.5 w-3.5 text-gray-400 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate max-w-[120px]",title:a.destination,children:a.destination})]})}),e.jsx("div",{className:"px-6 py-4 col-span-1 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(be,{className:"h-3.5 w-3.5 text-gray-400 mr-1 flex-shrink-0"}),e.jsx("span",{children:ce(a.transportation_type)})]})}),e.jsx("div",{className:"px-6 py-4 col-span-1 text-sm text-gray-500",children:e.jsx("div",{className:"truncate max-w-[150px]",title:a.purpose,children:a.purpose})})]},a.id)})})]})]})})]}),e.jsx(G,{isOpen:q,onClose:()=>R(!1),title:"Create New Travel Order",travelOrder:t,employees:i,departments:v,onChange:c,onSubmit:ne,mode:"create",errorMessages:L}),e.jsx(G,{isOpen:M,onClose:()=>W(!1),title:"View Travel Order Details",travelOrder:t,employees:i,departments:v,onChange:c,onSubmit:()=>{},mode:"view",errorMessages:{}}),e.jsx(we,{isOpen:ee,onClose:()=>H(!1),travelOrder:t,onSubmit:re}),e.jsx(he,{isOpen:_.isOpen,onClose:()=>I({..._,isOpen:!1}),title:_.title,message:_.message,confirmText:_.confirmText,confirmVariant:_.confirmVariant,onConfirm:_.onConfirm})]})};export{Oe as default};
