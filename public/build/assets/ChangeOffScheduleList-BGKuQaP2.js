import{r as l,j as e}from"./app-D-TNKEQL.js";import ee from"./ChangeOffScheduleStatusBadge-PPQWi28n.js";import te from"./ChangeOffScheduleDetailModal-BeVtPRtv.js";import se from"./MultiBulkActionModal-D4ux3rVb.js";import{D as re}from"./download-Dnq6PCPG.js";import{S as ae}from"./search-DZDiwkir.js";import{X as oe}from"./x-fQrOvEob.js";import{f as I}from"./format-Bw_hER4B.js";import"./createLucideIcon-DEWnkTLV.js";const xe=({schedules:g,onStatusUpdate:h,onDelete:O,refreshInterval:S=5e3})=>{const[D,C]=l.useState(null),[U,k]=l.useState(!1),[c,A]=l.useState(""),[y,T]=l.useState(g||[]),[w,v]=l.useState(g||[]),p=l.useRef(null),[d,q]=l.useState(""),[o,_]=l.useState({from:"",to:""}),[u,j]=l.useState([]),[$,E]=l.useState(!1),[b,M]=l.useState(!1);l.useEffect(()=>{v(g||[]),f(g||[],c,d,o)},[g]),l.useEffect(()=>{const t=async()=>{try{if(typeof window.refreshSchedules=="function"){const s=await window.refreshSchedules();v(s),f(s,c,d,o)}}catch(s){console.error("Error refreshing schedule data:",s)}};return p.current=setInterval(t,S),()=>{p.current&&clearInterval(p.current)}},[S,c,d,o]);const f=(t,s,m,i)=>{let n=[...t];if(s&&(n=n.filter(a=>a.status===s)),m){const a=m.toLowerCase();n=n.filter(r=>r.employee&&(r.employee.Fname&&r.employee.Fname.toLowerCase().includes(a)||r.employee.Lname&&r.employee.Lname.toLowerCase().includes(a))||r.employee&&r.employee.idno&&r.employee.idno.toString().includes(a)||r.employee&&r.employee.Department&&r.employee.Department.toLowerCase().includes(a)||r.reason&&r.reason.toLowerCase().includes(a))}i.from&&i.to?n=n.filter(a=>{if(!a.requested_date)return!1;const r=new Date(a.requested_date),x=new Date(i.from),P=new Date(i.to);return P.setHours(23,59,59),r>=x&&r<=P}):i.from?n=n.filter(a=>{if(!a.requested_date)return!1;const r=new Date(a.requested_date),x=new Date(i.from);return r>=x}):i.to&&(n=n.filter(a=>{if(!a.requested_date)return!1;const r=new Date(a.requested_date),x=new Date(i.to);return x.setHours(23,59,59),r<=x})),T(n)},H=t=>{const s=t.target.value;A(s),f(w,s,d,o)},V=t=>{const s=t.target.value;q(s),f(w,c,s,o)},F=(t,s)=>{const m={...o,[t]:s};_(m),f(w,c,d,m)},z=()=>{A(""),q(""),_({from:"",to:""}),f(w,"","",{from:"",to:""})},X=t=>{p.current&&clearInterval(p.current),C(t),k(!0)},L=()=>{k(!1),C(null);const t=async()=>{try{if(typeof window.refreshSchedules=="function"){const s=await window.refreshSchedules();v(s),f(s,c,d,o)}}catch(s){console.error("Error refreshing schedule data:",s)}};p.current=setInterval(t,S)},G=(t,s)=>{typeof h=="function"?h(t,s):(console.error("onStatusUpdate prop is not a function"),alert("Error: Unable to update status. Please refresh the page and try again.")),L()},J=t=>{O(t)},R=t=>{try{return I(new Date(t),"yyyy-MM-dd")}catch(s){return console.error("Error formatting date:",s),"Invalid date"}},K=()=>{if(M(!b),b)j([]);else{const t=y.filter(s=>s.status==="pending").map(s=>s.id);j(t)}},Q=t=>{j(s=>s.includes(t)?s.filter(m=>m!==t):[...s,t])},W=()=>{if(u.length===0){alert("Please select at least one schedule change request");return}E(!0)},B=()=>{E(!1)},Y=(t,s)=>{if(typeof h=="function"){const m=u.map(i=>new Promise((n,a)=>{try{h(i,{status:t,remarks:s}),n()}catch(r){a(r)}}));Promise.all(m).then(()=>{j([]),M(!1)}).catch(i=>{console.error("Error during bulk update:",i)})}B()},Z=()=>{const t=new URLSearchParams;c&&t.append("status",c),d&&t.append("search",d),o.from&&t.append("from_date",o.from),o.to&&t.append("to_date",o.to);const s=`/change-off-schedules/export?${t.toString()}`;window.open(s,"_blank")},N=y.filter(t=>t.status==="pending").length;return e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden flex flex-col h-[62vh]",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Change Off Schedule Requests"}),e.jsxs("div",{className:"flex flex-wrap gap-2 w-full md:w-auto",children:[e.jsxs("button",{onClick:Z,className:"px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center",title:"Export to Excel",children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),"Export"]}),u.length>0&&e.jsxs("button",{onClick:W,className:"px-3 py-1 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:["Bulk Action (",u.length,")"]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("select",{id:"statusFilter",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:c,onChange:H,children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})})]})]}),e.jsxs("div",{className:"mt-4 flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ae,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search by name, ID, department, or reason",className:"pl-10 w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:d,onChange:V})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"fromDate",className:"mr-2 text-sm font-medium text-gray-700",children:"From:"}),e.jsx("input",{id:"fromDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:o.from,onChange:t=>F("from",t.target.value)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"toDate",className:"mr-2 text-sm font-medium text-gray-700",children:"To:"}),e.jsx("input",{id:"toDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:o.to,onChange:t=>F("to",t.target.value)})]}),(c||d||o.from||o.to)&&e.jsxs("button",{onClick:z,className:"px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md text-sm flex items-center",title:"Clear all filters",children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Clear"]})]})]})]}),e.jsx("div",{className:"overflow-auto flex-grow",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[N>0&&e.jsx("th",{scope:"col",className:"px-4 py-3 w-10",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:b&&u.length===N,onChange:K})}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Original Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Requested Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Filed Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:N>0?"7":"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No schedule change records found"})}):y.map(t=>{var s;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[N>0&&e.jsx("td",{className:"px-4 py-4",children:t.status==="pending"&&e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:u.includes(t.id),onChange:()=>Q(t.id)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.employee?`${t.employee.Lname}, ${t.employee.Fname}`:"Unknown employee"}),e.jsx("div",{className:"text-sm text-gray-500",children:((s=t.employee)==null?void 0:s.idno)||"N/A"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.original_date?R(t.original_date):"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.requested_date?R(t.requested_date):"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(ee,{status:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.created_at?I(new Date(t.created_at),"yyyy-MM-dd"):"N/A"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>X(t),className:"text-indigo-600 hover:text-indigo-900 mr-3",children:"View"}),t.status==="pending"&&e.jsx("button",{onClick:()=>J(t.id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},t.id)})})]})}),U&&D&&e.jsx(te,{schedule:D,onClose:L,onStatusUpdate:G}),$&&e.jsx(se,{selectedCount:u.length,onClose:B,onSubmit:Y})]})};export{xe as default};
