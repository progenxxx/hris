import{r as d,j as t,b as F}from"./app-7K62fd2B.js";import pe from"./StatusBadge-D5QqXJev.js";import he from"./TravelOrderDetailModal-CITm1qyR.js";import ge from"./MultiBulkActionModal-BHy1wDBD.js";import ye from"./TravelOrderForceApproveButton-BZjuOUN3.js";import{y as S}from"./index-DkMCAIk8.js";import{L as _}from"./loader-circle-CCcIPQox.js";import{M as we}from"./map-pin-BbSYCDVv.js";import{D as je}from"./download-DiYogtYp.js";import{S as be}from"./search-BmV-knWW.js";import{X as Ne}from"./x-4sBMcqny.js";import{C as ve}from"./calendar-CWo9dUpk.js";import{C as Se}from"./clock-r6FcyLKi.js";import{f as De}from"./format-Bw_hER4B.js";import"./user-BKBpk05w.js";import"./createLucideIcon-BK5csKvN.js";import"./building-D6co_3Ut.js";import"./car-HfwOmSbn.js";import"./info-CNKW5Dcc.js";import"./dollar-sign-kTFlta5J.js";import"./file-text-B0cEX_Vi.js";import"./triangle-alert-BFKAbd31.js";import"./circle-check-big-CdHds-fH.js";import"./circle-x-2rCUmP_B.js";import"./parseISO-CCIRmu7b.js";import"./clsx-B-dksMZM.js";import"./zap-B1geo600.js";const Oe=({travelOrders:b,onStatusUpdate:B,onDelete:$,refreshInterval:P=5e3,userRoles:u={},processing:n=!1})=>{const[L,H]=d.useState(null),[te,z]=d.useState(!1),[p,V]=d.useState(""),[D,C]=d.useState(b||[]),[T,w]=d.useState(b||[]),N=d.useRef(null),[l,x]=d.useState(!1),[k,q]=d.useState(null),[E,v]=d.useState(null),[M,X]=d.useState(!1),[h,G]=d.useState(""),[m,J]=d.useState({from:"",to:""}),[g,y]=d.useState([]),[se,K]=d.useState(!1),[U,Q]=d.useState(!1);d.useEffect(()=>{b&&(w(b),j(b,p,h,m))},[b]),d.useEffect(()=>{const e=async()=>{try{if(typeof window.refreshTravelOrders=="function"){const s=await window.refreshTravelOrders();w(s),j(s,p,h,m)}}catch(s){console.error("Error refreshing travel order data:",s)}};return!n&&!l&&(N.current=setInterval(e,P)),()=>{N.current&&clearInterval(N.current)}},[P,p,h,m,n,l]);const j=(e,s,a,r)=>{let o=[...e];if(s&&(o=o.filter(i=>i.status===s)),a){const i=a.toLowerCase();o=o.filter(c=>c.employee&&(c.employee.Fname&&c.employee.Fname.toLowerCase().includes(i)||c.employee.Lname&&c.employee.Lname.toLowerCase().includes(i))||c.employee&&c.employee.idno&&c.employee.idno.toString().includes(i)||c.employee&&c.employee.Department&&c.employee.Department.toLowerCase().includes(i)||c.destination&&c.destination.toLowerCase().includes(i)||c.purpose&&c.purpose.toLowerCase().includes(i))}return r.from&&r.to?o=o.filter(i=>{if(!i.start_date)return!1;const c=new Date(i.start_date),f=new Date(r.from),ee=new Date(r.to);return ee.setHours(23,59,59),c>=f&&c<=ee}):r.from?o=o.filter(i=>{if(!i.start_date)return!1;const c=new Date(i.start_date),f=new Date(r.from);return c>=f}):r.to&&(o=o.filter(i=>{if(!i.start_date)return!1;const c=new Date(i.start_date),f=new Date(r.to);return f.setHours(23,59,59),c<=f})),C(o),o},ae=e=>{if(n||l)return;const s=e.target.value;V(s),j(T,s,h,m)},re=e=>{if(n||l)return;const s=e.target.value;G(s),j(T,p,s,m)},R=(e,s)=>{if(n||l)return;const a={...m,[e]:s};J(a),j(T,p,h,a)},ne=()=>{n||l||(V(""),G(""),J({from:"",to:""}),j(T,"","",{from:"",to:""}))},le=e=>{n||l||(N.current&&clearInterval(N.current),H(e),z(!0))},I=()=>{if(z(!1),H(null),!n&&!l){const e=async()=>{try{if(typeof window.refreshTravelOrders=="function"){const s=await window.refreshTravelOrders();w(s),j(s,p,h,m)}}catch(s){console.error("Error refreshing travel order data:",s)}};N.current=setInterval(e,P)}},oe=async e=>{if(!(n||l||k)&&window.confirm("Are you sure you want to delete this travel order? This action cannot be undone.")){q(e),x(!0);try{if(typeof $=="function"){const s=$(e);s&&typeof s.then=="function"?(await s,w(a=>a.filter(r=>r.id!==e)),C(a=>a.filter(r=>r.id!==e)),y(a=>a.filter(r=>r!==e)),console.log("Travel order deleted successfully")):(w(a=>a.filter(r=>r.id!==e)),C(a=>a.filter(r=>r.id!==e)),y(a=>a.filter(r=>r!==e)))}else F.delete(route("travel-orders.destroy",e),{preserveScroll:!0,onSuccess:()=>{w(s=>s.filter(a=>a.id!==e)),C(s=>s.filter(a=>a.id!==e)),y(s=>s.filter(a=>a!==e)),console.log("Travel order deleted successfully"),S.success("Travel order deleted successfully")},onError:s=>{var a,r;console.error("Error deleting travel order:",s),(a=s==null?void 0:s.message)!=null&&a.includes("Method Not Allowed")||(r=s==null?void 0:s.message)!=null&&r.includes("DELETE")?F.post(route("travel-orders.destroy.post",e),{_method:"DELETE",preserveScroll:!0,onSuccess:()=>{w(o=>o.filter(i=>i.id!==e)),C(o=>o.filter(i=>i.id!==e)),y(o=>o.filter(i=>i!==e)),console.log("Travel order deleted successfully via POST"),S.success("Travel order deleted successfully")},onError:o=>{console.error("Error deleting travel order via POST:",o),S.error("Error: Failed to delete travel order. "+((o==null?void 0:o.message)||"Please try again."))}}):S.error("Error: Failed to delete travel order. "+((s==null?void 0:s.message)||"Please try again."))}})}catch(s){console.error("Error deleting travel order:",s),S.error("Error: Failed to delete travel order. Please try again.")}finally{q(null),x(!1)}}},ie=(e,s)=>{if(v(e),x(!0),typeof B=="function")try{const a=B(e,s);a&&typeof a.then=="function"?a.then(()=>{v(null),x(!1),I()}).catch(r=>{console.error("Error updating status:",r),alert("Error: Unable to update status. Please try again."),v(null),x(!1)}):(v(null),x(!1),I())}catch(a){console.error("Error updating status:",a),alert("Error: Unable to update status. Please try again."),v(null),x(!1)}else console.error("onStatusUpdate is not a function"),alert("Error: Unable to update status. Please refresh the page and try again."),v(null),x(!1)},W=e=>{try{return De(new Date(e),"yyyy-MM-dd")}catch(s){return console.error("Error formatting date:",s),"Invalid date"}},Y=e=>{if(!e)return"-";try{let s;if(e.includes("T")){const[,f]=e.split("T");s=f.slice(0,5)}else{const f=e.split(" ");s=f[f.length-1].slice(0,5)}const[a,r]=s.split(":"),o=parseInt(a,10),i=o>=12?"PM":"AM";return`${o%12||12}:${r} ${i}`}catch(s){return console.error("Time formatting error:",s),"-"}},ce=()=>{if(!(n||l))if(Q(!U),U)y([]);else{let e=[];(u.isHrdManager||u.isSuperAdmin)&&(e=D.filter(s=>s.status==="pending").map(s=>s.id)),y(e)}},de=e=>{n||l||y(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e])},me=()=>{if(g.length===0){alert("Please select at least one travel order");return}n||l||K(!0)},Z=()=>{K(!1)},ue=(e,s)=>{x(!0);const a={travel_order_ids:g,status:e,remarks:s};F.post(route("travel-orders.bulkUpdateStatus"),a,{preserveScroll:!0,onSuccess:r=>{y([]),Q(!1),F.reload({only:["travelOrders"],preserveScroll:!0,onFinish:()=>{x(!1)}})},onError:r=>{console.error("Error during bulk update:",r),S.error("Failed to update travel orders: "+((r==null?void 0:r.message)||"Unknown error")),x(!1)}}),Z()},xe=()=>{if(n||l||M)return;X(!0);const e=new URLSearchParams;p&&e.append("status",p),h&&e.append("search",h),m.from&&e.append("from_date",m.from),m.to&&e.append("to_date",m.to);const s=`/travel-orders/export?${e.toString()}`,a=document.createElement("a");a.href=s,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>{X(!1)},2e3)},O=e=>u.isSuperAdmin||u.isHrdManager?e.status==="pending":!1,A=D.filter(e=>O(e)).length,fe=()=>l||n?t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"h-4 w-4 mr-1 animate-spin"}),"Processing..."]}):`Bulk Action (${g.length})`;return t.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden flex flex-col h-[62vh] relative",children:[(n||l)&&t.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-40",children:t.jsxs("div",{className:"text-center",children:[t.jsx(_,{className:"h-8 w-8 animate-spin mx-auto mb-2 text-indigo-600"}),t.jsx("p",{className:"text-sm text-gray-600",children:n?"Processing travel orders...":"Updating data..."})]})}),t.jsxs("div",{className:"p-4 border-b",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0",children:[t.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[t.jsx(we,{className:"h-5 w-5 mr-2 text-indigo-600"}),"Travel Orders"]}),t.jsxs("div",{className:"flex flex-wrap gap-2 w-full md:w-auto",children:[t.jsx("button",{onClick:xe,className:"px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",title:"Export to Excel",disabled:M||n||l,children:M?t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"h-4 w-4 mr-1 animate-spin"}),"Exporting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(je,{className:"h-4 w-4 mr-1"}),"Export"]})}),u.isSuperAdmin&&t.jsx(ye,{selectedIds:g,disabled:n||l}),g.length>0&&t.jsx("button",{onClick:me,className:"px-3 py-1 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 flex items-center disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",disabled:n||l,children:fe()}),t.jsx("div",{className:"flex items-center",children:t.jsxs("select",{id:"statusFilter",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:p,onChange:ae,disabled:n||l,children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"approved",children:"Approved"}),t.jsx("option",{value:"rejected",children:"Rejected"}),t.jsx("option",{value:"completed",children:"Completed"}),t.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]})]}),t.jsxs("div",{className:"mt-4 flex flex-col md:flex-row gap-3",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(be,{className:"h-4 w-4 text-gray-400"})}),t.jsx("input",{type:"text",placeholder:"Search by name, ID, department, destination, or purpose",className:"pl-10 w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:h,onChange:re,disabled:n||l})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"fromDate",className:"mr-2 text-sm font-medium text-gray-700",children:"From:"}),t.jsx("input",{id:"fromDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:m.from,onChange:e=>R("from",e.target.value),disabled:n||l})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"toDate",className:"mr-2 text-sm font-medium text-gray-700",children:"To:"}),t.jsx("input",{id:"toDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:m.to,onChange:e=>R("to",e.target.value),disabled:n||l})]}),(p||h||m.from||m.to)&&t.jsxs("button",{onClick:ne,className:"px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md text-sm flex items-center disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",title:"Clear all filters",disabled:n||l,children:[t.jsx(Ne,{className:"h-4 w-4 mr-1"}),"Clear"]})]})]})]}),t.jsx("div",{className:"overflow-auto flex-grow",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:t.jsxs("tr",{children:[A>0&&t.jsx("th",{scope:"col",className:"px-4 py-3 w-10",children:t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:U&&g.length===A,onChange:ce,disabled:n||l})}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Travel Period"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Destination"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Duration"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Filed By"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:D.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:A>0?"9":"8",className:"px-6 py-4 text-center text-sm text-gray-500",children:n||l?"Loading travel orders...":"No travel orders found"})}):D.map(e=>{var s,a,r,o;return t.jsxs("tr",{className:`hover:bg-gray-50 transition-colors duration-200 ${k===e.id||E===e.id?"opacity-50":""}`,children:[A>0&&t.jsx("td",{className:"px-4 py-4",children:O(e)&&t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:g.includes(e.id),onChange:()=>de(e.id),disabled:n||l||k===e.id||E===e.id})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.employee?`${e.employee.Lname}, ${e.employee.Fname}`:"Unknown employee"}),t.jsx("div",{className:"text-sm text-gray-500",children:((s=e.employee)==null?void 0:s.idno)||"N/A"}),t.jsx("div",{className:"text-xs text-gray-400",children:((a=e.employee)==null?void 0:a.Department)||"No Dept"})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("div",{className:"text-sm text-gray-900 flex items-center",children:[t.jsx(ve,{className:"h-4 w-4 mr-1 text-gray-400"}),e.start_date?W(e.start_date):"N/A",e.end_date&&e.start_date!==e.end_date&&t.jsxs("span",{children:[" - ",W(e.end_date)]})]}),e.departure_time&&t.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[t.jsx(Se,{className:"h-3 w-3 mr-1 text-gray-400"}),Y(e.departure_time),e.return_time&&t.jsxs("span",{children:[" - ",Y(e.return_time)]})]})]}),t.jsxs("td",{className:"px-6 py-4",children:[t.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",title:e.destination,children:e.destination}),t.jsx("div",{className:"text-sm text-gray-500",children:e.transportation_type})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("div",{className:"text-sm text-gray-900",children:[e.total_days," day",e.total_days!==1?"s":""]}),t.jsxs("div",{className:"text-xs text-gray-500",children:[e.working_days," working day",e.working_days!==1?"s":""]})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex flex-col space-y-1",children:[t.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${e.is_full_day?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:e.is_full_day?"Full Day":"Partial Day"}),e.return_to_office&&t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Return to Office"}),e.force_approved&&t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:"Force Approved"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx(pe,{status:e.status})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.creator?e.creator.name:"N/A"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>le(e),className:"text-indigo-600 hover:text-indigo-900 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",disabled:n||l||E===e.id,children:"View"}),e.status==="pending"&&(u.isSuperAdmin||e.created_by===u.userId||u.isDepartmentManager&&((o=u.managedDepartments)==null?void 0:o.includes((r=e.employee)==null?void 0:r.Department)))&&t.jsx("button",{onClick:()=>oe(e.id),className:"text-red-600 hover:text-red-900 disabled:opacity-50 disabled:cursor-not-allowed flex items-center transition-colors duration-200",disabled:n||l||k===e.id,children:k===e.id?t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"h-3 w-3 mr-1 animate-spin"}),"Deleting..."]}):"Delete"})]})})]},e.id)})})]})}),t.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t text-sm text-gray-600",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:["Showing ",D.length," of ",T.length," travel orders",g.length>0&&t.jsxs("span",{className:"ml-4 text-indigo-600 font-medium",children:[g.length," selected"]})]}),(n||l)&&t.jsxs("div",{className:"flex items-center text-indigo-600",children:[t.jsx(_,{className:"h-4 w-4 animate-spin mr-1"}),t.jsx("span",{className:"text-xs",children:n?"Processing...":"Updating..."})]})]})}),te&&L&&t.jsx(he,{travelOrder:L,onClose:I,onStatusUpdate:ie,userRoles:u,viewOnly:n||l,processing:E===L.id}),se&&t.jsx(ge,{selectedCount:g,onClose:Z,onSubmit:ue,userRoles:u})]})};export{Oe as default};
