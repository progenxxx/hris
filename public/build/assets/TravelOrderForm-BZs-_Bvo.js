import{r as c,j as e}from"./app-C_ClQmDY.js";import{M as de}from"./map-pin-CbTR9kKl.js";import{L as R}from"./loader-circle-OBm8GvlE.js";import{C as le}from"./clock-CtBUUqYK.js";import{D as ce}from"./dollar-sign-EMsHpLE5.js";import{U as z}from"./upload-CTtdx_s7.js";import{F as me}from"./file-text-DMC5LN9m.js";import{X as ue}from"./x-Q1lJB2Tb.js";import{f as xe}from"./format-Ur_Fko9Q.js";import"./createLucideIcon-D1ADp28Z.js";const we=({employees:y,departments:J,transportationTypes:k,onSubmit:X})=>{const b=xe(new Date,"yyyy-MM-dd"),[a,j]=c.useState({employee_ids:[],start_date:b,end_date:b,departure_time:"08:00",return_time:"17:00",destination:"",transportation_type:k[0]||"",purpose:"",accommodation_required:!1,meal_allowance:!1,other_expenses:"",estimated_cost:"",return_to_office:!1,office_return_time:""}),[M,P]=c.useState([]),[U,E]=c.useState(!1),[o,$]=c.useState(!1),[K,N]=c.useState(""),[f,H]=c.useState(y||[]),[h,O]=c.useState(""),[_,A]=c.useState("");c.useEffect(()=>{let s=[],t=[],r=[],i=[],u=[],L=[];y.forEach(n=>{var D;const g=a.employee_ids.includes(n.id);let x=!0,m=!1;if(h){const l=h.toLowerCase().trim(),C=(n.Fname||"").toLowerCase(),F=(n.Lname||"").toLowerCase(),ie=(n.MName||"").toLowerCase(),oe=`${C} ${F}`.trim(),ne=`${F} ${C}`.trim(),S=(D=n.idno)==null?void 0:D.toString().toLowerCase(),I=(n.name||"").toLowerCase();C===l||F===l||oe===l||ne===l||I===l||S===l?(m=!0,x=!0):x=C.includes(l)||F.includes(l)||ie.includes(l)||I.includes(l)||(S==null?void 0:S.includes(l))}let w=!0;_&&(w=(n.department||n.Department||"")===_),w&&(g&&m?s.push(n):g&&x?t.push(n):g?r.push(n):m?i.push(n):x?u.push(n):h||L.push(n))});const p=(n,g)=>{const x=m=>{if(m.name)return m.name.toLowerCase();const w=m.Lname||"",D=m.Fname||"";return`${w}, ${D}`.toLowerCase()};return x(n).localeCompare(x(g))};s.sort(p),t.sort(p),r.sort(p),i.sort(p),u.sort(p),L.sort(p);const re=[...s,...t,...r,...i,...u,...L];H(re)},[h,_,y,a.employee_ids]);const d=s=>{const{name:t,value:r,type:i,checked:u}=s.target;j({...a,[t]:i==="checkbox"?u:r})},q=s=>{const t=parseInt(s,10);j(r=>r.employee_ids.includes(t)?{...r,employee_ids:r.employee_ids.filter(i=>i!==t)}:{...r,employee_ids:[...r.employee_ids,t]})},Q=(s,t)=>{s.stopPropagation(),q(t)},V=()=>{j(s=>{const t=f.map(i=>i.id);if(t.every(i=>s.employee_ids.includes(i)))return{...s,employee_ids:s.employee_ids.filter(i=>!t.includes(i))};{const i=s.employee_ids.filter(u=>!t.includes(u));return{...s,employee_ids:[...i,...t]}}})},W=s=>{const t=Array.from(s.target.files);B(t)},B=s=>{const t=s.filter(r=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/jpg","image/png"].includes(r.type)?r.size>5242880?(alert(`File ${r.name} is too large. Maximum size is 5MB.`),!1):!0:(alert(`File ${r.name} is not a valid type. Please upload PDF, DOC, DOCX, JPG, JPEG, or PNG files only.`),!1));P(r=>[...r,...t])},Y=s=>{P(t=>t.filter((r,i)=>i!==s))},T=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?E(!0):s.type==="dragleave"&&E(!1)},Z=s=>{if(s.preventDefault(),s.stopPropagation(),E(!1),s.dataTransfer.files&&s.dataTransfer.files[0]){const t=Array.from(s.dataTransfer.files);B(t)}},ee=s=>{if(s===0)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,i)).toFixed(2))+" "+r[i]},se=()=>{if(!a.start_date||!a.end_date)return{days:0,isMultiDay:!1};const s=new Date(a.start_date),t=new Date(a.end_date),r=Math.ceil((t-s)/(1e3*60*60*24))+1,i=r>1;return{days:r,isMultiDay:i}},te=async s=>{if(s.preventDefault(),!o){if(a.employee_ids.length===0){alert("Please select at least one employee");return}if(!a.start_date||!a.end_date){alert("Please fill in start and end dates");return}if(new Date(a.end_date)<new Date(a.start_date)){alert("End date must be on or after start date");return}if(!a.destination.trim()){alert("Please provide the destination");return}if(!a.purpose.trim()){alert("Please provide the purpose of travel");return}if(a.return_to_office&&!a.office_return_time){alert('Please specify office return time when "Return to Office" is checked');return}$(!0),N(`Processing travel order for ${a.employee_ids.length} employee${a.employee_ids.length>1?"s":""}...`);try{const t=new FormData;Object.keys(a).forEach(r=>{r==="employee_ids"?a[r].forEach(i=>{t.append("employee_ids[]",i)}):t.append(r,a[r])}),M.forEach((r,i)=>{t.append(`documents[${i}]`,r)}),await X(t),j({employee_ids:[],start_date:b,end_date:b,departure_time:"08:00",return_time:"17:00",destination:"",transportation_type:k[0]||"",purpose:"",accommodation_required:!1,meal_allowance:!1,other_expenses:"",estimated_cost:"",return_to_office:!1,office_return_time:""}),P([]),O(""),A(""),N("Travel orders submitted successfully!"),setTimeout(()=>{N("")},2e3)}catch(t){console.error("Error submitting travel order:",t),N("")}finally{$(!1)}window.scrollTo({top:0,behavior:"smooth"})}},G=f.length>0&&f.every(s=>a.employee_ids.includes(s.id)),ae=y.filter(s=>a.employee_ids.includes(s.id)),v=se();return e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(de,{className:"h-5 w-5 mr-2 text-indigo-600"}),"File New Travel Order"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Create travel order for one or multiple employees"})]}),o&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(R,{className:"h-8 w-8 animate-spin mx-auto mb-2 text-indigo-600"}),e.jsx("p",{className:"text-sm text-gray-600",children:K})]})}),e.jsxs("form",{onSubmit:te,className:"relative",children:[e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Select Employees"}),e.jsxs("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by name or ID",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:h,onChange:s=>O(s.target.value),disabled:o})}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:_,onChange:s=>A(s.target.value),disabled:o,children:[e.jsx("option",{value:"",children:"All Departments"}),J.map((s,t)=>e.jsx("option",{value:s,children:s},t))]})}),e.jsx("div",{className:"md:flex-initial",children:e.jsx("button",{type:"button",className:`w-full px-4 py-2 rounded-md ${G?"bg-indigo-700 hover:bg-indigo-800":"bg-indigo-500 hover:bg-indigo-600"} text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50`,onClick:V,disabled:o,children:G?"Deselect All":"Select All"})})]}),e.jsx("div",{className:"border rounded-md overflow-hidden max-h-60 overflow-y-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12",children:"Select"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Position"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-3 text-center text-sm text-gray-500",children:"No employees match your search criteria"})}):f.map(s=>{var t;return e.jsxs("tr",{className:`hover:bg-gray-50 cursor-pointer ${a.employee_ids.includes(s.id)?"bg-indigo-50":""} ${o?"opacity-50":""}`,onClick:()=>!o&&q(s.id),children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:a.employee_ids.includes(s.id),onChange:r=>Q(r,s.id),onClick:r=>r.stopPropagation(),disabled:o})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:s.idno}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s.Lname,", ",s.Fname," ",s.MName||""]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:((t=s.department)==null?void 0:t.name)||s.Department||"No Department"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:s.Jobtitle})]},s.id)})})]})}),e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:a.employee_ids.length>0?e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[a.employee_ids.length," employee(s) selected"]}),a.employee_ids.length<=5&&e.jsxs("span",{className:"ml-2",children:["(",ae.map(s=>s.Lname).join(", "),")"]})]}):e.jsx("span",{className:"text-yellow-600",children:"No employees selected"})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[e.jsx(le,{className:"h-4 w-4 mr-2 text-indigo-600"}),"Travel Details"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"start_date",className:"block text-sm font-medium text-gray-700 mb-1",children:["Start Date ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"date",id:"start_date",name:"start_date",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:a.start_date,onChange:d,disabled:o,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"end_date",className:"block text-sm font-medium text-gray-700 mb-1",children:["End Date ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"date",id:"end_date",name:"end_date",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:a.end_date,onChange:d,disabled:o,min:a.start_date,required:!0})]})]}),v.days>0&&e.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 p-2 rounded",children:[e.jsx("strong",{children:"Travel Duration:"})," ",v.days," day",v.days!==1?"s":"",v.isMultiDay&&e.jsx("span",{className:"text-blue-600 ml-2",children:"(Multi-day travel)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"departure_time",className:"block text-sm font-medium text-gray-700 mb-1",children:"Departure Time"}),e.jsx("input",{type:"time",id:"departure_time",name:"departure_time",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:a.departure_time,onChange:d,disabled:o})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"return_time",className:"block text-sm font-medium text-gray-700 mb-1",children:"Return Time"}),e.jsx("input",{type:"time",id:"return_time",name:"return_time",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:a.return_time,onChange:d,disabled:o})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"destination",className:"block text-sm font-medium text-gray-700 mb-1",children:["Destination ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",id:"destination",name:"destination",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:a.destination,onChange:d,disabled:o,placeholder:"Enter travel destination",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"transportation_type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Transportation Type"}),e.jsx("select",{id:"transportation_type",name:"transportation_type",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:a.transportation_type,onChange:d,disabled:o,children:k.map((s,t)=>e.jsx("option",{value:s,children:s},t))})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Return to Office"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"return_to_office",name:"return_to_office",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:a.return_to_office,onChange:d,disabled:o}),e.jsx("label",{htmlFor:"return_to_office",className:"ml-2 text-sm text-gray-700",children:"Employee will return to office after travel"})]}),a.return_to_office&&e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"office_return_time",className:"block text-sm font-medium text-gray-700 mb-1",children:["Office Return Time ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"time",id:"office_return_time",name:"office_return_time",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:a.office_return_time,onChange:d,disabled:o,required:a.return_to_office}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"This affects whether the travel is counted as full day or partial day"})]}),e.jsxs("div",{className:"text-sm text-gray-600 bg-yellow-50 p-2 rounded",children:[e.jsx("strong",{children:"Day Counting Logic:"}),e.jsx("br",{}),"• Travel of 5+ hours = Full day",e.jsx("br",{}),"• Return to office with 3+ hours work = Partial day",e.jsx("br",{}),"• Travel before 9 AM or after 3 PM = Full day"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Purpose & Expenses"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"purpose",className:"block text-sm font-medium text-gray-700 mb-1",children:["Purpose of Travel ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{id:"purpose",name:"purpose",rows:"3",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",placeholder:"Provide detailed purpose for the travel",value:a.purpose,onChange:d,disabled:o,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"accommodation_required",name:"accommodation_required",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:a.accommodation_required,onChange:d,disabled:o}),e.jsx("label",{htmlFor:"accommodation_required",className:"ml-2 text-sm text-gray-700",children:"Accommodation Required"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"meal_allowance",name:"meal_allowance",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:a.meal_allowance,onChange:d,disabled:o}),e.jsx("label",{htmlFor:"meal_allowance",className:"ml-2 text-sm text-gray-700",children:"Meal Allowance"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"estimated_cost",className:"block text-sm font-medium text-gray-700 mb-1 flex items-center",children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Estimated Cost"]}),e.jsx("input",{type:"number",id:"estimated_cost",name:"estimated_cost",step:"0.01",min:"0",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:a.estimated_cost,onChange:d,disabled:o,placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"other_expenses",className:"block text-sm font-medium text-gray-700 mb-1",children:"Other Expenses"}),e.jsx("textarea",{id:"other_expenses",name:"other_expenses",rows:"2",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",placeholder:"List any other anticipated expenses",value:a.other_expenses,onChange:d,disabled:o})]})]})]}),e.jsxs("div",{className:"md:col-span-2 bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[e.jsx(z,{className:"h-4 w-4 mr-2 text-indigo-600"}),"Supporting Documents"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Upload supporting documents (PDF, DOC, DOCX, JPG, PNG - Max 5MB each)"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${U?"border-indigo-400 bg-indigo-50":"border-gray-300 hover:border-gray-400"} ${o?"opacity-50 pointer-events-none":""}`,onDragEnter:T,onDragLeave:T,onDragOver:T,onDrop:Z,children:[e.jsx(z,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"mt-2 block text-sm font-medium text-gray-900",children:"Drop files here or click to browse"}),e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",multiple:!0,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",onChange:W,disabled:o})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"PDF, DOC, DOCX, JPG, PNG up to 5MB each"})]})]}),M.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Selected Documents:"}),e.jsx("div",{className:"space-y-2",children:M.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded border",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:ee(s.size)})]})]}),e.jsx("button",{type:"button",onClick:()=>Y(t),className:"text-red-500 hover:text-red-700 disabled:opacity-50",disabled:o,children:e.jsx(ue,{className:"h-4 w-4"})})]},t))})]})]})]}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6 border-t",children:e.jsx("button",{type:"submit",className:"inline-flex justify-center items-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):"Submit Travel Order"})})]})]})};export{we as default};
