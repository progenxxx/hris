import{r as d,j as t,b as V}from"./app-D-TNKEQL.js";import re from"./OffsetStatusBadge-BiVpKBqd.js";import ae from"./OffsetDetailModal-CQNvpX0r.js";import ne from"./OffsetBulkActionModal-BWRQ9tYi.js";import oe from"./OffsetForceApproveButton-C-El1pit.js";import{y as N}from"./index-D8OgU6sH.js";import{D as le}from"./download-Dnq6PCPG.js";import{S as ie}from"./search-DZDiwkir.js";import{X as ce}from"./x-fQrOvEob.js";import{f as de}from"./format-Bw_hER4B.js";import"./zap-1mqeF5Zv.js";import"./createLucideIcon-DEWnkTLV.js";import"./clsx-B-dksMZM.js";const De=({offsets:g,onStatusUpdate:C,onDelete:pe,userRoles:i={}})=>{const[A,O]=d.useState(null),[z,E]=d.useState(!1),[u,M]=d.useState(""),[b,F]=d.useState(g||[]),[h,S]=d.useState(g||[]),[D,f]=d.useState(!1),[x,L]=d.useState(""),[c,B]=d.useState({from:"",to:""}),[p,w]=d.useState([]),[W,_]=d.useState(!1),[k,q]=d.useState(!1);d.useEffect(()=>{g&&(S(g),y(g,u,x,c))},[g]);const y=(e,s,n,r)=>{let l=[...e];if(s&&(l=l.filter(o=>o.status===s)),n){const o=n.toLowerCase();l=l.filter(a=>a.employee&&(a.employee.Fname&&a.employee.Fname.toLowerCase().includes(o)||a.employee.Lname&&a.employee.Lname.toLowerCase().includes(o))||a.employee&&a.employee.idno&&a.employee.idno.toString().includes(o)||a.employee&&a.employee.Department&&a.employee.Department.toLowerCase().includes(o)||a.reason&&a.reason.toLowerCase().includes(o))}return r.from&&r.to?l=l.filter(o=>{if(!o.date)return!1;const a=new Date(o.date),m=new Date(r.from),j=new Date(r.to);return j.setHours(23,59,59),a>=m&&a<=j}):r.from?l=l.filter(o=>{if(!o.date)return!1;const a=new Date(o.date),m=new Date(r.from);return a>=m}):r.to&&(l=l.filter(o=>{if(!o.date)return!1;const a=new Date(o.date),m=new Date(r.to);return m.setHours(23,59,59),a<=m})),F(l),l},X=e=>{const s=e.target.value;M(s),y(h,s,x,c)},G=e=>{const s=e.target.value;L(s),y(h,u,s,c)},I=(e,s)=>{const n={...c,[e]:s};B(n),y(h,u,x,n)},J=()=>{M(""),L(""),B({from:"",to:""}),y(h,"","",{from:"",to:""})},K=e=>{O(e),E(!0)},T=()=>{E(!1),O(null)},Q=(e,s)=>{typeof C=="function"&&C(e,s),T()},Y=e=>{confirm("Are you sure you want to delete this offset request?")&&(f(!0),V.post(route("offsets.destroy",e),{_method:"DELETE"},{preserveScroll:!0,onSuccess:()=>{N.success("Offset request deleted successfully");const s=h.filter(n=>n.id!==e);S(s),F(n=>n.filter(r=>r.id!==e)),p.includes(e)&&w(n=>n.filter(r=>r!==e)),f(!1)},onError:s=>{console.error("Error deleting:",s),N.error("Failed to delete offset request"),f(!1)}}))},U=e=>{try{return de(new Date(e),"yyyy-MM-dd")}catch(s){return console.error("Error formatting date:",s),"Invalid date"}},Z=()=>{if(q(!k),k)w([]);else{let e=[];(i.isDepartmentManager||i.isHrdManager||i.isSuperAdmin)&&(e=b.filter(s=>s.status==="pending").map(s=>s.id)),w(e)}},R=e=>{w(s=>s.includes(e)?s.filter(n=>n!==e):[...s,e])},ee=()=>{if(p.length===0){alert("Please select at least one offset request");return}_(!0)},$=()=>{_(!1)},te=(e,s)=>{f(!0);const n={offset_ids:p,status:e,remarks:s};V.post(route("offsets.bulkUpdateStatus"),n,{preserveScroll:!0,onSuccess:r=>{var o,a;const l=h.map(m=>{var j,P;return p.includes(m.id)?{...m,status:e,remarks:s,approved_at:new Date().toISOString(),approver:(P=(j=r.props)==null?void 0:j.auth)!=null&&P.user?{id:r.props.auth.user.id,name:r.props.auth.user.name}:null}:m});S(l),y(l,u,x,c),(a=(o=r.props)==null?void 0:o.flash)!=null&&a.message?N.success(r.props.flash.message):N.success(`Successfully ${e} ${p.length} offset requests`),w([]),q(!1),$(),f(!1)},onError:r=>{console.error("Error during bulk update:",r),N.error("Failed to update offset requests"),f(!1)}})},se=()=>{const e=new URLSearchParams;u&&e.append("status",u),x&&e.append("search",x),c.from&&e.append("from_date",c.from),c.to&&e.append("to_date",c.to);const s=`/offsets/export?${e.toString()}`;window.open(s,"_blank")},H=e=>{var s,n;return i.isSuperAdmin||i.isHrdManager?e.status==="pending":i.isDepartmentManager?e.status==="pending"&&((n=i.managedDepartments)==null?void 0:n.includes((s=e.employee)==null?void 0:s.Department)):!1},v=b.filter(e=>H(e)).length;return t.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden flex flex-col h-[62vh]",children:[t.jsxs("div",{className:"p-4 border-b",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Offset Requests"}),t.jsxs("div",{className:"flex flex-wrap gap-2 w-full md:w-auto",children:[t.jsxs("button",{onClick:se,className:"px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center",title:"Export to Excel",children:[t.jsx(le,{className:"h-4 w-4 mr-1"}),"Export"]}),i.isSuperAdmin&&t.jsx(oe,{selectedIds:p,disabled:D}),p.length>0&&t.jsxs("button",{onClick:ee,className:"px-3 py-1 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",disabled:D,children:["Bulk Action (",p.length,")"]}),t.jsx("div",{className:"flex items-center",children:t.jsxs("select",{id:"statusFilter",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:u,onChange:X,children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"approved",children:"Approved"}),t.jsx("option",{value:"rejected",children:"Rejected"})]})})]})]}),t.jsxs("div",{className:"mt-4 flex flex-col md:flex-row gap-3",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(ie,{className:"h-4 w-4 text-gray-400"})}),t.jsx("input",{type:"text",placeholder:"Search by name, ID, department, or reason",className:"pl-10 w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:x,onChange:G})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"fromDate",className:"mr-2 text-sm font-medium text-gray-700",children:"From:"}),t.jsx("input",{id:"fromDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:c.from,onChange:e=>I("from",e.target.value)})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"toDate",className:"mr-2 text-sm font-medium text-gray-700",children:"To:"}),t.jsx("input",{id:"toDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:c.to,onChange:e=>I("to",e.target.value)})]}),(u||x||c.from||c.to)&&t.jsxs("button",{onClick:J,className:"px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md text-sm flex items-center",title:"Clear all filters",children:[t.jsx(ce,{className:"h-4 w-4 mr-1"}),"Clear"]})]})]})]}),t.jsx("div",{className:"overflow-auto flex-grow",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:t.jsxs("tr",{children:[v>0&&t.jsx("th",{scope:"col",className:"px-4 py-3 w-10",children:t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:k&&p.length===v,onChange:Z})}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Workday"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hours"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transaction"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Approved By"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:v>0?"10":"9",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No offset records found"})}):b.map(e=>{var s,n,r,l;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[v>0&&t.jsx("td",{className:"px-4 py-4",children:H(e)&&t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:p.includes(e.id),onChange:()=>R(e.id)})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.employee?`${e.employee.Lname}, ${e.employee.Fname}`:"Unknown employee"}),t.jsx("div",{className:"text-sm text-gray-500",children:((s=e.employee)==null?void 0:s.idno)||"N/A"})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((n=e.offset_type)==null?void 0:n.name)||"N/A"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:e.date?U(e.date):"N/A"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:e.workday?U(e.workday):"N/A"})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.hours," hrs"]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${e.transaction_type==="credit"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:e.transaction_type==="credit"?"Credit":"Debit"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx(re,{status:e.status})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.approver?e.approver.name:"N/A"}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[t.jsx("button",{onClick:()=>K(e),className:"text-indigo-600 hover:text-indigo-900 mr-3",children:"View"}),e.status==="pending"&&(i.isSuperAdmin||e.employee_id===i.employeeId||i.isDepartmentManager&&((l=i.managedDepartments)==null?void 0:l.includes((r=e.employee)==null?void 0:r.Department)))&&t.jsx("button",{onClick:()=>Y(e.id),className:"text-red-600 hover:text-red-900",disabled:D,children:"Delete"})]})]},e.id)})})]})}),z&&A&&t.jsx(ae,{offset:A,onClose:T,onStatusUpdate:Q,userRoles:i}),W&&t.jsx(ne,{selectedCount:p.length,onClose:$,onSubmit:te,userRoles:i})]})};export{De as default};
