import{r as c,j as t,h as $}from"./app-C_ClQmDY.js";import Le from"./OvertimeStatusBadge-BanjKh1O.js";import Ie from"./OvertimeDetailModal-DxzVgFQO.js";import{P as T,O as $e}from"./OvertimeRateEditModal-C6Hn-tuU.js";import Te from"./MultiBulkActionModal-BnXvkmd5.js";import Pe from"./ForceApproveButton-O2Q15huv.js";import{y as v}from"./index-CBJp45S4.js";import{L as A}from"./loader-circle-OBm8GvlE.js";import{D as Ue}from"./download-BQI3-SNa.js";import{S as Be}from"./search-BDKFcNkb.js";import{X as He}from"./x-Q1lJB2Tb.js";import{f as qe}from"./format-Ur_Fko9Q.js";import"./createLucideIcon-D1ADp28Z.js";import"./triangle-alert-BvRbjIm5.js";import"./clsx-B-dksMZM.js";import"./zap-BqYNij_k.js";const lt=({overtimes:D,onStatusUpdate:R,onDelete:Re,refreshInterval:F=5e3,userRoles:l={},processing:r=!1})=>{const[P,W]=c.useState(null),[ce,z]=c.useState(!1),[V,X]=c.useState(!1),[Y,G]=c.useState(null),[x,J]=c.useState(""),[h,K]=c.useState(""),[j,ue]=c.useState(D||[]),[N,_]=c.useState(D||[]),b=c.useRef(null),[n,m]=c.useState(!1),[M,U]=c.useState(null),[E,S]=c.useState(null),[B,Q]=c.useState(!1),[g,Z]=c.useState(""),[u,ee]=c.useState({from:"",to:""}),[y,C]=c.useState([]),[me,te]=c.useState(!1),[H,q]=c.useState(!1),ae={regular_weekday:"Regular Weekday",rest_day:"Rest Day",scheduled_rest_day:"Scheduled Rest Day",regular_holiday:"Regular Holiday",special_holiday:"Special Holiday",emergency_work:"Emergency Work",extended_shift:"Extended Shift",weekend_work:"Weekend Work",night_shift:"Night Shift",other:"Other"};c.useEffect(()=>{D&&(_(D),w(D,x,h,g,u),C([]),q(!1))},[D]),c.useEffect(()=>{const e=async()=>{try{if(typeof window.refreshOvertimes=="function"){const a=await window.refreshOvertimes();_(a),w(a,x,h,g,u)}}catch(a){console.error("Error refreshing overtime data:",a)}};return!r&&!n&&(b.current=setInterval(e,F)),()=>{b.current&&clearInterval(b.current)}},[F,x,h,g,u,r,n]);const w=(e,a,s,o,f)=>{let p=[...e];if(a&&(p=p.filter(d=>d.status===a)),s&&(p=p.filter(d=>d.overtime_type===s)),o){const d=o.toLowerCase();p=p.filter(i=>i.employee&&(i.employee.Fname&&i.employee.Fname.toLowerCase().includes(d)||i.employee.Lname&&i.employee.Lname.toLowerCase().includes(d))||i.employee&&i.employee.idno&&i.employee.idno.toString().includes(d)||i.employee&&i.employee.Department&&i.employee.Department.toLowerCase().includes(d)||i.reason&&i.reason.toLowerCase().includes(d)||i.overtime_type&&i.overtime_type.toLowerCase().includes(d))}return f.from&&f.to?p=p.filter(d=>{if(!d.date)return!1;const i=new Date(d.date),k=new Date(f.from),de=new Date(f.to);return de.setHours(23,59,59),i>=k&&i<=de}):f.from?p=p.filter(d=>{if(!d.date)return!1;const i=new Date(d.date),k=new Date(f.from);return i>=k}):f.to&&(p=p.filter(d=>{if(!d.date)return!1;const i=new Date(d.date),k=new Date(f.to);return k.setHours(23,59,59),i<=k})),ue(p),p},pe=e=>{if(r||n)return;const a=e.target.value;J(a),w(N,a,h,g,u)},fe=e=>{if(r||n)return;const a=e.target.value;K(a),w(N,x,a,g,u)},xe=e=>{if(r||n)return;const a=e.target.value;Z(a),w(N,x,h,a,u)},se=(e,a)=>{if(r||n)return;const s={...u,[e]:a};ee(s),w(N,x,h,g,s)},he=()=>{r||n||(J(""),K(""),Z(""),ee({from:"",to:""}),w(N,"","","",{from:"",to:""}))},ge=e=>{var a;return ae[e]||((a=e==null?void 0:e.replace("_"," "))==null?void 0:a.replace(/\b\w/g,s=>s.toUpperCase()))||"Unknown"},ye=e=>{let a=ge(e.overtime_type);return e.has_night_differential&&(a+=" (Night Diff.)"),a},we=()=>{console.log("Starting refresh..."),m(!0),$.reload({only:["overtimes"],preserveScroll:!0,preserveState:!0,onBefore:()=>{console.log("About to reload...")},onStart:()=>{console.log("Reload started...")},onSuccess:e=>{console.log("Refresh successful, new data:",e.props),m(!1),v.success("Data refreshed successfully")},onError:e=>{console.error("Error refreshing data:",e),v.error("Failed to refresh data"),m(!1)},onFinish:()=>{console.log("Refresh finished"),m(!1)}})},be=e=>{r||n||(b.current&&clearInterval(b.current),W(e),z(!0))},re=()=>{if(z(!1),W(null),!r&&!n){const e=async()=>{try{if(typeof window.refreshOvertimes=="function"){const a=await window.refreshOvertimes();_(a),w(a,x,h,g,u)}}catch(a){console.error("Error refreshing overtime data:",a)}};b.current=setInterval(e,F)}},ne=e=>{if(r||n)return;if(e.status!=="pending"){v.warning("Rate can only be edited for pending overtime requests");return}if(!(l.isSuperAdmin||l.isHrdManager||l.isDepartmentManager||e.created_by===l.userId)){v.error("You do not have permission to edit this overtime rate");return}b.current&&clearInterval(b.current),G(e),X(!0)},je=(e=!1)=>{if(X(!1),G(null),e&&we(),!r&&!n){const a=async()=>{try{if(typeof window.refreshOvertimes=="function"){const s=await window.refreshOvertimes();_(s),w(s,x,h,g,u)}}catch(s){console.error("Error refreshing overtime data:",s)}};b.current=setInterval(a,F)}},Ne=(e,a)=>{a.target.closest("button")||a.target.closest('input[type="checkbox"]')||e.status==="pending"&&ne(e)},L=e=>e.status!=="pending"?!1:l.isSuperAdmin||l.isHrdManager||l.isDepartmentManager||e.created_by===l.userId,O=e=>e.rate_edited===!0||e.rate_edited===1,ve=e=>{const a="transition-colors duration-200",s=M===e.id||E===e.id?"opacity-50":"";return O(e)?`${a} ${s} bg-red-50 border-l-4 border-red-400 hover:bg-red-100`:L(e)?`${a} ${s} hover:bg-blue-50 cursor-pointer`:`${a} ${s} hover:bg-gray-50`},De=(e,a)=>{if(S(e),m(!0),typeof R=="function")try{const s=R(e,a);s&&typeof s.then=="function"?s.then(()=>{S(null),m(!1)}).catch(o=>{console.error("Error updating status:",o),alert("Error: Unable to update status. Please try again."),S(null),m(!1)}):(S(null),m(!1))}catch(s){console.error("Error updating status:",s),alert("Error: Unable to update status. Please try again."),S(null),m(!1)}else console.error("onStatusUpdate prop is not a function"),alert("Error: Unable to update status. Please refresh the page and try again."),S(null),m(!1);re()},Se=e=>{confirm("Are you sure you want to delete this overtime request?")&&(U(e),m(!0),$.post(route("overtimes.destroy.post",e),{},{preserveScroll:!0,onSuccess:a=>{const s=N.filter(o=>o.id!==e);_(s),w(s,x,h,g,u),v.success("Overtime deleted successfully"),U(null),m(!1)},onError:a=>{console.error("Error deleting overtime:",a),v.error("Failed to delete overtime"),U(null),m(!1)}}))},ke=e=>{try{return qe(new Date(e),"yyyy-MM-dd")}catch(a){return console.error("Error formatting date:",a),"Invalid date"}},le=e=>{if(!e)return"-";try{let a;if(e.includes("T")){const[,i]=e.split("T");a=i.slice(0,5)}else{const i=e.split(" ");a=i[i.length-1].slice(0,5)}const[s,o]=a.split(":"),f=parseInt(s,10),p=f>=12?"PM":"AM";return`${f%12||12}:${o} ${p}`}catch(a){return console.error("Time formatting error:",a),"-"}},_e=()=>{if(!(r||n))if(q(!H),H)C([]);else{let e=[];l.isDepartmentManager?e=j.filter(a=>{var s,o;return a.status==="pending"&&(a.dept_manager_id===l.userId||((o=l.managedDepartments)==null?void 0:o.includes((s=a.employee)==null?void 0:s.Department)))}).map(a=>a.id):l.isHrdManager?e=j.filter(a=>a.status==="manager_approved").map(a=>a.id):l.isSuperAdmin&&(e=j.filter(a=>a.status==="pending"||a.status==="manager_approved").map(a=>a.id)),C(e)}},Ee=e=>{r||n||C(a=>a.includes(e)?a.filter(s=>s!==e):[...a,e])},Ce=()=>{if(y.length===0){alert("Please select at least one overtime request");return}r||n||te(!0)},ie=()=>{te(!1)},Oe=(e,a)=>{m(!0);const s={overtime_ids:y,status:e,remarks:a};$.post(route("overtimes.bulkUpdateStatus"),s,{preserveScroll:!0,onSuccess:o=>{C([]),q(!1),$.reload({only:["overtimes"],preserveScroll:!0,onFinish:()=>{m(!1)}})},onError:o=>{console.error("Error during bulk update:",o),v.error("Failed to update overtime requests: "+((o==null?void 0:o.message)||"Unknown error")),m(!1)}}),ie()},Ae=()=>{if(r||n||B)return;Q(!0);const e=new URLSearchParams;x&&e.append("status",x),h&&e.append("overtime_type",h),g&&e.append("search",g),u.from&&e.append("from_date",u.from),u.to&&e.append("to_date",u.to);const a=`/overtimes/export?${e.toString()}`,s=document.createElement("a");s.href=a,s.target="_blank",document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(()=>{Q(!1)},2e3)},oe=e=>{var a,s;return l.isSuperAdmin?e.status==="pending"||e.status==="manager_approved":l.isDepartmentManager?e.status==="pending"&&(e.dept_manager_id===l.userId||((s=l.managedDepartments)==null?void 0:s.includes((a=e.employee)==null?void 0:a.Department))):l.isHrdManager?e.status==="manager_approved":!1},I=j.filter(e=>oe(e)).length,Fe=l.isDepartmentManager?"department":"hrd",Me=()=>n||r?t.jsxs(t.Fragment,{children:[t.jsx(A,{className:"h-4 w-4 mr-1 animate-spin"}),"Processing..."]}):`Bulk Action (${y.length})`;return t.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden flex flex-col h-[62vh] relative",children:[(r||n)&&t.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-40",children:t.jsxs("div",{className:"text-center",children:[t.jsx(A,{className:"h-8 w-8 animate-spin mx-auto mb-2 text-indigo-600"}),t.jsx("p",{className:"text-sm text-gray-600",children:r?"Processing overtime requests...":"Updating data..."})]})}),t.jsxs("div",{className:"p-4 border-b",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Overtime Requests"}),t.jsxs("div",{className:"flex flex-wrap gap-2 w-full md:w-auto",children:[t.jsx("button",{onClick:Ae,className:"px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",title:"Export to Excel",disabled:B||r||n,children:B?t.jsxs(t.Fragment,{children:[t.jsx(A,{className:"h-4 w-4 mr-1 animate-spin"}),"Exporting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Ue,{className:"h-4 w-4 mr-1"}),"Export"]})}),l.isSuperAdmin&&t.jsx(Pe,{selectedIds:y,disabled:r||n}),y.length>0&&t.jsx("button",{onClick:Ce,className:"px-3 py-1 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 flex items-center disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",disabled:r||n,children:Me()}),t.jsx("div",{className:"flex items-center",children:t.jsxs("select",{id:"statusFilter",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:x,onChange:pe,disabled:r||n,children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"manager_approved",children:"Dept. Approved"}),t.jsx("option",{value:"approved",children:"Approved"}),t.jsx("option",{value:"rejected",children:"Rejected"})]})}),t.jsx("div",{className:"flex items-center",children:t.jsxs("select",{id:"overtimeTypeFilter",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:h,onChange:fe,disabled:r||n,children:[t.jsx("option",{value:"",children:"All Types"}),Object.entries(ae).map(([e,a])=>t.jsx("option",{value:e,children:a},e))]})})]})]}),t.jsxs("div",{className:"mt-4 flex flex-col md:flex-row gap-3",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(Be,{className:"h-4 w-4 text-gray-400"})}),t.jsx("input",{type:"text",placeholder:"Search by name, ID, department, or reason",className:"pl-10 w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:g,onChange:xe,disabled:r||n})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"fromDate",className:"mr-2 text-sm font-medium text-gray-700",children:"From:"}),t.jsx("input",{id:"fromDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:u.from,onChange:e=>se("from",e.target.value),disabled:r||n})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"toDate",className:"mr-2 text-sm font-medium text-gray-700",children:"To:"}),t.jsx("input",{id:"toDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:u.to,onChange:e=>se("to",e.target.value),disabled:r||n})]}),(x||h||g||u.from||u.to)&&t.jsxs("button",{onClick:he,className:"px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md text-sm flex items-center disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",title:"Clear all filters",disabled:r||n,children:[t.jsx(He,{className:"h-4 w-4 mr-1"}),"Clear"]})]})]})]}),t.jsx("div",{className:"overflow-auto flex-grow",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:t.jsxs("tr",{children:[I>0&&t.jsx("th",{scope:"col",className:"px-4 py-3 w-10",children:t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:H&&y.length===I,onChange:_e,disabled:r||n})}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hours"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rate"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Filed By"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:I>0?"9":"8",className:"px-6 py-4 text-center text-sm text-gray-500",children:r||n?"Loading overtime records...":"No overtime records found"})}):j.map(e=>{var a,s,o;return t.jsxs("tr",{className:ve(e),onDoubleClick:f=>Ne(e,f),title:O(e)?`Rate edited on ${e.rate_edited_at?new Date(e.rate_edited_at).toLocaleString():"Unknown date"}${e.rateEditor?` by ${e.rateEditor.name}`:""}`:L(e)?"Double-click to edit rate":"",children:[I>0&&t.jsx("td",{className:"px-4 py-4",children:oe(e)&&t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:y.includes(e.id),onChange:()=>Ee(e.id),disabled:r||n||M===e.id||E===e.id})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.employee?`${e.employee.Lname}, ${e.employee.Fname}`:"Unknown employee"}),t.jsx("div",{className:"text-sm text-gray-500",children:((a=e.employee)==null?void 0:a.idno)||"N/A"})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm text-gray-900",children:e.date?ke(e.date):"N/A"}),t.jsx("div",{className:"text-sm text-gray-500",children:e.start_time&&e.end_time?`${le(e.start_time)} - ${le(e.end_time)}`:"N/A"})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.total_hours!==void 0?parseFloat(e.total_hours).toFixed(2):"N/A"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:ye(e)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:`text-sm ${O(e)?"text-red-700 font-medium":"text-gray-900"}`,children:e.rate_multiplier?`${e.rate_multiplier}x`:"N/A"}),O(e)&&t.jsxs("div",{className:"flex items-center ml-2",children:[t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"EDITED"}),t.jsx(T,{className:"h-3 w-3 text-red-500 ml-1"})]}),!O(e)&&L(e)&&t.jsx(T,{className:"h-3 w-3 text-blue-500 ml-1 opacity-60",title:"Double-click to edit"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx(Le,{status:e.status})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.creator?e.creator.name:"N/A"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>be(e),className:"text-indigo-600 hover:text-indigo-900 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",disabled:r||n||E===e.id,children:"View"}),L(e)&&t.jsxs("button",{onClick:f=>{f.stopPropagation(),ne(e)},className:"text-blue-600 hover:text-blue-900 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center",disabled:r||n||E===e.id,title:"Edit Rate",children:[t.jsx(T,{className:"h-3 w-3 mr-1"}),"Rate"]}),e.status==="pending"&&(l.isSuperAdmin||e.created_by===l.userId||l.isDepartmentManager&&(e.dept_manager_id===l.userId||((o=l.managedDepartments)==null?void 0:o.includes((s=e.employee)==null?void 0:s.Department))))&&t.jsx("button",{onClick:()=>Se(e.id),className:"text-red-600 hover:text-red-900 disabled:opacity-50 disabled:cursor-not-allowed flex items-center transition-colors duration-200",disabled:r||n||M===e.id,children:M===e.id?t.jsxs(t.Fragment,{children:[t.jsx(A,{className:"h-3 w-3 mr-1 animate-spin"}),"Deleting..."]}):"Delete"})]})})]},e.id)})})]})}),t.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t text-sm text-gray-600",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:["Showing ",j.length," of ",N.length," overtime requests",y.length>0&&t.jsxs("span",{className:"ml-4 text-indigo-600 font-medium",children:[y.length," selected"]})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"flex items-center text-xs text-blue-600",children:[t.jsx(T,{className:"h-3 w-3 mr-1"}),t.jsx("span",{children:"Double-click pending rows to edit rate"})]}),(r||n)&&t.jsxs("div",{className:"flex items-center text-indigo-600",children:[t.jsx(A,{className:"h-4 w-4 animate-spin mr-1"}),t.jsx("span",{className:"text-xs",children:r?"Processing...":"Updating..."})]})]})]})}),ce&&P&&t.jsx(Ie,{overtime:P,onClose:re,onStatusUpdate:De,userRoles:l,viewOnly:r||n,processing:E===P.id}),V&&Y&&t.jsx($e,{isOpen:V,onClose:je,overtime:Y,userRoles:l,processing:r||n}),me&&t.jsx(Te,{selectedCount:y,onClose:ie,onSubmit:Oe,approvalLevel:Fe,userRoles:l})]})};export{lt as default};
