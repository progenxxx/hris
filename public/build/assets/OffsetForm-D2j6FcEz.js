import{r as d,j as e}from"./app-D-TNKEQL.js";import{L as S}from"./loader-circle-D5iasq1K.js";import{f as C}from"./format-Bw_hER4B.js";import"./createLucideIcon-DEWnkTLV.js";const P=({employees:h,offsetTypes:u,departments:N,onSubmit:w})=>{const m=C(new Date,"yyyy-MM-dd"),[t,x]=d.useState({employee_id:"",offset_type_id:"",date:m,workday:m,hours:"",reason:"",transaction_type:"credit"}),[r,f]=d.useState(!1),[p,v]=d.useState([]),[o,g]=d.useState(""),[l,y]=d.useState(""),[a,b]=d.useState(null);d.useEffect(()=>{let s=h||[];if(o){const i=o.toLowerCase();s=s.filter(c=>{var j;return c.name.toLowerCase().includes(i)||((j=c.idno)==null?void 0:j.toString().includes(i))})}l&&(s=s.filter(i=>i.department===l)),v(s)},[o,l,h]);const n=s=>{const{name:i,value:c}=s.target;x({...t,[i]:c})},_=s=>{x({...t,employee_id:s.id}),b(s)},k=async s=>{if(s.preventDefault(),!r){if(!t.employee_id){alert("Please select an employee");return}if(!t.offset_type_id){alert("Please select an offset type");return}if(!t.date||!t.workday){alert("Please specify both date and workday");return}if(t.date===t.workday){alert("Date and workday must be different");return}if(!t.hours||t.hours<=0){alert("Please enter a valid number of hours");return}if(!t.reason.trim()){alert("Please provide a reason for the offset");return}if(t.transaction_type==="debit"&&a&&t.hours>a.remaining_hours){alert(`Insufficient hours in offset bank. Employee only has ${a.remaining_hours} hours available.`);return}f(!0);try{await w(t),x({employee_id:"",offset_type_id:"",date:m,workday:"",hours:"",reason:"",transaction_type:"credit"}),b(null),g(""),y("")}catch(i){console.error("Error submitting form:",i)}finally{f(!1)}window.scrollTo({top:0,behavior:"smooth"})}};return e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Request Offset"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Create offset request for employee"})]}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Select Employee"}),e.jsxs("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by name or ID",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:o,onChange:s=>g(s.target.value),disabled:r})}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:l,onChange:s=>y(s.target.value),disabled:r,children:[e.jsx("option",{value:"",children:"All Departments"}),N.map((s,i)=>e.jsx("option",{value:s,children:s},i))]})})]}),e.jsx("div",{className:"border rounded-md overflow-hidden max-h-60 overflow-y-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Position"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Offset Hours"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-3 text-center text-sm text-gray-500",children:"No employees match your search criteria"})}):p.map(s=>e.jsxs("tr",{className:`hover:bg-gray-50 cursor-pointer ${t.employee_id===s.id?"bg-indigo-50":""} ${r?"pointer-events-none opacity-60":""}`,onClick:()=>!r&&_(s),children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:s.idno}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:s.department}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:s.position}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-right",children:e.jsxs("span",{className:`font-medium ${s.remaining_hours>0?"text-green-600":"text-gray-600"}`,children:[s.remaining_hours," hrs"]})})]},s.id))})]})}),e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:a?e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"font-medium",children:["Selected: ",a.name]}),e.jsxs("span",{className:"font-medium",children:["Available Offset Hours:",e.jsxs("span",{className:`ml-1 ${a.remaining_hours>0?"text-green-600":"text-red-600"}`,children:[a.remaining_hours," hrs"]})]})]}):e.jsx("span",{className:"text-yellow-600",children:"No employee selected"})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Offset Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"offset_type_id",className:"block text-sm font-medium text-gray-700 mb-1",children:["Offset Type ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{id:"offset_type_id",name:"offset_type_id",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:t.offset_type_id,onChange:n,disabled:r,required:!0,children:[e.jsx("option",{value:"",children:"Select Offset Type"}),u&&u.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"transaction_type",className:"block text-sm font-medium text-gray-700 mb-1",children:["Transaction Type ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"transaction_type",value:"credit",className:"text-indigo-600 border-gray-300 focus:ring-indigo-500",checked:t.transaction_type==="credit",onChange:n,disabled:r}),e.jsx("span",{className:"ml-2",children:"Credit (Add to Bank)"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"transaction_type",value:"debit",className:"text-indigo-600 border-gray-300 focus:ring-indigo-500",checked:t.transaction_type==="debit",onChange:n,disabled:r||!a||a.remaining_hours<=0}),e.jsx("span",{className:"ml-2",children:"Debit (Use from Bank)"})]})]}),t.transaction_type==="debit"&&!a&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:"Please select an employee first"}),t.transaction_type==="debit"&&a&&a.remaining_hours<=0&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:"Employee has no hours in offset bank"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 mb-1",children:["Date ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"date",id:"date",name:"date",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:t.date,onChange:n,disabled:r,required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:t.transaction_type==="credit"?"The date when the work was performed":"The date of the offset request"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"workday",className:"block text-sm font-medium text-gray-700 mb-1",children:["Workday ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"date",id:"workday",name:"workday",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:t.workday,onChange:n,disabled:r,required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:t.transaction_type==="credit"?"The date to be credited as offset":"The date when the employee will be using the offset"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"hours",className:"block text-sm font-medium text-gray-700 mb-1",children:["Hours ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"number",id:"hours",name:"hours",min:"0.5",max:t.transaction_type==="debit"&&a?a.remaining_hours:"24",step:"0.5",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:t.hours,onChange:n,disabled:r,required:!0}),t.transaction_type==="debit"&&a&&e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Max: ",a.remaining_hours," hours available"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Reason"}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700 mb-1",children:["Reason ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{id:"reason",name:"reason",rows:"5",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",placeholder:"Provide a detailed reason for the offset request",value:t.reason,onChange:n,disabled:r,required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:t.transaction_type==="credit"?"Please provide details about the work performed":"Please explain why the offset is being used"})]})]})]}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6 border-t",children:e.jsx("button",{type:"submit",disabled:r,className:`inline-flex justify-center items-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white ${r?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}`,children:r?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"animate-spin h-4 w-4 mr-2"}),"Submitting..."]}):"Submit Offset Request"})})]})]})};export{P as default};
