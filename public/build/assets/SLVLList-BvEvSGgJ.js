import{r as p,j as t,h as X}from"./app-C_ClQmDY.js";import le from"./SLVLStatusBadge-CaKZxQd1.js";import de from"./SLVLDetailModal-RFZ81ddH.js";import pe from"./SLVLBulkActionModal-BVHOokZe.js";import me from"./SLVLForceApproveButton-B_eAZUjG.js";import{y as N}from"./index-CBJp45S4.js";import{D as ue}from"./download-BQI3-SNa.js";import{S as xe}from"./search-BDKFcNkb.js";import{X as fe}from"./x-Q1lJB2Tb.js";import{f as ge}from"./format-Ur_Fko9Q.js";import"./FileDisplay--uq2mFTf.js";import"./createLucideIcon-D1ADp28Z.js";import"./file-text-DMC5LN9m.js";import"./eye-BzxMP9Yo.js";import"./zap-BqYNij_k.js";import"./clsx-B-dksMZM.js";const Me=({slvls:w,onStatusUpdate:_,onDelete:he,userRoles:c={}})=>{const[A,V]=p.useState(null),[G,E]=p.useState(!1),[u,F]=p.useState(""),[x,M]=p.useState(""),[L,T]=p.useState(w||[]),[h,v]=p.useState(w||[]),[k,j]=p.useState(!1),[f,P]=p.useState(""),[l,B]=p.useState({from:"",to:""}),[m,S]=p.useState([]),[J,q]=p.useState(!1),[C,I]=p.useState(!1),U=[{value:"sick",label:"Sick Leave"},{value:"vacation",label:"Vacation Leave"},{value:"emergency",label:"Emergency Leave"},{value:"bereavement",label:"Bereavement Leave"},{value:"maternity",label:"Maternity Leave"},{value:"paternity",label:"Paternity Leave"},{value:"personal",label:"Personal Leave"},{value:"study",label:"Study Leave"}];p.useEffect(()=>{w&&(v(w),y(w,u,x,f,l))},[w]);const y=(e,a,r,o,d)=>{let i=[...e];if(a&&(i=i.filter(n=>n.status===a)),r&&(i=i.filter(n=>n.type===r)),o){const n=o.toLowerCase();i=i.filter(s=>s.employee&&(s.employee.Fname&&s.employee.Fname.toLowerCase().includes(n)||s.employee.Lname&&s.employee.Lname.toLowerCase().includes(n))||s.employee&&s.employee.idno&&s.employee.idno.toString().includes(n)||s.employee&&s.employee.Department&&s.employee.Department.toLowerCase().includes(n)||s.reason&&s.reason.toLowerCase().includes(n))}return d.from&&d.to?i=i.filter(n=>{if(!n.start_date)return!1;const s=new Date(n.start_date),g=new Date(d.from),b=new Date(d.to);return b.setHours(23,59,59),s>=g&&s<=b}):d.from?i=i.filter(n=>{if(!n.start_date)return!1;const s=new Date(n.start_date),g=new Date(d.from);return s>=g}):d.to&&(i=i.filter(n=>{if(!n.start_date)return!1;const s=new Date(n.start_date),g=new Date(d.to);return g.setHours(23,59,59),s<=g})),T(i),i},K=e=>{const a=e.target.value;F(a),y(h,a,x,f,l)},Q=e=>{const a=e.target.value;M(a),y(h,u,a,f,l)},Y=e=>{const a=e.target.value;P(a),y(h,u,x,a,l)},$=(e,a)=>{const r={...l,[e]:a};B(r),y(h,u,x,f,r)},Z=()=>{F(""),M(""),P(""),B({from:"",to:""}),y(h,"","","",{from:"",to:""})},R=e=>{V(e),E(!0)},H=()=>{E(!1),V(null)},ee=(e,a)=>{typeof _=="function"&&_(e,a),H()},te=e=>{confirm("Are you sure you want to delete this SLVL request?")&&(j(!0),X.post(route("slvl.destroy",e),{_method:"DELETE"},{preserveScroll:!0,onSuccess:()=>{N.success("SLVL request deleted successfully");const a=h.filter(r=>r.id!==e);v(a),T(r=>r.filter(o=>o.id!==e)),m.includes(e)&&S(r=>r.filter(o=>o!==e)),j(!1)},onError:a=>{console.error("Error deleting:",a),N.error("Failed to delete SLVL request"),j(!1)}}))},O=e=>{try{return ge(new Date(e),"yyyy-MM-dd")}catch(a){return console.error("Error formatting date:",a),"Invalid date"}},ae=()=>{if(I(!C),C)S([]);else{let e=[];(c.isDepartmentManager||c.isHrdManager||c.isSuperAdmin)&&(e=L.filter(a=>a.status==="pending").map(a=>a.id)),S(e)}},se=e=>{S(a=>a.includes(e)?a.filter(r=>r!==e):[...a,e])},re=()=>{if(m.length===0){alert("Please select at least one SLVL request");return}q(!0)},W=()=>{q(!1)},ne=(e,a)=>{j(!0);const r={slvl_ids:m,status:e,remarks:a};X.post(route("slvl.bulkUpdateStatus"),r,{preserveScroll:!0,onSuccess:o=>{var i,n;const d=h.map(s=>{var g,b;return m.includes(s.id)?{...s,status:e,remarks:a,approved_at:new Date().toISOString(),approver:(b=(g=o.props)==null?void 0:g.auth)!=null&&b.user?{id:o.props.auth.user.id,name:o.props.auth.user.name}:null}:s});v(d),y(d,u,x,f,l),(n=(i=o.props)==null?void 0:i.flash)!=null&&n.message?N.success(o.props.flash.message):N.success(`Successfully ${e} ${m.length} SLVL requests`),S([]),I(!1),W(),j(!1)},onError:o=>{console.error("Error during bulk update:",o),N.error("Failed to update SLVL requests"),j(!1)}})},oe=()=>{const e=new URLSearchParams;u&&e.append("status",u),x&&e.append("type",x),f&&e.append("search",f),l.from&&e.append("from_date",l.from),l.to&&e.append("to_date",l.to);const a=`/slvl/export?${e.toString()}`;window.open(a,"_blank")},z=e=>{var a,r;return c.isSuperAdmin||c.isHrdManager?e.status==="pending":c.isDepartmentManager?e.status==="pending"&&((r=c.managedDepartments)==null?void 0:r.includes((a=e.employee)==null?void 0:a.Department)):!1},D=L.filter(e=>z(e)).length,ie=e=>{const a=U.find(r=>r.value===e);return a?a.label:(e==null?void 0:e.charAt(0).toUpperCase())+(e==null?void 0:e.slice(1))},ce=e=>e.pay_type?e.pay_type==="with_pay"?"With Pay":"Non Pay":e.with_pay?"With Pay":"Non Pay";return t.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden flex flex-col h-[62vh]",children:[t.jsxs("div",{className:"p-4 border-b",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"SLVL Requests"}),t.jsxs("div",{className:"flex flex-wrap gap-2 w-full md:w-auto",children:[t.jsxs("button",{onClick:oe,className:"px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center",title:"Export to Excel",children:[t.jsx(ue,{className:"h-4 w-4 mr-1"}),"Export"]}),c.isSuperAdmin&&t.jsx(me,{selectedIds:m,disabled:k}),m.length>0&&t.jsxs("button",{onClick:re,className:"px-3 py-1 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",disabled:k,children:["Bulk Action (",m.length,")"]}),t.jsx("div",{className:"flex items-center",children:t.jsxs("select",{id:"statusFilter",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:u,onChange:K,children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"approved",children:"Approved"}),t.jsx("option",{value:"rejected",children:"Rejected"})]})}),t.jsx("div",{className:"flex items-center",children:t.jsxs("select",{id:"typeFilter",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:x,onChange:Q,children:[t.jsx("option",{value:"",children:"All Types"}),U.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]})})]})]}),t.jsxs("div",{className:"mt-4 flex flex-col md:flex-row gap-3",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(xe,{className:"h-4 w-4 text-gray-400"})}),t.jsx("input",{type:"text",placeholder:"Search by name, ID, department, or reason",className:"pl-10 w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:f,onChange:Y})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"fromDate",className:"mr-2 text-sm font-medium text-gray-700",children:"From:"}),t.jsx("input",{id:"fromDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:l.from,onChange:e=>$("from",e.target.value)})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"toDate",className:"mr-2 text-sm font-medium text-gray-700",children:"To:"}),t.jsx("input",{id:"toDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:l.to,onChange:e=>$("to",e.target.value)})]}),(u||x||f||l.from||l.to)&&t.jsxs("button",{onClick:Z,className:"px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md text-sm flex items-center",title:"Clear all filters",children:[t.jsx(fe,{className:"h-4 w-4 mr-1"}),"Clear"]})]})]})]}),t.jsx("div",{className:"overflow-auto flex-grow",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:t.jsxs("tr",{children:[D>0&&t.jsx("th",{scope:"col",className:"px-4 py-3 w-10",children:t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:C&&m.length===D,onChange:ae})}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Leave Type"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Start Date"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"End Date"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Days"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pay Type"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Approved By"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:L.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:D>0?"10":"9",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No SLVL records found"})}):L.map(e=>{var a,r,o,d;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[D>0&&t.jsx("td",{className:"px-4 py-4",children:z(e)&&t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:m.includes(e.id),onChange:()=>se(e.id)})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.employee?`${e.employee.Lname}, ${e.employee.Fname}`:"Unknown employee"}),t.jsxs("div",{className:"text-sm text-gray-500",children:[((a=e.employee)==null?void 0:a.idno)||"N/A"," • ",((r=e.employee)==null?void 0:r.Department)||"N/A"]})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${e.type==="sick"?"bg-red-100 text-red-800":e.type==="vacation"?"bg-green-100 text-green-800":e.type==="emergency"?"bg-orange-100 text-orange-800":e.type==="maternity"||e.type==="paternity"?"bg-pink-100 text-pink-800":"bg-blue-100 text-blue-800"}`,children:ie(e.type)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:e.start_date?O(e.start_date):"N/A"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:e.end_date?O(e.end_date):"N/A"})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.total_days," ",e.total_days===1?"day":"days",e.half_day&&t.jsxs("div",{className:"text-xs text-gray-500",children:["(",e.am_pm," half-day)"]})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${e.pay_type==="with_pay"||!e.pay_type&&e.with_pay?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:ce(e)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx(le,{status:e.status})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.approver?e.approver.name:"N/A"}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[t.jsx("button",{onClick:()=>R(e),className:"text-indigo-600 hover:text-indigo-900 mr-3",children:"View"}),e.status==="pending"&&(c.isSuperAdmin||e.employee_id===c.employeeId||c.isDepartmentManager&&((d=c.managedDepartments)==null?void 0:d.includes((o=e.employee)==null?void 0:o.Department)))&&t.jsx("button",{onClick:()=>te(e.id),className:"text-red-600 hover:text-red-900",disabled:k,children:"Delete"})]})]},e.id)})})]})}),G&&A&&t.jsx(de,{slvl:A,onClose:H,onStatusUpdate:ee,userRoles:c}),J&&t.jsx(pe,{selectedCount:m.length,onClose:W,onSubmit:ne,userRoles:c})]})};export{Me as default};
