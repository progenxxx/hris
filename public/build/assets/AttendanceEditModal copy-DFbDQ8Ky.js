import{r as i,j as e}from"./app-7K62fd2B.js";import{B as a}from"./Button-B-ixrUdq.js";import{A as m,a as o}from"./alert-Cw6Swk3l.js";import{M as n,S as f}from"./sun-DGcVySav.js";import{X as F}from"./x-4sBMcqny.js";import{T as I}from"./triangle-alert-BFKAbd31.js";import{C as O}from"./circle-check-big-CdHds-fH.js";import{I as j}from"./info-CNKW5Dcc.js";import{C as l}from"./clock-r6FcyLKi.js";import{C as g}from"./car-HfwOmSbn.js";import{T as E}from"./trash-2-CLTfogtc.js";import{L as b}from"./loader-circle-CCcIPQox.js";import{R as A}from"./refresh-cw-DqcGqKqT.js";import{S as L}from"./save-BqIq9Yvz.js";import"./clsx-B-dksMZM.js";import"./createLucideIcon-BK5csKvN.js";const oe=({isOpen:N,attendance:s,onClose:d,onSave:B,onDelete:M,onSync:z})=>{const[t,c]=i.useState({id:"",time_in:"",time_out:"",break_in:"",break_out:"",next_day_timeout:"",is_nightshift:!1,trip:0}),[h,P]=i.useState(""),[x,R]=i.useState(""),[u,U]=i.useState(!1),[p,q]=i.useState(!1),[y,W]=i.useState(!1),[H,v]=i.useState(!1),[_,V]=i.useState(!1);i.useEffect(()=>{s&&(console.log("Initializing form with attendance data:",s),c({id:s.id,time_in:formatTimeForInput(s.time_in),time_out:formatTimeForInput(s.time_out),break_in:formatTimeForInput(s.break_in),break_out:formatTimeForInput(s.break_out),next_day_timeout:formatTimeForInput(s.next_day_timeout),is_nightshift:s.is_nightshift||!1,trip:s.trip||0}))},[s]);const r=k=>{const{name:w,value:S,type:T,checked:C}=k.target;c(D=>({...D,[w]:T==="checkbox"?C:S}))};return N?e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg max-w-4xl w-full mx-4 md:mx-8",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Edit Attendance Times"}),t.is_nightshift&&e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-sm",children:[e.jsx(n,{className:"h-4 w-4"}),e.jsx("span",{children:"Night Shift"})]}),!t.is_nightshift&&e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx("span",{children:"Regular Shift"})]})]}),e.jsx("button",{onClick:d,className:"text-gray-500 hover:text-gray-700","aria-label":"Close",children:e.jsx(F,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[h&&e.jsxs(m,{variant:"destructive",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),e.jsx(o,{children:h})]}),x&&e.jsxs(m,{className:"border-green-200 bg-green-50",children:[e.jsx(O,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx(o,{className:"text-green-800",children:x})]}),_&&e.jsxs(m,{className:"border-purple-200 bg-purple-50",children:[e.jsx(j,{className:"h-4 w-4 mr-2 text-purple-600"}),e.jsxs(o,{className:"text-purple-800",children:[e.jsx("strong",{children:t.is_nightshift?"Night Shift Enabled:":"Regular Shift Mode:"}),e.jsx("br",{}),t.is_nightshift?e.jsxs(e.Fragment,{children:['â€¢ Use "Time Out" only if employee clocks out the same day',e.jsx("br",{}),'â€¢ Use "Next Day Timeout" if employee clocks out the following day',e.jsx("br",{}),"â€¢ Do not use both fields - choose the appropriate one for your situation"]}):e.jsxs(e.Fragment,{children:['â€¢ Use "Time In" and "Time Out" for same-day attendance',e.jsx("br",{}),'â€¢ "Next Day Timeout" field is disabled for regular shifts',e.jsx("br",{}),"â€¢ Both Time In and Time Out are required"]})]})]}),e.jsxs("div",{className:"space-y-1 mb-6",children:[e.jsxs("div",{className:"font-medium text-gray-700 mb-3",children:[s==null?void 0:s.employee_name," (ID: ",s==null?void 0:s.idno,")"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-500",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Department:"})," ",(s==null?void 0:s.department)||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",s!=null&&s.attendance_date?new Date(s.attendance_date).toLocaleDateString():"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Hours Worked:"})," ",(s==null?void 0:s.hours_worked)||"N/A"]})]})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("input",{type:"checkbox",id:"is_nightshift",name:"is_nightshift",className:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded",checked:t.is_nightshift,onChange:handleNightShiftChange}),e.jsx("label",{htmlFor:"is_nightshift",className:"ml-2 block text-sm font-medium text-gray-900",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[t.is_nightshift?e.jsx(n,{className:"h-4 w-4 text-purple-600"}):e.jsx(f,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{children:"Night Shift"})]})})]}),e.jsx("p",{className:"text-xs text-gray-600 ml-6",children:t.is_nightshift?"Night shift mode: Employee works overnight and may clock out the next day":"Regular shift mode: Employee clocks in and out on the same day"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"time_in",className:"block text-sm font-medium text-gray-700 mb-2",children:["Time In ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 z-10"}),e.jsx("div",{className:"pl-10",children:e.jsx(TimePicker,{name:"time_in",value:t.time_in,onChange:r,placeholder:"9:30 AM",required:!0})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"time_out",className:"block text-sm font-medium text-gray-700 mb-2",children:["Time Out ",t.is_nightshift?"(Same Day)":e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 z-10"}),e.jsx("div",{className:"pl-10",children:e.jsx(TimePicker,{name:"time_out",value:t.time_out,onChange:r,placeholder:"5:30 PM",required:!t.is_nightshift,disabled:t.is_nightshift&&t.next_day_timeout})})]}),t.is_nightshift&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:'Only use this if employee clocks out on the same day. Otherwise, use "Next Day Timeout" below.'})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"break_out",className:"block text-sm font-medium text-gray-700 mb-2",children:"Break Out (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 z-10"}),e.jsx("div",{className:"pl-10",children:e.jsx(TimePicker,{name:"break_out",value:t.break_out,onChange:r,placeholder:"12:00 PM"})})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"When employee leaves for break/lunch"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"break_in",className:"block text-sm font-medium text-gray-700 mb-2",children:"Break In (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 z-10"}),e.jsx("div",{className:"pl-10",children:e.jsx(TimePicker,{name:"break_in",value:t.break_in,onChange:r,placeholder:"1:00 PM"})})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"When employee returns from break/lunch"})]})]}),e.jsx("div",{className:"border-2 border-blue-200 rounded-lg p-4 bg-blue-50",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"trip",className:"block text-sm font-medium text-blue-800 mb-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx("span",{children:"Number of Trips"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-blue-600 z-10"}),e.jsx("input",{type:"number",id:"trip",name:"trip",min:"0",max:"999.99",step:"0.01",value:t.trip,onChange:r,className:"w-full pl-10 pr-4 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"})]}),e.jsx("p",{className:"mt-1 text-xs text-blue-700",children:"Enter the number of trips (e.g., 1.5 for one and a half trips)"})]})}),t.is_nightshift&&e.jsx("div",{className:"border-2 border-purple-200 rounded-lg p-4 bg-purple-50",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"next_day_timeout",className:"block text-sm font-medium text-purple-800 mb-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{className:"h-4 w-4"}),e.jsx("span",{children:"Next Day Timeout"}),!t.time_out&&e.jsx("span",{className:"text-red-500",children:"*"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-purple-600 z-10"}),e.jsx("div",{className:"pl-10",children:e.jsx(TimePicker,{name:"next_day_timeout",value:t.next_day_timeout,onChange:r,placeholder:"6:00 AM",disabled:!!t.time_out})})]}),e.jsxs("div",{className:"mt-2 text-xs text-purple-700",children:[e.jsx("strong",{children:"For night shifts only:"})," When the employee clocks out on the following day.",t.time_out&&e.jsx("div",{className:"mt-1 p-2 bg-purple-100 rounded text-purple-800 font-medium",children:'âš ï¸ Disabled because "Time Out" is set. Clear "Time Out" to use this field.'}),!t.time_out&&!t.next_day_timeout&&e.jsx("div",{className:"mt-1 p-2 bg-yellow-100 rounded text-yellow-800 font-medium",children:'ðŸ’¡ Either "Time Out" (same day) or "Next Day Timeout" is required for night shifts.'})]})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(j,{className:"h-5 w-5 text-blue-600 mt-0.5 mr-2 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("h4",{className:"font-medium mb-2",children:"How to Use:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Regular Shifts:"}),' Use "Time In" and "Time Out" for same-day attendance']}),e.jsxs("p",{children:[e.jsx("strong",{children:"Night Shifts:"}),' Check "Night Shift" box, then either:']}),e.jsxs("ul",{className:"ml-4 mt-1 space-y-1",children:[e.jsx("li",{children:'â€¢ Use "Time Out" if employee clocks out the same day'}),e.jsx("li",{children:'â€¢ Use "Next Day Timeout" if employee clocks out the following day'})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Break Times:"}),' "Break Out" = leaving for break, "Break In" = returning from break']}),e.jsxs("p",{children:[e.jsx("strong",{children:"Trips:"})," Enter the number of trips completed (supports decimals like 1.5)"]})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 p-6 -mx-6 -mb-6 mt-6 flex justify-between items-center border-t",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(a,{type:"button",variant:"outline",onClick:()=>v(!0),disabled:y,className:"text-red-600 border-red-300 hover:bg-red-50",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Delete"]}),e.jsx(a,{type:"button",variant:"outline",onClick:handleSync,disabled:p,className:"text-blue-600 border-blue-300 hover:bg-blue-50",title:"Sync this attendance record with related data (Travel Orders, SLVL, Overtime, etc.)",children:p?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-4 w-4 mr-2 animate-spin"}),"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Sync Record"]})})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(a,{type:"button",variant:"outline",onClick:d,children:"Cancel"}),e.jsx(a,{onClick:handleSubmit,disabled:u,className:"bg-blue-600 hover:bg-blue-700",children:u?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})]})]})]})]})}):null};export{oe as default};
