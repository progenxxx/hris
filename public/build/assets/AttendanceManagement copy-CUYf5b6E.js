import{r as s,j as e}from"./app-7K62fd2B.js";import{A as g,a as f}from"./alert-Cw6Swk3l.js";import{C as S,a as C,b as _,c as E}from"./card-Bd2He_oM.js";import{L as y}from"./loader-circle-CCcIPQox.js";import"./createLucideIcon-BK5csKvN.js";const O=()=>{const[x,j]=s.useState(""),[r,w]=s.useState(""),[n,N]=s.useState(""),[o,b]=s.useState([]),[i,l]=s.useState(!1),[m,p]=s.useState(""),[h,c]=s.useState(""),v=()=>{if(!r||!n)return!1;const t=new Date(r),a=new Date(n);if(a<t)return c("End date must be after start date"),!1;const k=Math.abs(a-t);return Math.ceil(k/(1e3*60*60*24))>31?(c("Date range cannot exceed 31 days"),!1):!0},D=async()=>{l(!0),c(""),p("");try{const t=await fetch("/biometric/fetch-logs",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({device_ip:x})}),a=await t.json();if(!t.ok)throw new Error(a.message||"Failed to fetch logs");p("Logs fetched successfully"),await u()}catch(t){c("Failed to fetch biometric logs: "+t.message)}finally{l(!1)}},u=async()=>{if(v()){l(!0),c("");try{const t=await fetch(`/attendance/report?start_date=${r}&end_date=${n}`),a=await t.json();if(!t.ok)throw new Error(a.message||"Failed to fetch report");b(a)}catch(t){c("Failed to fetch attendance report: "+t.message)}finally{l(!1)}}},d=t=>t?new Date(t).toLocaleString():"-";return e.jsxs(S,{className:"max-w-7xl mx-auto",children:[e.jsx(C,{children:e.jsx(_,{children:"Attendance Management"})}),e.jsxs(E,{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Device IP"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:t=>j(t.target.value),placeholder:"192.168.1.100",className:"flex-1 px-3 py-2 border rounded-md",pattern:"\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}"}),e.jsxs("button",{onClick:D,disabled:!x||i,className:"px-4 py-2 bg-blue-500 text-white rounded-md disabled:bg-blue-300 flex items-center gap-2",children:[i&&e.jsx(y,{className:"h-4 w-4 animate-spin"}),i?"Fetching...":"Fetch Logs"]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:r,onChange:t=>w(t.target.value),className:"w-full px-3 py-2 border rounded-md",max:n})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:n,onChange:t=>N(t.target.value),className:"w-full px-3 py-2 border rounded-md",min:r})]})]}),e.jsxs("button",{onClick:u,disabled:!r||!n||i,className:"w-full px-4 py-2 bg-blue-500 text-white rounded-md disabled:bg-blue-300 flex items-center justify-center gap-2",children:[i&&e.jsx(y,{className:"h-4 w-4 animate-spin"}),"Generate Report"]})]})}),h&&e.jsx(g,{variant:"destructive",children:e.jsx(f,{children:h})}),m&&e.jsx(g,{className:"bg-green-50 border-green-200",children:e.jsx(f,{className:"text-green-700",children:m})}),e.jsx("div",{className:"overflow-x-auto rounded-lg border",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time In"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Break In"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Break Out"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time Out"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Night Shift"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Next Day Timeout"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-6 py-4 text-center text-gray-500",children:"No attendance records found"})}):o.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.idno}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.attendance_date}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:d(t.time_in)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:d(t.break_in)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:d(t.break_out)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:d(t.time_out)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.is_nightshift?"Yes":"No"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:d(t.next_day_timeout)})]},`${t.idno}-${t.attendance_date}`))})]})})]})]})};export{O as default};
