import{r as m,j as t,b as z}from"./app-7K62fd2B.js";import ae from"./TimeScheduleStatusBadge-C4GsOmha.js";import oe from"./TimeScheduleDetailModal-CgmRLpoU.js";import ne from"./TimeScheduleBulkActionModal-B43RQlcX.js";import le from"./TimeScheduleForceApproveButton-CHgsrEP8.js";import{y as v}from"./index-DkMCAIk8.js";import{D as ie}from"./download-DiYogtYp.js";import{S as ce}from"./search-BmV-knWW.js";import{X as de}from"./x-4sBMcqny.js";import{f as me}from"./format-Bw_hER4B.js";import"./zap-B1geo600.js";import"./createLucideIcon-BK5csKvN.js";import"./clsx-B-dksMZM.js";const Ce=({timeSchedules:x,onStatusUpdate:_,onDelete:ue,userRoles:c={}})=>{const[k,T]=m.useState(null),[X,A]=m.useState(!1),[p,M]=m.useState(""),[N,E]=m.useState(x||[]),[h,D]=m.useState(x||[]),[S,g]=m.useState(!1),[f,F]=m.useState(""),[d,L]=m.useState({from:"",to:""}),[u,w]=m.useState([]),[G,B]=m.useState(!1),[C,q]=m.useState(!1);m.useEffect(()=>{x&&(D(x),y(x,p,f,d))},[x]);const y=(e,s,o,a)=>{let l=[...e];if(s&&(l=l.filter(n=>n.status===s)),o){const n=o.toLowerCase();l=l.filter(r=>r.employee&&(r.employee.Fname&&r.employee.Fname.toLowerCase().includes(n)||r.employee.Lname&&r.employee.Lname.toLowerCase().includes(n))||r.employee&&r.employee.idno&&r.employee.idno.toString().includes(n)||r.employee&&r.employee.Department&&r.employee.Department.toLowerCase().includes(n)||r.reason&&r.reason.toLowerCase().includes(n)||r.new_schedule&&r.new_schedule.toLowerCase().includes(n))}return a.from&&a.to?l=l.filter(n=>{if(!n.effective_date)return!1;const r=new Date(n.effective_date),i=new Date(a.from),j=new Date(a.to);return j.setHours(23,59,59),r>=i&&r<=j}):a.from?l=l.filter(n=>{if(!n.effective_date)return!1;const r=new Date(n.effective_date),i=new Date(a.from);return r>=i}):a.to&&(l=l.filter(n=>{if(!n.effective_date)return!1;const r=new Date(n.effective_date),i=new Date(a.to);return i.setHours(23,59,59),r<=i})),E(l),l},J=e=>{const s=e.target.value;M(s),y(h,s,f,d)},K=e=>{const s=e.target.value;F(s),y(h,p,s,d)},I=(e,s)=>{const o={...d,[e]:s};L(o),y(h,p,f,o)},Q=()=>{M(""),F(""),L({from:"",to:""}),y(h,"","",{from:"",to:""})},W=e=>{T(e),A(!0)},$=()=>{A(!1),T(null)},Y=(e,s)=>{typeof _=="function"&&_(e,s),$()},Z=e=>{confirm("Are you sure you want to delete this time schedule change request?")&&(g(!0),z.post(route("time-schedules.destroy",e),{_method:"DELETE"},{preserveScroll:!0,onSuccess:()=>{v.success("Time schedule change request deleted successfully");const s=h.filter(o=>o.id!==e);D(s),E(o=>o.filter(a=>a.id!==e)),u.includes(e)&&w(o=>o.filter(a=>a!==e)),g(!1)},onError:s=>{console.error("Error deleting:",s),v.error("Failed to delete time schedule change request"),g(!1)}}))},P=e=>{try{return me(new Date(e),"yyyy-MM-dd")}catch(s){return console.error("Error formatting date:",s),"Invalid date"}},U=e=>{if(!e)return"-";try{let s;if(e.includes("T")){const[,i]=e.split("T");s=i.slice(0,5)}else{const i=e.split(" ");s=i[i.length-1].slice(0,5)}const[o,a]=s.split(":"),l=parseInt(o,10),n=l>=12?"PM":"AM";return`${l%12||12}:${a} ${n}`}catch(s){return console.error("Time formatting error:",s),"-"}},R=()=>{if(q(!C),C)w([]);else{let e=[];(c.isDepartmentManager||c.isHrdManager||c.isSuperAdmin)&&(e=N.filter(s=>s.status==="pending").map(s=>s.id)),w(e)}},ee=e=>{w(s=>s.includes(e)?s.filter(o=>o!==e):[...s,e])},te=()=>{if(u.length===0){alert("Please select at least one time schedule change request");return}B(!0)},H=()=>{B(!1)},se=(e,s)=>{g(!0);const o={time_schedule_ids:u,status:e,remarks:s};z.post(route("time-schedules.bulkUpdateStatus"),o,{preserveScroll:!0,onSuccess:a=>{var n,r;const l=h.map(i=>{var j,V;return u.includes(i.id)?{...i,status:e,remarks:s,approved_at:new Date().toISOString(),approver:(V=(j=a.props)==null?void 0:j.auth)!=null&&V.user?{id:a.props.auth.user.id,name:a.props.auth.user.name}:null}:i});D(l),y(l,p,f,d),(r=(n=a.props)==null?void 0:n.flash)!=null&&r.message?v.success(a.props.flash.message):v.success(`Successfully ${e} ${u.length} time schedule change requests`),w([]),q(!1),H(),g(!1)},onError:a=>{console.error("Error during bulk update:",a),v.error("Failed to update time schedule change requests"),g(!1)}})},re=()=>{const e=new URLSearchParams;p&&e.append("status",p),f&&e.append("search",f),d.from&&e.append("from_date",d.from),d.to&&e.append("to_date",d.to);const s=`/time-schedules/export?${e.toString()}`;window.open(s,"_blank")},O=e=>{var s,o;return c.isSuperAdmin||c.isHrdManager?e.status==="pending":c.isDepartmentManager?e.status==="pending"&&((o=c.managedDepartments)==null?void 0:o.includes((s=e.employee)==null?void 0:s.Department)):!1},b=N.filter(e=>O(e)).length;return t.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden flex flex-col h-[62vh]",children:[t.jsxs("div",{className:"p-4 border-b",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Time Schedule Change Requests"}),t.jsxs("div",{className:"flex flex-wrap gap-2 w-full md:w-auto",children:[t.jsxs("button",{onClick:re,className:"px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center",title:"Export to Excel",children:[t.jsx(ie,{className:"h-4 w-4 mr-1"}),"Export"]}),c.isSuperAdmin&&t.jsx(le,{selectedIds:u,disabled:S}),u.length>0&&t.jsxs("button",{onClick:te,className:"px-3 py-1 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",disabled:S,children:["Bulk Action (",u.length,")"]}),t.jsx("div",{className:"flex items-center",children:t.jsxs("select",{id:"statusFilter",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:p,onChange:J,children:[t.jsx("option",{value:"",children:"All Statuses"}),t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"approved",children:"Approved"}),t.jsx("option",{value:"rejected",children:"Rejected"})]})})]})]}),t.jsxs("div",{className:"mt-4 flex flex-col md:flex-row gap-3",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(ce,{className:"h-4 w-4 text-gray-400"})}),t.jsx("input",{type:"text",placeholder:"Search by name, ID, department, or schedule",className:"pl-10 w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:f,onChange:K})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"fromDate",className:"mr-2 text-sm font-medium text-gray-700",children:"From:"}),t.jsx("input",{id:"fromDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:d.from,onChange:e=>I("from",e.target.value)})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"toDate",className:"mr-2 text-sm font-medium text-gray-700",children:"To:"}),t.jsx("input",{id:"toDate",type:"date",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",value:d.to,onChange:e=>I("to",e.target.value)})]}),(p||f||d.from||d.to)&&t.jsxs("button",{onClick:Q,className:"px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md text-sm flex items-center",title:"Clear all filters",children:[t.jsx(de,{className:"h-4 w-4 mr-1"}),"Clear"]})]})]})]}),t.jsx("div",{className:"overflow-auto flex-grow",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:t.jsxs("tr",{children:[b>0&&t.jsx("th",{scope:"col",className:"px-4 py-3 w-10",children:t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:C&&u.length===b,onChange:R})}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Effective Date"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Schedule"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:b>0?"7":"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No time schedule change records found"})}):N.map(e=>{var s,o,a;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[b>0&&t.jsx("td",{className:"px-4 py-4",children:O(e)&&t.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",checked:u.includes(e.id),onChange:()=>ee(e.id)})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.employee?`${e.employee.Lname}, ${e.employee.Fname}`:"Unknown employee"}),t.jsx("div",{className:"text-sm text-gray-500",children:((s=e.employee)==null?void 0:s.idno)||"N/A"})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm text-gray-900",children:e.effective_date?P(e.effective_date):"N/A"}),e.end_date&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Until: ",P(e.end_date)]})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:e.new_schedule||"N/A"})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.new_start_time?U(e.new_start_time):"N/A"," - ",e.new_end_time?U(e.new_end_time):"N/A"]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx(ae,{status:e.status})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[t.jsx("button",{onClick:()=>W(e),className:"text-indigo-600 hover:text-indigo-900 mr-3",children:"View"}),e.status==="pending"&&(c.isSuperAdmin||e.employee_id===c.employeeId||c.isDepartmentManager&&((a=c.managedDepartments)==null?void 0:a.includes((o=e.employee)==null?void 0:o.Department)))&&t.jsx("button",{onClick:()=>Z(e.id),className:"text-red-600 hover:text-red-900",disabled:S,children:"Delete"})]})]},e.id)})})]})}),X&&k&&t.jsx(oe,{timeSchedule:k,onClose:$,onStatusUpdate:Y,userRoles:c}),G&&t.jsx(ne,{selectedCount:u.length,onClose:H,onSubmit:se,userRoles:c})]})};export{Ce as default};
