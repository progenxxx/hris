import{a as R,r,j as e,H as P}from"./app-D-TNKEQL.js";import{A as B}from"./AuthenticatedLayout-PCqsYVxf.js";import{S as q}from"./Sidebar-Cg7Kwp5t.js";import{A as C,a as _}from"./alert-ttcl-5kV.js";import{L as J}from"./loader-circle-D5iasq1K.js";import"./ApplicationLogo-Cn-MbvX-.js";import"./Dropdown-BOoMuW7P.js";import"./transition-DeCEAfJ2.js";import"./search-DZDiwkir.js";import"./createLucideIcon-DEWnkTLV.js";import"./x-fQrOvEob.js";/* empty css                */import"./users-Cw0U-ZsC.js";import"./file-text-QjoOwKBJ.js";import"./calendar-DhTYrr3L.js";const X=({value:d})=>e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300 ease-in-out",style:{width:`${d}%`}})}),H=({children:d})=>e.jsx("div",{className:"bg-white rounded-lg shadow-md",children:d}),ne=()=>{const{auth:d}=R().props,[p,A]=r.useState(""),[l,g]=r.useState(""),[o,f]=r.useState(""),[u,y]=r.useState(!1),[j,N]=r.useState(0),[b,w]=r.useState(""),[v,i]=r.useState(""),[D,h]=r.useState([]),[k,S]=r.useState(""),E=()=>{const t="XSRF-TOKEN=",n=decodeURIComponent(document.cookie).split(";");for(let a=0;a<n.length;a++){let m=n[a].trim();if(m.indexOf(t)===0)return m.substring(t.length,m.length)}return""};r.useEffect(()=>{const t=new Date,s=new Date;s.setMonth(s.getMonth()-2),f(t.toISOString().split("T")[0]),g(s.toISOString().split("T")[0]);const n=E();if(n)S(n);else{const a=document.querySelector('meta[name="csrf-token"]');a&&S(a.getAttribute("content"))}},[]);const I=()=>{if(!l||!o)return i("Both start and end dates are required"),!1;const t=new Date(l),s=new Date(o);if(s<t)return i("End date must be after start date"),!1;const n=Math.abs(s-t);return Math.ceil(n/(1e3*60*60*24))>62?(i("Date range cannot exceed 2 months"),!1):!0},F=async()=>{if(!p){i("Device IP is required");return}if(!k){i("CSRF token not available");return}if(I()){y(!0),i(""),w(""),N(0),h([]);try{const t=await fetch("/biometric/fetch-logs",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-XSRF-TOKEN":k},body:JSON.stringify({device_ip:p,start_date:l,end_date:o}),credentials:"include"});if(!t.ok)throw new Error("Failed to fetch logs");const s=t.body.getReader(),n=new TextDecoder;let a="";for(;;){const{done:m,value:O}=await s.read();if(m)break;a+=n.decode(O,{stream:!0});const T=a.split(`
`);a=T.pop()||"";for(const L of T)try{const c=JSON.parse(L);c.progress&&N(c.progress.percentage),c.data&&h(M=>[...M,...c.data])}catch(c){console.error("Error parsing JSON:",c)}}w("Logs fetched successfully")}catch(t){i(t.message||"Failed to fetch biometric logs"),h([])}finally{y(!1)}}},x=t=>t?new Date(t).toLocaleString():"-";return e.jsxs(B,{user:d.user,children:[e.jsx(P,{title:"Attendance Management"}),e.jsxs("div",{className:"flex min-h-screen bg-gray-50/50",children:[e.jsx(q,{}),e.jsx("div",{className:"flex-1 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Attendance Management"}),e.jsx("p",{className:"text-gray-600",children:"Monitor and manage employee attendance records."})]})}),b&&e.jsx(C,{className:"mb-4",children:e.jsx(_,{children:b})}),v&&e.jsx(C,{variant:"destructive",className:"mb-4",children:e.jsx(_,{children:v})}),e.jsx(H,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"deviceIp",className:"block text-sm font-medium mb-1 text-gray-700",children:"Device IP"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"deviceIp",type:"text",value:p,onChange:t=>A(t.target.value),placeholder:"192.168.1.100",className:"flex-1 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",pattern:"\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}"}),e.jsxs("button",{onClick:F,disabled:!p||u,className:"px-4 py-2 bg-blue-500 text-white rounded-md disabled:bg-blue-300 hover:bg-blue-600 transition-colors flex items-center gap-2",children:[u&&e.jsx(J,{className:"h-4 w-4 animate-spin"}),u?"Fetching...":"Fetch Logs"]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm font-medium mb-1 text-gray-700",children:"Start Date"}),e.jsx("input",{id:"startDate",type:"date",value:l,onChange:t=>g(t.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",max:o||void 0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm font-medium mb-1 text-gray-700",children:"End Date"}),e.jsx("input",{id:"endDate",type:"date",value:o,onChange:t=>f(t.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:l||void 0})]})]}),u&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Fetching attendance data..."}),e.jsxs("span",{children:[j,"%"]})]}),e.jsx(X,{value:j})]})]})}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time In"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Break In"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Break Out"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time Out"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Night Shift"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Next Day Timeout"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:D.length>0?D.map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.idno}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(t.attendance_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:x(t.time_in)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:x(t.break_in)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:x(t.break_out)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:x(t.time_out)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.is_nightshift?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:t.is_nightshift?"Yes":"No"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:x(t.next_day_timeout)})]},s)):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No attendance records found"})})})]})})]})})]})})]})]})};export{ne as default};
