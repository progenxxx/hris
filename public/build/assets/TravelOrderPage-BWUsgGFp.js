import{V as F,r as p,j as e,M as $,h}from"./app-C_ClQmDY.js";import{A as C}from"./AuthenticatedLayout-3cR_usYW.js";import{S as D}from"./Sidebar-Bhx-DaaE.js";import U from"./TravelOrderList-DeFdHmzz.js";import B from"./TravelOrderForm-BZs-_Bvo.js";import{y as l,L as _}from"./index-CBJp45S4.js";/* empty css                      */import{L as b}from"./loader-circle-OBm8GvlE.js";import{M as R}from"./map-pin-CbTR9kKl.js";import{P as V}from"./plus-D1sl-ovH.js";import{L as z}from"./list-filter-BHZxFC6E.js";import"./ApplicationLogo-BORf3137.js";import"./Dropdown-CHXQRgIL.js";import"./transition-0ACRCynB.js";import"./search-BDKFcNkb.js";import"./createLucideIcon-D1ADp28Z.js";import"./x-Q1lJB2Tb.js";/* empty css                */import"./users-Dr4YdQlV.js";import"./file-text-DMC5LN9m.js";import"./calendar-B28JSqfz.js";import"./StatusBadge-Cpkf1_8K.js";import"./TravelOrderDetailModal-BJI5D2uW.js";import"./user-CzeVpIfb.js";import"./building-DbcHZy7m.js";import"./clock-CtBUUqYK.js";import"./car-CfDqhZ4e.js";import"./info-DwyHYYuk.js";import"./dollar-sign-EMsHpLE5.js";import"./download-BQI3-SNa.js";import"./triangle-alert-BvRbjIm5.js";import"./circle-check-big-CRb1LywB.js";import"./circle-x-CQhehAg2.js";import"./format-Ur_Fko9Q.js";import"./parseISO-y7BAppcC.js";import"./MultiBulkActionModal-tYJJV_gl.js";import"./clsx-B-dksMZM.js";import"./TravelOrderForceApproveButton-BpVqvRYZ.js";import"./zap-BqYNij_k.js";import"./upload-CTtdx_s7.js";const Ee=()=>{const{props:y}=F(),{auth:j,flash:c={},userRoles:w={},travelOrders:N=[],employees:O=[],departments:S=[],transportationTypes:T=[]}=y,[m,u]=p.useState(N),[x,A]=p.useState("create"),[n,t]=p.useState(!1),[P,f]=p.useState(!1);p.useEffect(()=>{c&&c.message&&l.success(c.message),c&&c.error&&l.error(c.error),c&&c.errors&&Array.isArray(c.errors)&&c.errors.forEach(s=>{l.error(s)})},[c]);const E=s=>new Promise((o,d)=>{t(!0),f(!0),h.post(route("travel-orders.store"),s,{preserveScroll:!0,forceFormData:!0,onStart:()=>{},onSuccess:r=>{r.props.travelOrders&&u(r.props.travelOrders),l.success("Travel orders created successfully"),t(!1),f(!1),o(r)},onError:r=>{t(!1),f(!1),r&&typeof r=="object"?Object.keys(r).forEach(a=>{Array.isArray(r[a])?r[a].forEach(i=>l.error(i)):l.error(r[a])}):l.error("An error occurred while submitting form"),d(r)},onFinish:()=>{t(!1),f(!1)}})}),L=(s,o)=>n?Promise.reject("Already processing"):(console.log("Status update called with:",s,o),t(!0),new Promise((d,r)=>{h.post(route("travel-orders.updateStatus",s),o,{preserveScroll:!0,onSuccess:a=>{a.props.travelOrders&&u(a.props.travelOrders),d(a)},onError:a=>{let i="An error occurred while updating status";a&&typeof a=="object"&&(i=Object.values(a).join(", ")),r(i)}})}).then(()=>{l.success("Travel order status updated successfully"),t(!1)}).catch(d=>{throw l.error(d),t(!1),d})),M=(s,o,d)=>n?Promise.reject("Already processing"):(t(!0),new Promise((r,a)=>{h.post(route("travel-orders.bulkUpdateStatus"),{travel_order_ids:s,status:o,remarks:d},{preserveScroll:!0,onSuccess:i=>{i.props.travelOrders&&u(i.props.travelOrders),r(i)},onError:i=>{let g="An error occurred while updating status";i&&typeof i=="object"&&(g=Object.values(i).join(", ")),a(g)}})}).then(()=>{const r=o==="rejected"?"rejected":o==="force_approved"?"force approved":o==="completed"?"marked as completed":o==="cancelled"?"cancelled":"approved";l.success(`Successfully ${r} ${Array.isArray(s)?s.length:1} travel order${Array.isArray(s)&&s.length!==1?"s":""}`),t(!1)}).catch(r=>{throw l.error(r),t(!1),r})),k=s=>{confirm("Are you sure you want to delete this travel order?")&&(t(!0),h.delete(route("travel-orders.destroy",s),{preserveScroll:!0,onSuccess:o=>{o.props.travelOrders?u(o.props.travelOrders):u(m.filter(d=>d.id!==s)),l.success("Travel order deleted successfully"),t(!1)},onError:()=>{l.error("Failed to delete travel order"),t(!1)},onFinish:()=>{t(!1)}}))},v=s=>{n||A(s)};return p.useEffect(()=>(window.refreshTravelOrders=async()=>{try{return m}catch(s){return console.error("Error refreshing travel orders:",s),m}},()=>{delete window.refreshTravelOrders}),[m]),e.jsxs(C,{user:j.user,children:[e.jsx($,{title:"Travel Order Management"}),e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(D,{}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg text-center",children:[e.jsx(b,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-indigo-600"}),e.jsx("p",{className:"text-gray-700",children:"Processing travel orders..."})]})}),e.jsx("div",{className:"flex-1 p-8 ml-0",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:[e.jsx(R,{className:"inline-block w-7 h-7 mr-2 text-indigo-600"}),"Travel Order Management"]}),e.jsx("p",{className:"text-gray-600",children:"Manage employee travel orders and approvals"})]}),n&&e.jsxs("div",{className:"flex items-center text-indigo-600",children:[e.jsx(b,{className:"h-5 w-5 animate-spin mr-2"}),e.jsx("span",{className:"text-sm",children:"Processing..."})]})]}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg",children:e.jsxs("div",{className:"p-6 bg-white border-b border-gray-200",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{className:`${x==="create"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center transition-colors ${n?"opacity-50 cursor-not-allowed":""}`,onClick:()=>v("create"),disabled:n,children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"File New Travel Order"]}),e.jsxs("button",{className:`${x==="list"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center transition-colors ${n?"opacity-50 cursor-not-allowed":""}`,onClick:()=>v("list"),disabled:n,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"View Travel Orders",m.length>0&&e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs",children:m.length})]})]})})}),e.jsx("div",{className:`transition-opacity duration-200 ${n?"opacity-50":""}`,children:x==="list"?e.jsx(U,{travelOrders:m,onStatusUpdate:L,onBulkStatusUpdate:M,onDelete:k,userRoles:w,processing:n}):e.jsx(B,{employees:O,departments:S,transportationTypes:T,onSubmit:E,processing:n})})]})})]})})]}),e.jsx(_,{position:"top-right",autoClose:3e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"})]})};export{Ee as default};
