import{r as a,j as e}from"./app-7K62fd2B.js";import{B as N}from"./Button-B-ixrUdq.js";import{A as v,a as w}from"./alert-Cw6Swk3l.js";import{U as D}from"./upload-BWFV_Ypm.js";import{X as T}from"./x-4sBMcqny.js";import{T as F}from"./triangle-alert-BFKAbd31.js";import{C as H}from"./circle-check-big-CdHds-fH.js";import{F as M}from"./file-text-B0cEX_Vi.js";import{L as I}from"./loader-circle-CCcIPQox.js";import{C as y}from"./calendar-CWo9dUpk.js";import{C as O}from"./calculator-NMlYC2-D.js";import{U as A}from"./users-D-OfZtV9.js";import"./clsx-B-dksMZM.js";import"./createLucideIcon-BK5csKvN.js";const Q=({isOpen:S,onClose:C,onImport:u})=>{const[d,o]=a.useState(null),[x,i]=a.useState(!1),[h,t]=a.useState(""),[p,m]=a.useState(""),[n,f]=a.useState(null),c=a.useRef(null),j=l=>{const s=l.target.files[0];if(s){if(s.type!=="text/csv"&&!s.name.endsWith(".csv")){t("Please select a CSV file");return}if(s.size>10*1024*1024){t("File size must be less than 10MB");return}o(s),t("")}},g=async()=>{if(!d){t("Please select a file first");return}i(!0),t(""),m("");try{const l=new FormData;l.append("file",d);const s=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),r=await(await fetch("/attendance/import",{method:"POST",headers:{"X-CSRF-TOKEN":s,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:l})).json();r.success?(m(r.message),f(r),u&&u()):(t(r.message||"Import failed"),r.errors&&r.errors.length>0&&t(r.message+`

Errors:
`+r.errors.join(`
`)))}catch(l){console.error("Import error:",l),t("Import failed: "+(l.message||"Unknown error"))}finally{i(!1)}},k=()=>{o(null),t(""),m(""),f(null),c.current&&(c.current.value="")},b=()=>{k(),C()};return S?e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(D,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Import Attendance Data"})]}),e.jsx("button",{onClick:b,className:"text-gray-500 hover:text-gray-700","aria-label":"Close",children:e.jsx(T,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[h&&e.jsxs(v,{variant:"destructive",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),e.jsx(w,{className:"whitespace-pre-line",children:h})]}),p&&e.jsxs(v,{className:"border-green-200 bg-green-50",children:[e.jsx(H,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx(w,{className:"text-green-800",children:p})]}),n&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Import Results:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Imported:"})," ",n.imported," records"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Updated:"})," ",n.updated," records"]}),n.errors&&n.errors.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium text-red-600",children:"Errors:"})," ",n.errors.length,e.jsx("div",{className:"mt-1 text-xs text-red-600 max-h-20 overflow-y-auto",children:n.errors.map((l,s)=>e.jsx("div",{children:l},s))})]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(M,{className:"h-5 w-5 text-blue-600 mt-0.5 mr-2 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Import Instructions:"}),e.jsxs("ul",{className:"space-y-1 list-disc ml-4",children:[e.jsx("li",{children:"Use the CSV format with columns: Employee Number, Employee Name, Department, Date, Day, Time In, Break Out, Break In, Time Out, Next Day Timeout, Hours Worked, Night Shift, Trip"}),e.jsx("li",{children:"Time format should be HH:MM (24-hour format, e.g., 08:30, 17:00)"}),e.jsx("li",{children:"Date format should be YYYY-MM-DD (e.g., 2024-12-25)"}),e.jsx("li",{children:'Night Shift should be "Yes" or "No"'}),e.jsx("li",{children:"Hours will be automatically calculated based on time entries"}),e.jsx("li",{children:"Existing records will be updated, new records will be created"})]})]})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select CSV File"}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("input",{ref:c,type:"file",accept:".csv,text/csv",onChange:j,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})}),d&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",d.name," (",(d.size/1024).toFixed(1)," KB)"]})]})})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex justify-end space-x-3 border-t",children:[e.jsx(N,{variant:"outline",onClick:b,disabled:x,children:"Cancel"}),e.jsx(N,{onClick:g,disabled:!d||x,className:"bg-blue-600 hover:bg-blue-700",children:x?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Import Data"]})})]})]})}):null},Z=({isOpen:S,onClose:C,onSetHoliday:u,departments:d=[]})=>{const[o,x]=a.useState(""),[i,h]=a.useState("2.0"),[t,p]=a.useState(""),[m,n]=a.useState(!1),[f,c]=a.useState(""),[j,g]=a.useState(""),k=async()=>{if(!o){c("Please select a date");return}if(!i||parseFloat(i)<=0){c("Please enter a valid multiplier");return}n(!0),c(""),g("");try{const s=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),r=await(await fetch("/attendance/set-holiday",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:JSON.stringify({date:o,multiplier:parseFloat(i),department:t||null})})).json();r.success?(g(r.message),u&&u(),setTimeout(()=>{l()},2e3)):c(r.message||"Failed to set holiday")}catch(s){console.error("Set holiday error:",s),c("Failed to set holiday: "+(s.message||"Unknown error"))}finally{n(!1)}},b=()=>{x(""),h("2.0"),p(""),c(""),g("")},l=()=>{b(),C()};return S?e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg max-w-lg w-full mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{className:"h-6 w-6 text-green-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Set Holiday"})]}),e.jsx("button",{onClick:l,className:"text-gray-500 hover:text-gray-700","aria-label":"Close",children:e.jsx(T,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[f&&e.jsxs(v,{variant:"destructive",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),e.jsx(w,{children:f})]}),j&&e.jsxs(v,{className:"border-green-200 bg-green-50",children:[e.jsx(H,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx(w,{className:"text-green-800",children:j})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(y,{className:"h-5 w-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Holiday Setting Rules:"}),e.jsxs("ul",{className:"space-y-1 list-disc ml-4",children:[e.jsx("li",{children:"Holiday multiplier will only be applied to employees who don't have overtime (OT, OT Reg, or OT Spl)"}),e.jsx("li",{children:"Only non-posted attendance records will be affected"}),e.jsx("li",{children:"Common multipliers: 2.0 (Regular Holiday), 1.3 (Special Holiday)"}),e.jsx("li",{children:"You can filter by department or apply to all departments"})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Holiday Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"date",value:o,onChange:s=>x(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Holiday Multiplier ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",step:"0.1",min:"0.1",max:"10",value:i,onChange:s=>h(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"2.0"})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Common values: 2.0 (Regular Holiday), 1.3 (Special Holiday)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:t,onChange:s=>p(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Departments"}),d.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Leave empty to apply to all departments"})]})]}),o&&i&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-2",children:"Preview:"}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsxs("div",{children:["Date: ",e.jsx("span",{className:"font-medium",children:new Date(o).toLocaleDateString()})]}),e.jsxs("div",{children:["Multiplier: ",e.jsxs("span",{className:"font-medium",children:[i,"x"]})]}),e.jsxs("div",{children:["Department: ",e.jsx("span",{className:"font-medium",children:t||"All Departments"})]}),e.jsx("div",{className:"mt-2 text-xs",children:"This will update all eligible attendance records (no existing overtime) for the selected criteria."})]})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex justify-end space-x-3 border-t",children:[e.jsx(N,{variant:"outline",onClick:l,disabled:m,children:"Cancel"}),e.jsx(N,{onClick:k,disabled:!o||!i||m,className:"bg-green-600 hover:bg-green-700",children:m?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}),"Setting Holiday..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Set Holiday"]})})]})]})}):null};export{Z as HolidayModal,Q as ImportModal,Q as default};
