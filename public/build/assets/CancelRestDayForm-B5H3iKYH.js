import{r as p,j as e}from"./app-7K62fd2B.js";import{f as K}from"./format-Bw_hER4B.js";const V=({employees:f,departments:$,onSubmit:F,userRoles:D={}})=>{const g=K(new Date,"yyyy-MM-dd"),[a,y]=p.useState({employee_ids:[],rest_day_date:g,replacement_work_date:g,reason:""}),[u,q]=p.useState(f||[]),[x,E]=p.useState(""),[N,R]=p.useState(""),j=D.isSuperAdmin||D.isHrdManager;p.useEffect(()=>{let t=[],s=[],d=[],r=[],c=[],k=[];f.forEach(n=>{var w;const h=a.employee_ids.includes(n.id);let o=!0,i=!1;if(x){const l=x.toLowerCase().trim(),_=(n.Fname||"").toLowerCase(),v=(n.Lname||"").toLowerCase(),J=(n.MName||"").toLowerCase(),z=`${_} ${v}`.trim(),G=`${v} ${_}`.trim(),C=(w=n.idno)==null?void 0:w.toString().toLowerCase(),A=(n.name||"").toLowerCase();_===l||v===l||z===l||G===l||A===l||C===l?(i=!0,o=!0):o=_.includes(l)||v.includes(l)||J.includes(l)||A.includes(l)||(C==null?void 0:C.includes(l))}let b=!0;N&&(b=(n.department||n.Department||"")===N),b&&(h&&i?t.push(n):h&&o?s.push(n):h?d.push(n):i?r.push(n):o?c.push(n):x||k.push(n))});const m=(n,h)=>{const o=i=>{if(i.name)return i.name.toLowerCase();const b=i.Lname||"",w=i.Fname||"";return`${b}, ${w}`.toLowerCase()};return o(n).localeCompare(o(h))};t.sort(m),s.sort(m),d.sort(m),r.sort(m),c.sort(m),k.sort(m);const Y=[...t,...s,...d,...r,...c,...k];q(Y)},[x,N,f,a.employee_ids]);const S=t=>{const{name:s,value:d}=t.target;y({...a,[s]:d})},L=t=>{const s=parseInt(t,10);y(d=>d.employee_ids.includes(s)?{...d,employee_ids:d.employee_ids.filter(r=>r!==s)}:{...d,employee_ids:[...d.employee_ids,s]})},I=(t,s)=>{t.stopPropagation(),L(s)},T=()=>{y(t=>{const s=u.map(r=>r.id);if(s.every(r=>t.employee_ids.includes(r)))return{...t,employee_ids:t.employee_ids.filter(r=>!s.includes(r))};{const r=t.employee_ids.filter(c=>!s.includes(c));return{...t,employee_ids:[...r,...s]}}})},B=t=>{if(t.preventDefault(),a.employee_ids.length===0){alert("Please select at least one employee");return}if(!a.rest_day_date){alert("Please select the rest day date to cancel");return}if(!j&&new Date(a.rest_day_date)<new Date(g)){alert("Cannot cancel rest day for past dates");return}if(a.replacement_work_date&&a.replacement_work_date===a.rest_day_date){alert("Replacement work date must be different from rest day date");return}if(!a.reason.trim()){alert("Please provide a reason for canceling the rest day");return}F(a),y({employee_ids:[],rest_day_date:"",replacement_work_date:"",reason:""}),E(""),R(""),window.scrollTo({top:0,behavior:"smooth"})},M=t=>{if(t.name)return t.name;const s=t.Fname||"",d=t.Lname||"",r=t.MName||"";let c=d;return s&&(c+=c?", "+s:s),r&&(c+=" "+r),c||`Employee #${t.id}`},H=t=>t.department||t.Department||"",O=t=>t.position||t.Jobtitle||"",P=u.length>0&&u.every(t=>a.employee_ids.includes(t.id)),W=f.filter(t=>a.employee_ids.includes(t.id));return e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Cancel Rest Day Request"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Create rest day cancellation request for one or multiple employees"}),j&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("span",{className:"font-medium",children:"Admin/HR Privilege:"})," You can select any date including past dates for rest day cancellation."]})})]}),e.jsxs("form",{onSubmit:B,children:[e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Select Employees"}),e.jsxs("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by name or ID",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-red-300 focus:ring focus:ring-red-200 focus:ring-opacity-50",value:x,onChange:t=>E(t.target.value)})}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{className:"w-full rounded-md border-gray-300 shadow-sm focus:border-red-300 focus:ring focus:ring-red-200 focus:ring-opacity-50",value:N,onChange:t=>R(t.target.value),children:[e.jsx("option",{value:"",children:"All Departments"}),$.map((t,s)=>e.jsx("option",{value:t,children:t},s))]})}),e.jsx("div",{className:"md:flex-initial",children:e.jsx("button",{type:"button",className:`w-full px-4 py-2 rounded-md ${P?"bg-red-700 hover:bg-red-800":"bg-red-500 hover:bg-red-600"} text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500`,onClick:T,children:P?"Deselect All":"Select All"})})]}),e.jsx("div",{className:"border rounded-md overflow-hidden max-h-60 overflow-y-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12",children:"Select"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Position"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-3 text-center text-sm text-gray-500",children:"No employees match your search criteria"})}):u.map(t=>e.jsxs("tr",{className:`hover:bg-gray-50 cursor-pointer ${a.employee_ids.includes(t.id)?"bg-red-50":""}`,onClick:()=>L(t.id),children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-red-600 shadow-sm focus:border-red-300 focus:ring focus:ring-red-200 focus:ring-opacity-50",checked:a.employee_ids.includes(t.id),onChange:s=>I(s,t.id),onClick:s=>s.stopPropagation()})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:t.idno||""}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:M(t)})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:H(t)}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500",children:O(t)})]},t.id))})]})}),e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:a.employee_ids.length>0?e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[a.employee_ids.length," employee(s) selected"]}),a.employee_ids.length<=5&&e.jsxs("span",{className:"ml-2",children:["(",W.map(t=>M(t).split(",")[0]).join(", "),")"]})]}):e.jsx("span",{className:"text-red-600",children:"No employees selected"})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Rest Day Cancellation Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"rest_day_date",className:"block text-sm font-medium text-gray-700 mb-1",children:["Rest Day to Cancel ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"date",id:"rest_day_date",name:"rest_day_date",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-red-300 focus:ring focus:ring-red-200 focus:ring-opacity-50",value:a.rest_day_date,onChange:S,min:j?void 0:g,required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:j?"You can select any date including past dates":"The scheduled rest day you want to cancel (future dates only)"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"replacement_work_date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Replacement Work Date (Optional)"}),e.jsx("input",{type:"date",id:"replacement_work_date",name:"replacement_work_date",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-red-300 focus:ring focus:ring-red-200 focus:ring-opacity-50",value:a.replacement_work_date,onChange:S}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Optional: When you'll work instead of the cancelled rest day"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Reason for Cancellation"}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700 mb-1",children:["Reason ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{id:"reason",name:"reason",rows:"5",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-red-300 focus:ring focus:ring-red-200 focus:ring-opacity-50",placeholder:"Provide a detailed reason for canceling the rest day",value:a.reason,onChange:S,required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Please provide a clear justification for canceling the rest day."})]})]})]}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6 border-t",children:e.jsx("button",{type:"submit",className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Submit Cancel Rest Day Request"})})]})]})};export{V as default};
