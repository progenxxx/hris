import{a as V,r as x,j as e,H as W}from"./app-7K62fd2B.js";import{A as L}from"./AuthenticatedLayout-DQzQmHv9.js";import{S as q}from"./Sidebar-Bpho9Ubl.js";import{p as X}from"./papaparse.min-B6jvVVPq.js";import{r as K,u as Z}from"./xlsx-BBWTpfDg.js";import{A as $,a as k}from"./alert-Cw6Swk3l.js";import{B as A}from"./Button-B-ixrUdq.js";import{C as G,a as J,b as Q,c as ee}from"./card-Bd2He_oM.js";import{D as te}from"./download-DiYogtYp.js";import{C as M}from"./circle-check-ms9Kxya9.js";import{C as se}from"./circle-x-2rCUmP_B.js";import{C as re}from"./cloud-upload-C8fKfedi.js";import{F as ae}from"./file-spreadsheet-BSWKZjuB.js";import{C as E}from"./circle-alert-CGQbi50W.js";import{C as ne}from"./clock-r6FcyLKi.js";import"./ApplicationLogo-IpRttWhS.js";import"./Dropdown-Yo6Rw43S.js";import"./transition-Di9UDWSH.js";import"./search-BmV-knWW.js";import"./createLucideIcon-BK5csKvN.js";import"./x-4sBMcqny.js";/* empty css                */import"./users-D-OfZtV9.js";import"./file-text-B0cEX_Vi.js";import"./calendar-CWo9dUpk.js";import"./clsx-B-dksMZM.js";const oe=X,le=()=>e.jsx("div",{className:"animate-spin h-5 w-5",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),_e=()=>{var D,F;const{auth:I}=V().props,[f,y]=x.useState(null),[j,_]=x.useState([]),[w,b]=x.useState(!1),[v,d]=x.useState(""),[p,S]=x.useState(null),[N,h]=x.useState(null),T=s=>{if(!s)return"";try{if(typeof s=="string"&&s.match(/^\d{1,2}\/\d{1,2}\/\d{4}$/)){const t=s.split("/");if(t.length===3){const o=String(parseInt(t[0],10)).padStart(2,"0"),r=String(parseInt(t[1],10)).padStart(2,"0");return`${t[2]}-${o}-${r}`}}if(typeof s=="number"){const t=new Date(1899,11,30),o=1440*60*1e3,r=new Date(t.getTime()+s*o),l=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),i=String(r.getDate()).padStart(2,"0");return`${l}-${n}-${i}`}if(typeof s=="string"){if(s.match(/^\d{1,2}[-\/][a-zA-Z]{3,}$/)){const[o,r]=s.split(/[-\/]/),n={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}[r.toLowerCase().substr(0,3)],i=new Date().getFullYear(),u=new Date(i,n,parseInt(o,10)),a=u.getFullYear(),c=String(u.getMonth()+1).padStart(2,"0"),m=String(u.getDate()).padStart(2,"0");return`${a}-${c}-${m}`}const t=new Date(s);if(!isNaN(t.getTime())){const o=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${o}-${r}-${l}`}}return s}catch{return s}},C=s=>{if(!s||s===0||s==="0"||s==="0:00"||s==="00:00"||s==="0:00:00"||s==="00:00:00")return"";try{if(typeof s=="number"){if(Math.abs(s)<1e-4)return"";const t=Math.round(s*86400),o=Math.floor(t/3600),r=Math.floor(t%3600/60),l=o>=12?"PM":"AM",n=o%12||12;return`${String(n).padStart(2,"0")}:${String(r).padStart(2,"0")} ${l}`}if(typeof s=="string"){if(/^\d{1,2}:\d{2}(:\d{2})?\s*(AM|PM)$/i.test(s))return s;if(/^\d{1,2}:\d{2}(:\d{2})?$/.test(s)){const[t,o]=s.split(":").map(Number),r=t>=12?"PM":"AM",l=t%12||12;return`${String(l).padStart(2,"0")}:${String(o).padStart(2,"0")} ${r}`}try{const t=new Date(`2000-01-01 ${s}`);if(!isNaN(t.getTime())){const o=t.getHours(),r=t.getMinutes(),l=o>=12?"PM":"AM",n=o%12||12;return`${String(n).padStart(2,"0")}:${String(r).padStart(2,"0")} ${l}`}}catch{}}return s}catch{return s}},H=s=>{if(s==null||s==="")return"";const t=parseFloat(s);return isNaN(t)?s:t.toFixed(2)},P=s=>{const t=s.map(a=>typeof a=="string"?a.toLowerCase().trim().replace(/\s+/g,"_").replace(/\.+$/,""):"");console.log("Original headers:",s),console.log("Normalized headers:",t);const o=t.some(a=>a==="employee"||a==="employeedate"||a==="employee_no"||a==="idno"||a==="id"),r=t.some(a=>a==="date"||a==="employeedate");let l=t.filter(a=>a==="in"),n=t.filter(a=>a==="out");l.length===0&&(l=t.filter(a=>a==="time_in"||a==="timein")),n.length===0&&(n=t.filter(a=>a==="time_out"||a==="timeout")),t.some(a=>a==="next_day"||a==="nextday"||a==="next"),t.some(a=>a==="hours_work"||a==="hours"||a==="work_hours"||a==="hours_worked");const i=[];return o||i.push("employee_no"),r||i.push("date"),l.length===0&&i.push("in"),n.length===0&&i.push("out"),{valid:o&&r&&l.length>0&&n.length>0,missingColumns:i,format:"specific_template"}},R=(s,t)=>{const o=t.map(r=>typeof r=="string"?r.toLowerCase().trim().replace(/\s+/g,"_").replace(/\.+$/,""):"");return s.map((r,l)=>{const n=o[l];if(!n)return r;const i=r==null||r===""||r===0||r==="0"||r===0;if(i)return"";const u=n==="employee"||n==="employeedate"||n==="employee_no"||n==="idno"||l===0,a=n==="date"||n==="employeedate"||l===1,c=n==="day"||l===2,m=n==="in"||n==="time_in",g=n==="out"||n==="time_out",B=n==="next_day"||n==="nextday",U=n==="hours_work"||n==="hours";return a?T(r):B?i||r==="0:00"||r==="00:00"||typeof r=="string"&&r.trim()===""?"":C(r):m||g?r==="0:00"||r==="00:00"?"":C(r):U?r===0||r==="0"||r===0?"":H(r):r})},O=x.useCallback(async s=>{const t=s.target.files[0];if(!t)return;if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(t.type)&&!t.name.endsWith(".csv")&&!t.name.endsWith(".xlsx")&&!t.name.endsWith(".xls")){d("Please upload only Excel or CSV files (.xlsx, .xls, .csv)"),h("error");return}if(t.size>10*1024*1024){d("File size should not exceed 10MB"),h("error");return}y(t),d(""),h("validating");const r=new FileReader;r.onload=async l=>{try{let n;if(t.name.endsWith(".csv")){const a=l.target.result;n=oe.parse(a,{header:!1,skipEmptyLines:!0}).data}else{const a=new Uint8Array(l.target.result),c=K(a,{type:"array",cellDates:!0,dateNF:"yyyy-mm-dd"}),m=c.SheetNames[0],g=c.Sheets[m];n=Z.sheet_to_json(g,{header:1,raw:!1,defval:""})}if(!n[0]||n[0].length===0)throw new Error("File appears to be empty");const i=P(n[0]);if(!i.valid){d(`Missing required columns: ${i.missingColumns.join(", ")}`),h("error"),y(null);return}const u=n.filter((a,c)=>c===0?!0:a.some((m,g)=>g>0&&m!==null&&m!==void 0&&m!=="")).slice(0,6).map((a,c)=>c===0?a:R(a,n[0]));_(u),h("success")}catch(n){console.error("Error reading file:",n),d("Error reading file. Please make sure it's a valid Excel or CSV file."),h("error"),y(null)}},t.name.endsWith(".csv")?r.readAsText(t):r.readAsArrayBuffer(t)},[]),Y=async()=>{if(!f){d("Please select a file first");return}b(!0),d(""),S(null);const s=new FormData;s.append("file",f);try{const t=await fetch("/attendance/import",{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},credentials:"same-origin",body:s}),o=await t.json();if(!t.ok)throw new Error(o.error||o.message||"Import failed");S(o)}catch(t){console.error("Import error:",t),d(t.message||"Import failed. Please try again.")}finally{b(!1)}},z=async()=>{try{window.location.href="/attendance/template/download"}catch(s){console.error("Download error:",s),d("Failed to download template: "+s.message)}};return e.jsxs(L,{user:I.user,children:[e.jsx(W,{title:"Import Attendance Records"}),e.jsxs("div",{className:"flex min-h-screen bg-gray-50/50",children:[e.jsx(q,{}),e.jsx("div",{className:"flex-1 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Import Attendance Records"}),e.jsx("p",{className:"text-gray-600",children:"Bulk import employee attendance data using our Excel template."})]})}),e.jsxs(G,{className:"max-w-4xl mx-auto",children:[e.jsxs(J,{children:[e.jsx(Q,{children:"Import Attendance"}),e.jsx("p",{className:"text-gray-600",children:"Upload your Excel file containing attendance records with the format matching the sample template."})]}),e.jsx(ee,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800 mb-2",children:"Expected Format:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx("div",{className:"col-span-3 text-sm text-blue-700 mb-2",children:"Your Excel file should have these columns:"}),e.jsxs("div",{className:"flex items-center text-sm text-blue-700",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),"Employee No."]}),e.jsxs("div",{className:"flex items-center text-sm text-blue-700",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),"Date (MM/DD/YYYY)"]}),e.jsxs("div",{className:"flex items-center text-sm text-blue-700",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),"Day"]}),e.jsxs("div",{className:"flex items-center text-sm text-blue-700",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),"IN (Time In)"]}),e.jsxs("div",{className:"flex items-center text-sm text-blue-700",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),"OUT (Time Out)"]}),e.jsxs("div",{className:"flex items-center text-sm text-blue-700",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),"IN (Break In)"]}),e.jsxs("div",{className:"flex items-center text-sm text-blue-700",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),"OUT (Break Out)"]}),e.jsxs("div",{className:"flex items-center text-sm text-blue-700",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),"Next day"]}),e.jsxs("div",{className:"flex items-center text-sm text-blue-700",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),"Hours Work"]})]})]}),e.jsxs(A,{onClick:z,variant:"outline",className:"w-full",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Download Attendance Import Template"]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8",children:[e.jsx("input",{type:"file",onChange:O,className:"hidden",id:"file-upload",accept:".xlsx,.xls,.csv"}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer flex flex-col items-center",children:[N==="success"?e.jsx(M,{className:"h-12 w-12 text-green-500 mb-4"}):N==="error"?e.jsx(se,{className:"h-12 w-12 text-red-500 mb-4"}):e.jsx(re,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("span",{className:"text-gray-600 text-center",children:f?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),f.name]}):"Drop your Excel file here or click to browse"})]})]}),j.length>0&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:j[0].map((s,t)=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s},t))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.slice(1).map((s,t)=>e.jsx("tr",{children:s.map((o,r)=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:o??""},r))},t))})]})})}),v&&e.jsxs($,{variant:"destructive",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(k,{children:v})]}),p&&e.jsx($,{variant:((D=p.failures)==null?void 0:D.length)===0?"default":"warning",children:e.jsx(k,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"font-medium",children:p.message})]}),p.successful>0&&e.jsxs("div",{className:"text-sm text-green-600",children:["Total records processed: ",p.total_processed]}),((F=p.failures)==null?void 0:F.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx(E,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"font-medium",children:"Failed Imports"})]}),e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border-l-2 border-amber-200 pl-4",children:p.failures.map((s,t)=>e.jsxs("div",{className:"text-sm text-amber-600 mb-1",children:["Row ",s.row,": ",s.errors.join(", ")]},t))})]})]})})}),e.jsx(A,{onClick:Y,disabled:!f||w||N!=="success",className:"w-full",children:w?e.jsxs(e.Fragment,{children:[e.jsx(le,{}),e.jsx("span",{className:"ml-2",children:"Importing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Upload and Import Attendance"]})})]})})]})]})})]})]})};export{_e as default};
