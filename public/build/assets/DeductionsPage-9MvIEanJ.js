import{V as ae,r as f,j as e,M as ce,h as P,b as p}from"./app-C_ClQmDY.js";import{A as de}from"./AuthenticatedLayout-3cR_usYW.js";import{S as ie}from"./Sidebar-Bhx-DaaE.js";import le from"./DeductionsTable-C-_ZalqC.js";import ue from"./DeductionsFilters-CThnakHN.js";import fe from"./DeductionsStatusCards-BGg9MWHC.js";import{B as x}from"./Button-Du7mhroA.js";import{A as me,a as pe}from"./alert-CLB16PDI.js";import{C as he}from"./ConfirmModal-D_xoNxPu.js";import{l as ge}from"./lodash-DJVfGrwh.js";import{U as xe}from"./upload-CTtdx_s7.js";import{D as O}from"./download-BQI3-SNa.js";import{P as be}from"./plus-D1sl-ovH.js";import{T as we}from"./trash-2-D_IcoVGU.js";import{S as je}from"./save-BXp290R1.js";import"./ApplicationLogo-BORf3137.js";import"./Dropdown-CHXQRgIL.js";import"./transition-0ACRCynB.js";import"./search-BDKFcNkb.js";import"./createLucideIcon-D1ADp28Z.js";import"./x-Q1lJB2Tb.js";/* empty css                */import"./users-Dr4YdQlV.js";import"./file-text-DMC5LN9m.js";import"./calendar-B28JSqfz.js";import"./checkbox-WaPCWkeV.js";import"./xlsx-vauHSbSi.js";import"./circle-alert-xhzyFgGA.js";import"./star-DKJPFIbD.js";import"./lock-DPLG-IKK.js";import"./clsx-B-dksMZM.js";import"./card-Cx-sVNbO.js";import"./check-D3tZ-Yap.js";const et=({employees:d,cutoff:_,month:F,year:M,search:V,status:l,dateRange:D,flash:y})=>{const{auth:$}=ae().props||{},B=($==null?void 0:$.user)||{},[I,j]=f.useState((d==null?void 0:d.data)||[]),[C,i]=f.useState(!1),[s,L]=f.useState({cutoff:_||"1st",month:F||new Date().getMonth()+1,year:M||new Date().getFullYear(),search:V||""}),[u,m]=f.useState({isOpen:!1,title:"",message:"",confirmText:"",confirmVariant:"destructive",onConfirm:()=>{}}),[S,o]=f.useState((y==null?void 0:y.message)||null),[U,J]=f.useState({currentPage:(d==null?void 0:d.current_page)||1,perPage:(d==null?void 0:d.per_page)||50,total:(d==null?void 0:d.total)||0}),[Y,T]=f.useState(!1),[v,N]=f.useState(null);f.useEffect(()=>{d&&(J({currentPage:d.current_page||1,perPage:d.per_page||50,total:d.total||0}),j(d.data||[]))},[d]);const k=(t,a)=>{L(n=>{const r={...n,[t]:a};return t!=="page"?{...r,page:1}:r})},z=f.useCallback(ge.debounce(t=>{k("search",t)},300),[]),h=()=>{i(!0),P.visit(`/deductions?cutoff=${s.cutoff}&month=${s.month}&year=${s.year}&search=${s.search}`,{preserveState:!0,preserveScroll:!0,only:["employees","status","dateRange"],onFinish:()=>i(!1)})};f.useEffect(()=>{h()},[s.cutoff,s.month,s.year,s.search]);const E=async(t,a,n)=>{var r,g;try{const c=await p.patch(`/deductions/${t}/field`,{field:a,value:n});j(b=>b.map(w=>{if(w.deductions&&w.deductions.length>0&&w.deductions[0].id===t){const A=[...w.deductions];return A[0]=c.data,{...w,deductions:A}}return w}))}catch(c){console.error("Error updating deduction:",c),o(((g=(r=c.response)==null?void 0:r.data)==null?void 0:g.message)||"Error updating deduction"),setTimeout(()=>o(null),3e3)}},q=async t=>{var a,n;try{i(!0);const r=await p.post("/deductions/create-from-default",{employee_id:t,cutoff:s.cutoff,date:new Date(`${s.year}-${s.month}-${s.cutoff==="1st"?15:28}`).toISOString().split("T")[0]});return j(g=>g.map(c=>c.id===t?{...c,deductions:[r.data,...c.deductions||[]]}:c)),r.data}catch(r){return console.error("Error creating deduction:",r),o(((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Error creating deduction"),setTimeout(()=>o(null),3e3),null}finally{i(!1)}},G=async t=>{var a,n;try{const r=await p.post(`/deductions/${t}/post`);j(g=>g.map(c=>{if(c.deductions&&c.deductions.length>0&&c.deductions[0].id===t){const b=[...c.deductions];return b[0]=r.data,{...c,deductions:b}}return c})),h(),o("Deduction posted successfully"),setTimeout(()=>o(null),3e3)}catch(r){console.error("Error posting deduction:",r),o(((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Error posting deduction"),setTimeout(()=>o(null),3e3)}},H=async t=>{var a,n;if(!(!t||t.length===0))try{i(!0);const r=await p.post("/deductions/bulk-post",{deduction_ids:t});h(),o(`Successfully posted ${t.length} deductions`),setTimeout(()=>o(null),3e3)}catch(r){console.error("Error posting deductions in bulk:",r),o(((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Error posting deductions"),setTimeout(()=>o(null),3e3)}finally{i(!1)}},K=async t=>{var a,n;if(!(!t||t.length===0))try{i(!0);const r=await p.post("/deductions/bulk-set-default",{deduction_ids:t});h(),o(`Successfully set ${t.length} deductions as default`),setTimeout(()=>o(null),3e3)}catch(r){console.error("Error setting default deductions in bulk:",r),o(((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Error setting default deductions"),setTimeout(()=>o(null),3e3)}finally{i(!1)}},Q=()=>{m({isOpen:!0,title:"Post All Deductions",message:`Are you sure you want to post all deductions for the ${s.cutoff} cutoff of ${s.month}/${s.year}? This action cannot be undone.`,confirmText:"Post All",confirmVariant:"destructive",onConfirm:async()=>{var t,a;try{i(!0);const n=await p.post("/deductions/post-all",{cutoff:s.cutoff,start_date:D.start,end_date:D.end});h(),m({...u,isOpen:!1}),o(`${n.data.updated_count} deductions posted successfully`),setTimeout(()=>o(null),3e3)}catch(n){console.error("Error posting all deductions:",n),m({...u,isOpen:!1}),o(((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"Error posting deductions"),setTimeout(()=>o(null),3e3)}finally{i(!1)}}})},W=()=>{m({isOpen:!0,title:"Delete All Not Posted Deductions",message:`Are you sure you want to delete ALL not posted deductions for the ${s.cutoff} cutoff of ${s.month}/${s.year}? This action cannot be undone.`,confirmText:"Delete All Not Posted",confirmVariant:"destructive",onConfirm:async()=>{var t,a;try{i(!0);const n=await p.post("/deductions/delete-all-not-posted",{cutoff:s.cutoff,start_date:D.start,end_date:D.end});h(),m({...u,isOpen:!1}),o(`${n.data.deleted_count} not posted deductions deleted successfully`),setTimeout(()=>o(null),3e3)}catch(n){console.error("Error deleting not posted deductions:",n),m({...u,isOpen:!1}),o(((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"Error deleting deductions"),setTimeout(()=>o(null),3e3)}finally{i(!1)}}})},X=()=>{m({isOpen:!0,title:"Create Deductions for All Employees",message:`This will create deduction entries for all active employees for the ${s.cutoff} cutoff of ${s.month}/${s.year} using their default values.`,confirmText:"Create Deductions",confirmVariant:"default",onConfirm:async()=>{var t,a;try{i(!0);const n=await p.post("/deductions/bulk-create",{cutoff:s.cutoff,date:new Date(`${s.year}-${s.month}-${s.cutoff==="1st"?15:28}`).toISOString().split("T")[0]});h(),m({...u,isOpen:!1}),o(`${n.data.created_count} deduction entries created successfully`),setTimeout(()=>o(null),3e3)}catch(n){console.error("Error creating bulk deductions:",n),m({...u,isOpen:!1}),o(((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"Error creating deductions"),setTimeout(()=>o(null),3e3)}finally{i(!1)}}})},Z=async t=>{var a,n;try{const r=await p.post(`/deductions/${t}/set-default`);j(g=>g.map(c=>{if(c.deductions&&c.deductions.length>0&&c.deductions[0].id===t){const b=[...c.deductions];return b[0]=r.data,{...c,deductions:b}}return c})),o("Default deduction set successfully"),setTimeout(()=>o(null),3e3)}catch(r){console.error("Error setting default deduction:",r),o(((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Error setting default deduction"),setTimeout(()=>o(null),3e3)}},R=t=>{i(!0),P.visit(`/deductions?cutoff=${s.cutoff}&month=${s.month}&year=${s.year}&search=${s.search}&page=${t}`,{preserveState:!0,preserveScroll:!0,only:["employees"],onFinish:()=>i(!1)})},ee=()=>{window.location.href=`/deductions/export?cutoff=${s.cutoff}&month=${s.month}&year=${s.year}&search=${s.search}`},te=()=>{window.location.href="/deductions/template/download"},se=async()=>{var a,n;if(!v){o("Please select a file to import"),setTimeout(()=>o(null),3e3);return}const t=new FormData;t.append("file",v),t.append("cutoff",s.cutoff),t.append("date",new Date(`${s.year}-${s.month}-${s.cutoff==="1st"?15:28}`).toISOString().split("T")[0]);try{i(!0);const r=await p.post("/deductions/import",t,{headers:{"Content-Type":"multipart/form-data"}});T(!1),N(null),h(),r.data.errors&&r.data.errors.length>0?(o(`Import completed with ${r.data.errors.length} errors. Check console for details.`),console.log("Import errors:",r.data.errors)):o(`Successfully imported ${r.data.imported_count} deductions`),setTimeout(()=>o(null),5e3)}catch(r){console.error("Error importing deductions:",r),o(((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Error importing deductions"),setTimeout(()=>o(null),3e3)}finally{i(!1)}},oe=[{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}],re=new Date().getFullYear(),ne=Array.from({length:5},(t,a)=>re-2+a);return e.jsxs(de,{user:B,children:[e.jsx(ce,{title:"Employee Deductions"}),e.jsxs("div",{className:"flex min-h-screen bg-gray-50/50",children:[e.jsx(ie,{}),e.jsx("div",{className:"flex-1 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[S&&e.jsx(me,{className:"mb-4",children:e.jsx(pe,{children:S})}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Employee Deductions Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage employee deductions including advances, charges, meals, and miscellaneous deductions."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(x,{onClick:()=>T(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Import"]}),e.jsxs(x,{onClick:ee,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(x,{onClick:X,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200 flex items-center",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Create All"]}),e.jsxs(x,{onClick:W,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200 flex items-center",disabled:(l==null?void 0:l.pendingCount)===0,children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Delete All Not Posted"]}),e.jsxs(x,{onClick:Q,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors duration-200 flex items-center",disabled:(l==null?void 0:l.pendingCount)===0,children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Post All"]})]})]}),e.jsx(fe,{total:(l==null?void 0:l.allCount)||0,posted:(l==null?void 0:l.postedCount)||0,pending:(l==null?void 0:l.pendingCount)||0}),e.jsx(ue,{filters:s,months:oe,years:ne,onFilterChange:k,onSearch:z}),e.jsx("div",{className:"bg-white rounded-lg shadow mt-6",children:e.jsx(le,{employees:I,loading:C,onCellUpdate:E,onCreateDeduction:q,onPostDeduction:G,onSetDefault:Z,onBulkPostDeductions:H,onBulkSetDefaultDeductions:K,pagination:{...U,onPageChange:R,links:(d==null?void 0:d.links)||[]}})}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Import Deductions"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Excel File"}),e.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:t=>N(t.target.files[0]),className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:"Import will use current filter settings:"}),e.jsxs("ul",{className:"list-disc list-inside mt-1",children:[e.jsxs("li",{children:["Cutoff: ",s.cutoff]}),e.jsxs("li",{children:["Period: ",s.month,"/",s.year]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(x,{onClick:te,variant:"outline",size:"sm",className:"flex items-center",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Download Template"]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx(x,{variant:"outline",onClick:()=>{T(!1),N(null)},children:"Cancel"}),e.jsx(x,{onClick:se,disabled:!v||C,className:"bg-blue-600 hover:bg-blue-700 text-white",children:C?"Importing...":"Import"})]})]})}),e.jsx(he,{isOpen:u.isOpen,onClose:()=>m({...u,isOpen:!1}),title:u.title,message:u.message,confirmText:u.confirmText,confirmVariant:u.confirmVariant,onConfirm:u.onConfirm})]})})]})]})};export{et as default};
