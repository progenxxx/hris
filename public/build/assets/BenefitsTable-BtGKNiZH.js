import{r as N,j as e}from"./app-C_ClQmDY.js";import{B as S}from"./Button-Du7mhroA.js";import{C as q}from"./checkbox-WaPCWkeV.js";import{u as R,w as ae}from"./xlsx-vauHSbSi.js";import{C as ne}from"./circle-alert-xhzyFgGA.js";import{S as W}from"./save-BXp290R1.js";import{S as Y,a as re}from"./star-DKJPFIbD.js";import{P as ie}from"./plus-D1sl-ovH.js";import{L as le}from"./lock-DPLG-IKK.js";import{D as ce}from"./download-BQI3-SNa.js";import"./clsx-B-dksMZM.js";import"./createLucideIcon-D1ADp28Z.js";const oe=({value:i,isEditing:h,onChange:p,onSave:b,isDisabled:D,onKeyDown:k,rowIndex:v,colIndex:F,field:O,onClick:u,onCreateAndEdit:P,benefitExists:m})=>{const[x,C]=N.useState(i!==void 0?i.toString():"0.00"),d=N.useRef(null);N.useEffect(()=>{h&&d.current&&(d.current.focus(),d.current.select())},[h]),N.useEffect(()=>{i!==void 0&&C(i.toString())},[i]);const y=l=>{C(l.target.value),p&&p(l.target.value)},$=()=>{b&&b(x)},E=l=>{l.key==="Enter"&&(b&&b(x),l.preventDefault()),k&&k(l,v,F,O)},j=l=>{const B=(l.clipboardData||window.clipboardData).getData("text");if(B.includes("	")||B.includes(`
`)){l.preventDefault();const T=B.split(/\r\n|\n|\r/).filter(L=>L.trim()!=="").map(L=>L.split("	"));p&&p(x,{pastedData:T,rowIndex:v,colIndex:F})}};return D?e.jsx("div",{className:"px-3 py-2 text-right text-gray-700 cursor-default min-h-[36px] flex items-center justify-end",children:parseFloat(i||0).toFixed(2)}):h?e.jsx("div",{className:"px-3 py-2",children:e.jsx("input",{ref:d,type:"number",step:"0.01",min:"0",className:"w-full p-1 px-2 border border-blue-400 rounded text-right bg-white text-black font-medium focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:x,onChange:y,onBlur:$,onKeyDown:E,onPaste:j,"data-row":v,"data-col":F,"data-field":O,onClick:l=>l.stopPropagation(),style:{boxShadow:"0 0 0 1px rgba(59, 130, 246, 0.5)",fontSize:"14px",height:"32px"},autoComplete:"off"})}):e.jsx("div",{className:`px-3 py-2 text-right ${m?"text-gray-700":"text-gray-400"} cursor-pointer hover:bg-gray-100 min-h-[36px] flex items-center justify-end transition-colors`,onClick:l=>{l.stopPropagation(),m?u&&u():P&&P()},children:m?parseFloat(i||0).toFixed(2):"0.00"})},de=({selectedItems:i,onClearSelection:h,onBulkPost:p,onBulkSetDefault:b,onExportSelected:D,disabled:k})=>{const v=i.length;return v===0?null:e.jsxs("div",{className:"bg-blue-50 p-3 mb-4 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsxs("span",{className:"text-blue-700 font-medium",children:[v," ",v===1?"item":"items"," selected"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(S,{variant:"outline",size:"sm",className:"bg-white hover:bg-gray-50",onClick:h,children:"Clear Selection"}),e.jsxs(S,{variant:"outline",size:"sm",className:"bg-yellow-50 hover:bg-yellow-100 border-yellow-300",onClick:b,disabled:k,children:[e.jsx(Y,{className:"h-4 w-4 text-yellow-600 mr-1"}),"Set as Default"]}),e.jsxs(S,{variant:"outline",size:"sm",className:"bg-blue-50 hover:bg-blue-100 border-blue-300",onClick:D,disabled:k,children:[e.jsx(ce,{className:"h-4 w-4 text-blue-600 mr-1"}),"Export Selected"]}),e.jsxs(S,{variant:"outline",size:"sm",className:"bg-green-50 hover:bg-green-100 border-green-300",onClick:p,disabled:k,children:[e.jsx(W,{className:"h-4 w-4 text-green-600 mr-1"}),"Post Selected"]})]})]})},fe=({isOpen:i,title:h,message:p,onConfirm:b,onCancel:D})=>i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:h}),e.jsx("p",{className:"text-gray-600 mb-6",children:p}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(S,{variant:"outline",onClick:D,children:"Cancel"}),e.jsx(S,{variant:"default",className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:b,children:"Confirm"})]})]})}):null,Se=({employees:i,loading:h,onCellUpdate:p,onCreateBenefit:b,onPostBenefit:D,onSetDefault:k,onBulkPostBenefits:v,onBulkSetDefaultBenefits:F,onExportToExcel:O,pagination:u,fieldColumnsParam:P=["allowances","mf_shares","mf_loan","sss_loan","sss_prem","hmdf_loan","hmdf_prem","philhealth"]})=>{const m=Array.isArray(P)&&typeof P[0]=="string"?P.map(t=>({id:t,label:{allowances:"ALLOWANCES",mf_shares:"MF SHARES",mf_loan:"MF LOAN",sss_loan:"SSS LOAN",sss_prem:"SSS PREMIUM",hmdf_loan:"HMDF LOAN",hmdf_prem:"HMDF PREMIUM",philhealth:"PHILHEALTH"}[t]||t.replace("_"," ").toUpperCase(),width:"130px"})):P,[x,C]=N.useState(null),[d,y]=N.useState([]),[$,E]=N.useState(!1),[j,l]=N.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[z,B]=N.useState(null);N.useEffect(()=>{y([]),E(!1)},[i]);const H=(t,n,s,r,o)=>{n&&C({employeeId:t,benefitId:n,field:s,rowIndex:r,colIndex:o})},T=(t,n,s,r)=>{B({employeeId:t,field:n,rowIndex:s,colIndex:r}),b(t)};N.useEffect(()=>{if(z){const{employeeId:t,field:n,rowIndex:s,colIndex:r}=z,o=i.find(a=>a.id===t),f=o!=null&&o.benefits&&o.benefits.length>0?o.benefits[0]:null;f&&(C({employeeId:t,benefitId:f.id,field:n,rowIndex:s,colIndex:r}),B(null))}},[i,z]);const L=(t,n,s,r)=>{if(r&&r.pastedData){G(r.pastedData,r.rowIndex,r.colIndex);return}p(t,n,s),C(null)},G=(t,n,s)=>{const r=m.reduce((o,f,a)=>(o[a]=f.id,o),{});t.forEach((o,f)=>{o.forEach((a,c)=>{const w=n+f,g=s+c;if(w>=i.length||g>=m.length)return;const A=i[w],M=_(A);if(!M||M.is_posted)return;const V=r[g];if(V){const U=parseFloat(a);isNaN(U)||p(M.id,V,U)}})}),C(null)},I=(t,n,s,r)=>{const o=i[n],f=_(o);if(!f)return;let a=n,c=s;switch(t.key){case"ArrowUp":a=Math.max(0,n-1),t.preventDefault();break;case"ArrowDown":a=Math.min(i.length-1,n+1),t.preventDefault();break;case"ArrowLeft":c=Math.max(0,s-1),t.preventDefault();break;case"ArrowRight":c=Math.min(m.length-1,s+1),t.preventDefault();break;case"Tab":t.shiftKey?(c--,c<0&&(a=Math.max(0,a-1),c=m.length-1)):(c++,c>=m.length&&(a=Math.min(i.length-1,a+1),c=0)),t.preventDefault();break;default:return}if(a!==n||c!==s){const w=i[a],g=_(w),A=m[c].id;if(x){const M=document.querySelector(`input[data-row="${n}"][data-col="${s}"]`);M&&p(f.id,r,M.value)}g&&!g.is_posted?C({employeeId:w.id,benefitId:g.id,field:A,rowIndex:a,colIndex:c}):g||T(w.id,A,a,c)}},_=t=>t.benefits&&t.benefits.length>0?t.benefits[0]:null,J=t=>t&&t.is_posted,Q=t=>t&&t.is_default,K=t=>`${t.Lname}, ${t.Fname} ${t.MName||""}`.trim(),X=(t,n)=>{n&&n.stopPropagation(),d.includes(t)?y(d.filter(s=>s!==t)):y([...d,t])},Z=t=>{if(t&&t.stopPropagation(),$)y([]);else{const n=i.map(s=>_(s)).filter(s=>s&&!s.is_posted).map(s=>s.id);y(n)}E(!$)},ee=()=>{if(d.length===0)return;const t=i.filter(n=>{const s=_(n);return s&&d.includes(s.id)});if(O)O(t);else{const n=R.book_new(),s=t.map(c=>{const w=_(c),g={"Employee ID":c.idno||"","Employee Name":K(c),Department:c.Department||""};return m.forEach(A=>{g[A.label]=w?parseFloat(w[A.id]||0).toFixed(2):"0.00"}),g}),r=R.json_to_sheet(s),o=[{wch:15},{wch:30},{wch:20}];m.forEach(()=>{o.push({wch:15})}),r["!cols"]=o,R.book_append_sheet(n,r,"Benefits");const f=new Date,a=`${f.getFullYear()}-${String(f.getMonth()+1).padStart(2,"0")}-${String(f.getDate()).padStart(2,"0")}`;ae(n,`employee_benefits_${a}.xlsx`)}},te=()=>{d.length!==0&&l({isOpen:!0,title:"Post Selected Benefits",message:`Are you sure you want to post ${d.length} selected benefits? This action cannot be undone.`,onConfirm:()=>{v(d),y([]),E(!1),l({...j,isOpen:!1})}})},se=()=>{d.length!==0&&l({isOpen:!0,title:"Set as Default Benefits",message:`Are you sure you want to set ${d.length} selected benefits as default? This will override existing default values.`,onConfirm:()=>{F(d),y([]),E(!1),l({...j,isOpen:!1})}})};return i.length===0&&!h?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(ne,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Benefits Found"}),e.jsx("p",{children:"There are no benefits to display for the selected filters."})]}):e.jsxs("div",{className:"overflow-hidden",children:[e.jsx(de,{selectedItems:d,onClearSelection:()=>{y([]),E(!1)},onBulkPost:te,onBulkSetDefault:se,onExportSelected:ee,disabled:h}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-12 px-3 py-3 text-center",children:e.jsx("div",{className:"flex items-center justify-center cursor-pointer",onClick:t=>Z(t),children:e.jsx(q,{checked:$,onCheckedChange:t=>{},disabled:h,className:"h-4 w-4"})})}),e.jsx("th",{className:"w-24 px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ACTIONS"}),e.jsx("th",{className:"w-64 px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"EMPLOYEE"}),m.map(t=>e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",style:{width:t.width},children:t.label},t.id)),e.jsx("th",{className:"w-24 px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"STATUS"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h?e.jsx("tr",{children:e.jsx("td",{colSpan:m.length+4,className:"px-3 py-4 text-center text-gray-500",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"}),e.jsx("span",{children:"Loading..."})]})})}):i.map((t,n)=>{const s=_(t),r=J(s),o=Q(s),f=s?d.includes(s.id):!1;return e.jsxs("tr",{className:`hover:bg-gray-50 ${r?"bg-gray-50":""} ${f?"bg-blue-50":""}`,children:[e.jsx("td",{className:"w-12 px-3 py-3 text-center",children:s&&!r?e.jsx("div",{className:"flex items-center justify-center cursor-pointer",onClick:a=>X(s.id,a),children:e.jsx(q,{checked:f,onCheckedChange:a=>{},className:"h-4 w-4"})}):e.jsx("div",{className:"h-4 w-4"})}),e.jsx("td",{className:"w-24 px-3 py-3",children:e.jsx("div",{className:"flex space-x-1",children:s?e.jsxs(e.Fragment,{children:[!r&&e.jsx(S,{variant:"outline",size:"sm",className:"p-1 h-8 w-8",onClick:a=>{a.stopPropagation(),l({isOpen:!0,title:"Post Benefit",message:"Are you sure you want to post this benefit? This action cannot be undone.",onConfirm:()=>{D(s.id),l({...j,isOpen:!1})}})},title:"Post Benefit",children:e.jsx(W,{className:"h-3 w-3 text-green-600"})}),e.jsx(S,{variant:"outline",size:"sm",className:`p-1 h-8 w-8 ${o?"bg-yellow-50":""}`,onClick:a=>{a.stopPropagation(),l({isOpen:!0,title:"Set as Default",message:"Are you sure you want to set this benefit as the default? This will override the existing default value.",onConfirm:()=>{k(s.id),l({...j,isOpen:!1})}})},title:o?"Default Values":"Set as Default",children:e.jsx(Y,{className:`h-3 w-3 ${o?"text-yellow-500":"text-gray-400"}`})})]}):e.jsx(S,{variant:"outline",size:"sm",className:"p-1 h-8 w-8",onClick:a=>{a.stopPropagation(),b(t.id)},title:"Create Benefit",children:e.jsx(ie,{className:"h-3 w-3 text-blue-600"})})})}),e.jsx("td",{className:"w-64 px-3 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:K(t)}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:t.Department||"N/A"})]})}),m.map((a,c)=>e.jsx("td",{className:"relative border-l border-gray-100",style:{width:a.width},children:e.jsx(oe,{value:s&&s[a.id]||0,isEditing:(x==null?void 0:x.employeeId)===t.id&&(x==null?void 0:x.benefitId)===((s==null?void 0:s.id)||"pending")&&(x==null?void 0:x.field)===a.id,isDisabled:r,onSave:(w,g)=>s&&L(s.id,a.id,w,g),onKeyDown:I,rowIndex:n,colIndex:c,field:a.id,onClick:()=>!r&&s&&H(t.id,s.id,a.id,n,c),onCreateAndEdit:()=>!r&&T(t.id,a.id,n,c),benefitExists:!!s})},a.id)),e.jsx("td",{className:"w-24 px-3 py-3 text-center",children:s?r?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),"Posted"]}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Pending"}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"No Data"})})]},t.id)})})]})}),u&&u.total>u.perPage&&e.jsx("div",{className:"px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(u.currentPage-1)*u.perPage+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(u.currentPage*u.perPage,u.total)})," ","of ",e.jsx("span",{className:"font-medium",children:u.total})," results"]})}),e.jsx("div",{children:e.jsx("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:u.links&&u.links.map((t,n)=>t.url===null?null:e.jsx("button",{onClick:s=>{if(s.stopPropagation(),!t.url)return;const r=t.url.split("page=")[1];u.onPageChange(r)},className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${t.active?"z-10 bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,dangerouslySetInnerHTML:{__html:t.label}},n))})})]})}),e.jsx(fe,{isOpen:j.isOpen,title:j.title,message:j.message,onConfirm:j.onConfirm,onCancel:()=>l({...j,isOpen:!1})})]})};export{Se as default};
