import{r as i,j as e}from"./app-D-TNKEQL.js";import{A as b,b as C,a as E}from"./alert-ttcl-5kV.js";import{B as k}from"./Button-SjHtsDzU.js";import{C as L,a as P,b as B,c as O}from"./card-qhIlbjIo.js";import{r as z,u as _}from"./xlsx-BBWTpfDg.js";import{D as q}from"./download-Dnq6PCPG.js";import{C as H}from"./cloud-upload-BoROQ1o2.js";import{F as M}from"./file-spreadsheet-D6j8h06U.js";import{C as X}from"./circle-alert-DRTaAOqF.js";import"./clsx-B-dksMZM.js";import"./createLucideIcon-DEWnkTLV.js";const W=()=>e.jsx("div",{className:"animate-spin h-5 w-5",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),le=()=>{var y,g;const[c,d]=i.useState(null),[m,h]=i.useState([]),[u,f]=i.useState(!1),[w,l]=i.useState(""),[o,p]=i.useState(null),S=()=>{d(null),h([]),l(""),p(null)},F=i.useCallback(async s=>{const t=s.target.files[0];if(!t)return;if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(t.type)){l("Please upload only Excel files (.xlsx or .xls)");return}if(t.size>5*1024*1024){l("File size should not exceed 5MB");return}d(t),l("");const r=new FileReader;r.onload=async n=>{try{const x=new Uint8Array(n.target.result),v=z(x,{type:"array",cellDates:!0,cellNF:!0,cellText:!1}),A=v.SheetNames[0],I=v.Sheets[A],T=_.sheet_to_json(I,{header:1,defval:null,blankrows:!1}).filter(U=>U.some(N=>N!==null&&N!=="")).slice(0,6);h(T)}catch(x){console.error("Excel parsing error:",x),l("Error reading file. Please make sure it's a valid Excel file."),d(null)}},r.readAsArrayBuffer(t)},[]),R=async()=>{var t;if(!c){l("Please select a file first");return}f(!0),l(""),p(null);const s=new FormData;s.append("file",c);try{const a=await fetch("/employees/import",{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},credentials:"same-origin",body:s}),r=a.headers.get("content-type");if(!r||!r.includes("application/json"))throw new Error(`Expected JSON response but received ${r}`);const n=await a.json();if(!a.ok)throw new Error(n.error||n.message||"Import failed");p(n),((t=n.failures)==null?void 0:t.length)===0&&S()}catch(a){console.error("Import error:",a),l(a.message||"Import failed. Please try again.")}finally{f(!1)}},D=async()=>{try{const s=await fetch("/employees/template/download");if(!s.ok)throw new Error("Failed to download template");const t=await s.blob(),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="employee_import_template.xlsx",document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(a),document.body.removeChild(r)}catch{l("Failed to download template")}},j=s=>s==null?"":s instanceof Date?s.toLocaleDateString():String(s);return e.jsxs(L,{className:"max-w-4xl mx-auto",children:[e.jsxs(P,{children:[e.jsx(B,{children:"Import Employees"}),e.jsx("p",{className:"text-gray-600",children:"Upload your Excel file containing employee details."})]}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(k,{onClick:D,variant:"outline",className:"w-full",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Download Import Template"]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8",children:[e.jsx("input",{type:"file",onChange:F,className:"hidden",id:"file-upload",accept:".xlsx,.xls"}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer flex flex-col items-center",children:[e.jsx(H,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("span",{className:"text-gray-600 text-center",children:c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),c.name]}):"Drop your Excel file here or click to browse"})]})]}),m.length>0&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:m[0].map((s,t)=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:j(s)},t))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.slice(1).map((s,t)=>e.jsx("tr",{children:s.map((a,r)=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:j(a)},r))},t))})]})})}),w&&e.jsxs(b,{variant:"destructive",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx(C,{children:"Error"}),e.jsx(E,{children:w})]}),o&&e.jsxs(b,{variant:((y=o.failures)==null?void 0:y.length)===0?"success":"warning",children:[e.jsx(C,{children:"Import Results"}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:["Successfully imported: ",o.successful," records"]}),((g=o.failures)==null?void 0:g.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Failed imports: ",o.failures.length]}),e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto",children:o.failures.map((s,t)=>e.jsxs("div",{className:"text-sm text-red-600",children:["Row ",s.row,": ",s.errors.join(", ")]},t))})]})]})})]}),e.jsx(k,{onClick:R,disabled:!c||u,className:"w-full",children:u?e.jsxs(e.Fragment,{children:[e.jsx(W,{}),e.jsx("span",{className:"ml-2",children:"Importing..."})]}):"Upload and Import"})]})})]})};export{le as default};
