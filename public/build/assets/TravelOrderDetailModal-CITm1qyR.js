import{r as u,j as e}from"./app-7K62fd2B.js";import V from"./StatusBadge-D5QqXJev.js";import{L as F}from"./loader-circle-CCcIPQox.js";import{M as S}from"./map-pin-BbSYCDVv.js";import{X as W}from"./x-4sBMcqny.js";import{U as Z}from"./user-BKBpk05w.js";import{B as O}from"./building-D6co_3Ut.js";import{C as ee}from"./calendar-CWo9dUpk.js";import{C as b}from"./clock-r6FcyLKi.js";import{C as se}from"./car-HfwOmSbn.js";import{I as te}from"./info-CNKW5Dcc.js";import{D as ae}from"./dollar-sign-kTFlta5J.js";import{F as g}from"./file-text-B0cEX_Vi.js";import{c as ne}from"./createLucideIcon-BK5csKvN.js";import{D as re}from"./download-DiYogtYp.js";import{T as ie}from"./triangle-alert-BFKAbd31.js";import{C as y}from"./circle-check-big-CdHds-fH.js";import{C as U}from"./circle-x-2rCUmP_B.js";import{f as w}from"./format-Bw_hER4B.js";import{p as v}from"./parseISO-CCIRmu7b.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=ne("Paperclip",[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]]),Me=({travelOrder:s,onClose:d,onStatusUpdate:_,userRoles:k={},viewOnly:R=!1,processing:c=!1})=>{var P,E,T,$;const[p,L]=u.useState(""),[r,l]=u.useState(!1),[B,m]=u.useState(!1),[i,o]=u.useState(null),x=(t,n=null)=>{};!R&&s.status==="pending"&&(k.isHrdManager||k.isSuperAdmin),u.useEffect(()=>{c&&l(!0)},[c]),u.useEffect(()=>{s||(l(!1),m(!1),o(null),L(""))},[s]);const H=t=>{x("Executing status change",{travelOrderId:s.id}),l(!0);const n={status:t,remarks:p};if(typeof _=="function")try{const a=_(s.id,n);a&&typeof a.then=="function"?a.then(()=>{x("Status update successful"),l(!1),m(!1),o(null),typeof d=="function"&&d()}).catch(f=>{x("Status update failed",f),console.error("Error updating status:",f),alert("Error: Unable to update status. Please try again."),l(!1),m(!1),o(null)}):(x("Status update completed (non-promise result)"),l(!1),m(!1),o(null),typeof d=="function"&&d())}catch(a){console.error("Error updating status:",a),alert("Error: Unable to update status. Please try again."),l(!1),m(!1),o(null)}else console.error("onStatusUpdate is not a function"),alert("Error: Unable to update status. Please refresh the page and try again."),l(!1),m(!1),o(null)},q=()=>{i&&!r&&H(i)},z=()=>{r||(m(!1),o(null))},A=()=>{r||c||typeof d=="function"&&d()},C=t=>{if(!t)return"N/A";try{return w(v(t),"MMMM dd, yyyy")}catch(n){return console.error("Error formatting date:",n),"Invalid date"}},j=t=>{if(!t)return"N/A";try{let n;if(t.includes("T")){const[,h]=t.split("T");n=h.slice(0,5)}else{const h=t.split(" ");n=h[h.length-1].slice(0,5)}const[a,f]=n.split(":"),I=parseInt(a,10),Q=I>=12?"PM":"AM";return`${I%12||12}:${f} ${Q}`}catch(n){return console.error("Time formatting error:",n),"N/A"}},J=t=>t?new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(t):"₱0.00",D=t=>t.split(".").pop().toLowerCase(),X=t=>{const n=D(t),a="h-5 w-5";switch(n){case"pdf":return e.jsx(g,{className:`${a} text-red-500`});case"doc":case"docx":return e.jsx(g,{className:`${a} text-blue-500`});case"jpg":case"jpeg":case"png":return e.jsx(g,{className:`${a} text-green-500`});default:return e.jsx(g,{className:`${a} text-gray-500`})}},Y=()=>{if(!s.document_paths)return[];try{return Array.isArray(s.document_paths)?s.document_paths:typeof s.document_paths=="string"?JSON.parse(s.document_paths):[]}catch(t){return console.error("Error parsing document paths:",t),[]}},G=t=>{try{x("Document download initiated",{index:t,travelOrderId:s.id});let n;typeof route=="function"?n=route("travel-orders.download-document",{id:s.id,index:t}):n=`/travel-orders/${s.id}/download-document/${t}`,x("Download URL generated",n);const a=document.createElement("a");a.href=n,a.target="_blank",a.rel="noopener noreferrer",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(n){console.error("Error downloading document:",n),alert("Error downloading document. Please try again.")}},M=t=>{switch(t){case"approved":return{className:"bg-green-600 hover:bg-green-700 focus:ring-green-500",text:"Approve",icon:y};case"rejected":return{className:"bg-red-600 hover:bg-red-700 focus:ring-red-500",text:"Reject",icon:U};case"completed":return{className:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500",text:"Mark Completed",icon:y};case"cancelled":return{className:"bg-gray-600 hover:bg-gray-700 focus:ring-gray-500",text:"Cancel",icon:U};case"force_approved":return{className:"bg-purple-600 hover:bg-purple-700 focus:ring-purple-500",text:"Force Approve",icon:y};default:return{className:"bg-indigo-600 hover:bg-indigo-700 focus:ring-indigo-500",text:"Update",icon:y}}},K=t=>{switch(t){case"rejected":return"Are you sure you want to reject this travel order? This action cannot be undone.";case"cancelled":return"Are you sure you want to cancel this travel order? This action cannot be undone.";case"force_approved":return"Are you sure you want to force approve this travel order? This will bypass normal approval workflow.";default:return"Are you sure you want to proceed with this action?"}},N=Y();return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full relative",children:[(r||c)&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center z-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"h-8 w-8 animate-spin mx-auto mb-2 text-indigo-600"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Updating travel order..."})]})}),e.jsxs("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx(S,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("h3",{className:"text-xl leading-6 font-medium text-gray-900",children:["Travel Order #",s.id]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Filed on ",s.created_at?w(v(s.created_at),"MMMM dd, yyyy h:mm a"):"N/A"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{status:s.status}),e.jsx("button",{onClick:A,className:"text-gray-400 hover:text-gray-600 focus:outline-none",disabled:r||c,children:e.jsx(W,{className:"h-6 w-6"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(Z,{className:"h-5 w-5 mr-2 text-gray-600"}),"Employee Information"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Employee ID:"}),e.jsx("span",{className:"col-span-2 text-sm text-gray-900",children:((P=s.employee)==null?void 0:P.idno)||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Name:"}),e.jsx("span",{className:"col-span-2 text-sm text-gray-900",children:s.employee?`${s.employee.Lname}, ${s.employee.Fname} ${s.employee.MName||""}`:"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Department:"}),e.jsxs("span",{className:"col-span-2 text-sm text-gray-900 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-gray-400"}),((E=s.employee)==null?void 0:E.Department)||"N/A"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Position:"}),e.jsx("span",{className:"col-span-2 text-sm text-gray-900",children:((T=s.employee)==null?void 0:T.Jobtitle)||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Filed By:"}),e.jsx("span",{className:"col-span-2 text-sm text-gray-900",children:(($=s.creator)==null?void 0:$.name)||"N/A"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(ee,{className:"h-5 w-5 mr-2 text-gray-600"}),"Travel Details"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Destination:"}),e.jsxs("span",{className:"col-span-2 text-sm text-gray-900 flex items-center",children:[e.jsx(S,{className:"h-4 w-4 mr-1 text-gray-400"}),s.destination||"N/A"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Start Date:"}),e.jsx("span",{className:"col-span-2 text-sm text-gray-900",children:C(s.start_date)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"End Date:"}),e.jsx("span",{className:"col-span-2 text-sm text-gray-900",children:C(s.end_date)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Duration:"}),e.jsxs("span",{className:"col-span-2 text-sm text-gray-900",children:[s.total_days," day",s.total_days!==1?"s":"",e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",s.working_days," working day",s.working_days!==1?"s":"",")"]})]})]}),s.departure_time&&e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Departure:"}),e.jsxs("span",{className:"col-span-2 text-sm text-gray-900 flex items-center",children:[e.jsx(b,{className:"h-4 w-4 mr-1 text-gray-400"}),j(s.departure_time)]})]}),s.return_time&&e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Return:"}),e.jsxs("span",{className:"col-span-2 text-sm text-gray-900 flex items-center",children:[e.jsx(b,{className:"h-4 w-4 mr-1 text-gray-400"}),j(s.return_time)]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Transport:"}),e.jsxs("span",{className:"col-span-2 text-sm text-gray-900 flex items-center",children:[e.jsx(se,{className:"h-4 w-4 mr-1 text-gray-400"}),s.transportation_type||"N/A"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(te,{className:"h-5 w-5 mr-2 text-gray-600"}),"Travel Type & Options"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Travel Type:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.is_full_day?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:s.is_full_day?"Full Day":"Partial Day"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Return to Office:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.return_to_office?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.return_to_office?"Yes":"No"})]}),s.return_to_office&&s.office_return_time&&e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Office Return:"}),e.jsxs("span",{className:"col-span-2 text-sm text-gray-900 flex items-center",children:[e.jsx(b,{className:"h-3 w-3 mr-1 text-gray-400"}),j(s.office_return_time)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Accommodation:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.accommodation_required?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.accommodation_required?"Required":"Not Required"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Meal Allowance:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.meal_allowance?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.meal_allowance?"Included":"Not Included"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(ae,{className:"h-5 w-5 mr-2 text-gray-600"}),"Financial Information"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Estimated Cost:"}),e.jsx("span",{className:"col-span-2 text-sm text-gray-900",children:s.estimated_cost?J(s.estimated_cost):"Not specified"})]}),s.other_expenses&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Other Expenses:"}),e.jsx("div",{className:"mt-1 p-3 bg-white rounded border text-sm text-gray-900",children:s.other_expenses})]})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(g,{className:"h-5 w-5 mr-2 text-gray-600"}),"Purpose of Travel"]}),e.jsx("div",{className:"bg-gray-50 border rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:s.purpose||"No purpose provided"})})]}),N.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(le,{className:"h-5 w-5 mr-2 text-gray-600"}),"Supporting Documents (",N.length,")"]}),e.jsx("div",{className:"bg-gray-50 border rounded-lg p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:N.map((t,n)=>{const a=typeof t=="string"?t.split("/").pop():`Document ${n+1}`;return e.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded border hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[X(a),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:a,children:a}),e.jsxs("p",{className:"text-xs text-gray-500",children:[D(a).toUpperCase()," Document"]})]})]}),e.jsx("button",{onClick:()=>G(n),className:"ml-3 flex-shrink-0 text-indigo-600 hover:text-indigo-800 focus:outline-none",title:"Download document",disabled:r||c,children:e.jsx(re,{className:"h-4 w-4"})})]},n)})})})]}),(s.approved_at||s.remarks)&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Approval Information"}),e.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4 space-y-3",children:[s.approved_at&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-medium text-gray-500",children:[s.status&&s.status.charAt(0).toUpperCase()+s.status.slice(1)," on:"]}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:w(v(s.approved_at),"MMMM dd, yyyy h:mm a")}),s.approver&&e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["by ",s.approver.name]})]}),s.remarks&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Remarks:"}),e.jsx("div",{className:"mt-1 p-3 bg-white rounded border text-sm text-gray-900",children:s.remarks})]})]})]})]}),e.jsx("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:e.jsx("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",onClick:A,disabled:r||c,children:"Close"})})]})]})}),B&&e.jsx("div",{className:"fixed inset-0 z-60 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx(ie,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Confirm Action"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:K(i)}),i==="rejected"&&!p.trim()&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:"Please provide remarks before rejecting."}),i==="force_approved"&&!p.trim()&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:"Please provide remarks for force approval."})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",className:`w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 ${M(i).className} text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed`,onClick:q,disabled:r||i==="rejected"&&!p.trim()||i==="force_approved"&&!p.trim(),children:r?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):`Yes, ${M(i).text}`}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50",onClick:z,disabled:r,children:"Cancel"})]})]})]})})]}):null};export{Me as default};
