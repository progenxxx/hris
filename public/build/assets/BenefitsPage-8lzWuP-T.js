import{V as ie,r as u,j as e,M as le,h as B,b as p}from"./app-C_ClQmDY.js";import{A as ce,S as fe}from"./AuthenticatedLayout-3cR_usYW.js";import{S as de}from"./Sidebar-Bhx-DaaE.js";import ue from"./BenefitsTable-BtGKNiZH.js";import me from"./BenefitsFilters-C8w4PBrQ.js";import pe from"./BenefitsStatusCards-DjkQtdRj.js";import{B as h}from"./Button-Du7mhroA.js";import{A as he,a as ge}from"./alert-CLB16PDI.js";import{C as be}from"./ConfirmModal-D_xoNxPu.js";import{l as xe}from"./lodash-DJVfGrwh.js";import{U as we}from"./upload-CTtdx_s7.js";import{D as O}from"./download-BQI3-SNa.js";import{P as je}from"./plus-D1sl-ovH.js";import{T as ye}from"./trash-2-D_IcoVGU.js";import{S as Ce}from"./save-BXp290R1.js";import"./ApplicationLogo-BORf3137.js";import"./Dropdown-CHXQRgIL.js";import"./transition-0ACRCynB.js";import"./search-BDKFcNkb.js";import"./createLucideIcon-D1ADp28Z.js";import"./x-Q1lJB2Tb.js";/* empty css                */import"./users-Dr4YdQlV.js";import"./file-text-DMC5LN9m.js";import"./calendar-B28JSqfz.js";import"./checkbox-WaPCWkeV.js";import"./xlsx-vauHSbSi.js";import"./circle-alert-xhzyFgGA.js";import"./star-DKJPFIbD.js";import"./lock-DPLG-IKK.js";import"./card-Cx-sVNbO.js";import"./check-D3tZ-Yap.js";import"./clsx-B-dksMZM.js";const st=({employees:l,cutoff:_,month:F,year:M,search:V,status:f,dateRange:y,flash:C})=>{const{auth:$}=ie().props||{},E=($==null?void 0:$.user)||{},[I,j]=u.useState((l==null?void 0:l.data)||[]),[T,c]=u.useState(!1),[s,L]=u.useState({cutoff:_||"1st",month:F||new Date().getMonth()+1,year:M||new Date().getFullYear(),search:V||""}),[d,m]=u.useState({isOpen:!1,title:"",message:"",confirmText:"",confirmVariant:"destructive",onConfirm:()=>{}}),[k,r]=u.useState((C==null?void 0:C.message)||null),[U,J]=u.useState({currentPage:(l==null?void 0:l.current_page)||1,perPage:(l==null?void 0:l.per_page)||50,total:(l==null?void 0:l.total)||0}),[Y,v]=u.useState(!1),[N,S]=u.useState(null);u.useEffect(()=>{l&&(J({currentPage:l.current_page||1,perPage:l.per_page||50,total:l.total||0}),j(l.data||[]))},[l]);const D=(t,a)=>{L(o=>{const n={...o,[t]:a};return t!=="page"?{...n,page:1}:n})},z=u.useCallback(xe.debounce(t=>{D("search",t)},300),[]),g=()=>{c(!0),B.visit(`/benefits?cutoff=${s.cutoff}&month=${s.month}&year=${s.year}&search=${s.search}`,{preserveState:!0,preserveScroll:!0,only:["employees","status","dateRange"],onFinish:()=>c(!1)})};u.useEffect(()=>{g()},[s.cutoff,s.month,s.year,s.search]);const q=async(t,a,o)=>{var n,b;try{const i=await p.patch(`/benefits/${t}/field`,{field:a,value:o});j(x=>x.map(w=>{if(w.benefits&&w.benefits.length>0&&w.benefits[0].id===t){const P=[...w.benefits];return P[0]=i.data,{...w,benefits:P}}return w}))}catch(i){console.error("Error updating benefit:",i),r(((b=(n=i.response)==null?void 0:n.data)==null?void 0:b.message)||"Error updating benefit"),setTimeout(()=>r(null),3e3)}},G=async t=>{var a,o;try{c(!0);const n=await p.post("/benefits/create-from-default",{employee_id:t,cutoff:s.cutoff,date:new Date(`${s.year}-${s.month}-${s.cutoff==="1st"?15:28}`).toISOString().split("T")[0]});return j(b=>b.map(i=>i.id===t?{...i,benefits:[n.data,...i.benefits||[]]}:i)),n.data}catch(n){return console.error("Error creating benefit:",n),r(((o=(a=n.response)==null?void 0:a.data)==null?void 0:o.message)||"Error creating benefit"),setTimeout(()=>r(null),3e3),null}finally{c(!1)}},H=async t=>{var a,o;try{const n=await p.post(`/benefits/${t}/post`);j(b=>b.map(i=>{if(i.benefits&&i.benefits.length>0&&i.benefits[0].id===t){const x=[...i.benefits];return x[0]=n.data,{...i,benefits:x}}return i})),g(),r("Benefit posted successfully"),setTimeout(()=>r(null),3e3)}catch(n){console.error("Error posting benefit:",n),r(((o=(a=n.response)==null?void 0:a.data)==null?void 0:o.message)||"Error posting benefit"),setTimeout(()=>r(null),3e3)}},K=async t=>{var a,o;if(!(!t||t.length===0))try{c(!0);const n=await p.post("/benefits/bulk-post",{benefit_ids:t});g(),r(`Successfully posted ${t.length} benefits`),setTimeout(()=>r(null),3e3)}catch(n){console.error("Error posting benefits in bulk:",n),r(((o=(a=n.response)==null?void 0:a.data)==null?void 0:o.message)||"Error posting benefits"),setTimeout(()=>r(null),3e3)}finally{c(!1)}},Q=async t=>{var a,o;if(!(!t||t.length===0))try{c(!0);const n=await p.post("/benefits/bulk-set-default",{benefit_ids:t});g(),r(`Successfully set ${t.length} benefits as default`),setTimeout(()=>r(null),3e3)}catch(n){console.error("Error setting default benefits in bulk:",n),r(((o=(a=n.response)==null?void 0:a.data)==null?void 0:o.message)||"Error setting default benefits"),setTimeout(()=>r(null),3e3)}finally{c(!1)}},W=()=>{m({isOpen:!0,title:"Post All Benefits",message:`Are you sure you want to post all benefits for the ${s.cutoff} cutoff of ${s.month}/${s.year}? This action cannot be undone.`,confirmText:"Post All",confirmVariant:"destructive",onConfirm:async()=>{var t,a;try{c(!0);const o=await p.post("/benefits/post-all",{cutoff:s.cutoff,start_date:y.start,end_date:y.end});g(),m({...d,isOpen:!1}),r(`${o.data.updated_count} benefits posted successfully`),setTimeout(()=>r(null),3e3)}catch(o){console.error("Error posting all benefits:",o),m({...d,isOpen:!1}),r(((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.message)||"Error posting benefits"),setTimeout(()=>r(null),3e3)}finally{c(!1)}}})},X=()=>{m({isOpen:!0,title:"Delete All Not Posted Benefits",message:`Are you sure you want to delete ALL not posted benefits for the ${s.cutoff} cutoff of ${s.month}/${s.year}? This action cannot be undone.`,confirmText:"Delete All Not Posted",confirmVariant:"destructive",onConfirm:async()=>{var t,a;try{c(!0);const o=await p.post("/benefits/delete-all-not-posted",{cutoff:s.cutoff,start_date:y.start,end_date:y.end});g(),m({...d,isOpen:!1}),r(`${o.data.deleted_count} not posted benefits deleted successfully`),setTimeout(()=>r(null),3e3)}catch(o){console.error("Error deleting not posted benefits:",o),m({...d,isOpen:!1}),r(((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.message)||"Error deleting benefits"),setTimeout(()=>r(null),3e3)}finally{c(!1)}}})},Z=()=>{m({isOpen:!0,title:"Create Benefits for All Employees",message:`This will create benefit entries for all active employees for the ${s.cutoff} cutoff of ${s.month}/${s.year} using their default values.`,confirmText:"Create Benefits",confirmVariant:"default",onConfirm:async()=>{var t,a;try{c(!0);const o=await p.post("/benefits/bulk-create",{cutoff:s.cutoff,date:new Date(`${s.year}-${s.month}-${s.cutoff==="1st"?15:28}`).toISOString().split("T")[0]});g(),m({...d,isOpen:!1}),r(`${o.data.created_count} benefit entries created successfully`),setTimeout(()=>r(null),3e3)}catch(o){console.error("Error creating bulk benefits:",o),m({...d,isOpen:!1}),r(((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.message)||"Error creating benefits"),setTimeout(()=>r(null),3e3)}finally{c(!1)}}})},R=async t=>{var a,o;try{const n=await p.post(`/benefits/${t}/set-default`);j(b=>b.map(i=>{if(i.benefits&&i.benefits.length>0&&i.benefits[0].id===t){const x=[...i.benefits];return x[0]=n.data,{...i,benefits:x}}return i})),r("Default benefit set successfully"),setTimeout(()=>r(null),3e3)}catch(n){console.error("Error setting default benefit:",n),r(((o=(a=n.response)==null?void 0:a.data)==null?void 0:o.message)||"Error setting default benefit"),setTimeout(()=>r(null),3e3)}},ee=t=>{c(!0),B.visit(`/benefits?cutoff=${s.cutoff}&month=${s.month}&year=${s.year}&search=${s.search}&page=${t}`,{preserveState:!0,preserveScroll:!0,only:["employees"],onFinish:()=>c(!1)})},A=()=>{window.location.href=`/benefits/export?cutoff=${s.cutoff}&month=${s.month}&year=${s.year}&search=${s.search}`},te=()=>{window.location.href="/benefits/template/download"},se=async()=>{var a,o;if(!N){r("Please select a file to import"),setTimeout(()=>r(null),3e3);return}const t=new FormData;t.append("file",N),t.append("cutoff",s.cutoff),t.append("date",new Date(`${s.year}-${s.month}-${s.cutoff==="1st"?15:28}`).toISOString().split("T")[0]);try{c(!0);const n=await p.post("/benefits/import",t,{headers:{"Content-Type":"multipart/form-data"}});v(!1),S(null),g(),n.data.errors&&n.data.errors.length>0?(r(`Import completed with ${n.data.errors.length} errors. Check console for details.`),console.log("Import errors:",n.data.errors)):r(`Successfully imported ${n.data.imported_count} benefits`),setTimeout(()=>r(null),5e3)}catch(n){console.error("Error importing benefits:",n),r(((o=(a=n.response)==null?void 0:a.data)==null?void 0:o.message)||"Error importing benefits"),setTimeout(()=>r(null),3e3)}finally{c(!1)}},re=[{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}],ne=new Date().getFullYear(),oe=Array.from({length:5},(t,a)=>ne-2+a),ae=()=>{B.visit("/employee-defaults")};return e.jsxs(ce,{user:E,children:[e.jsx(le,{title:"Employee Benefits"}),e.jsxs("div",{className:"flex min-h-screen bg-gray-50/50",children:[e.jsx(de,{}),e.jsx("div",{className:"flex-1 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[k&&e.jsx(he,{className:"mb-4",children:e.jsx(ge,{children:k})}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Employee Benefits Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage employee benefits, loans, deductions, and allowances."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(h,{onClick:()=>v(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Import"]}),e.jsxs(h,{onClick:A,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(h,{onClick:Z,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200 flex items-center",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Create All"]}),e.jsxs(h,{onClick:X,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200 flex items-center",disabled:(f==null?void 0:f.pendingCount)===0,children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Delete All Not Posted"]}),e.jsxs(h,{onClick:W,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors duration-200 flex items-center",disabled:(f==null?void 0:f.pendingCount)===0,children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Post All"]}),e.jsxs(h,{onClick:ae,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200 flex items-center",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Manage Defaults"]})]})]}),e.jsx(pe,{total:(f==null?void 0:f.allCount)||0,posted:(f==null?void 0:f.postedCount)||0,pending:(f==null?void 0:f.pendingCount)||0}),e.jsx(me,{filters:s,months:re,years:oe,onFilterChange:D,onSearch:z}),e.jsx("div",{className:"bg-white rounded-lg shadow mt-6",children:e.jsx(ue,{employees:I,loading:T,onCellUpdate:q,onCreateBenefit:G,onPostBenefit:H,onSetDefault:R,onBulkPostBenefits:K,onBulkSetDefaultBenefits:Q,onExportToExcel:A,pagination:{...U,onPageChange:ee,links:(l==null?void 0:l.links)||[]}})}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Import Benefits"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Excel File"}),e.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:t=>S(t.target.files[0]),className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:"Import will use current filter settings:"}),e.jsxs("ul",{className:"list-disc list-inside mt-1",children:[e.jsxs("li",{children:["Cutoff: ",s.cutoff]}),e.jsxs("li",{children:["Period: ",s.month,"/",s.year]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(h,{onClick:te,variant:"outline",size:"sm",className:"flex items-center",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Download Template"]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx(h,{variant:"outline",onClick:()=>{v(!1),S(null)},children:"Cancel"}),e.jsx(h,{onClick:se,disabled:!N||T,className:"bg-blue-600 hover:bg-blue-700 text-white",children:T?"Importing...":"Import"})]})]})}),e.jsx(be,{isOpen:d.isOpen,onClose:()=>m({...d,isOpen:!1}),title:d.title,message:d.message,confirmText:d.confirmText,confirmVariant:d.confirmVariant,onConfirm:d.onConfirm})]})})]})]})};export{st as default};
