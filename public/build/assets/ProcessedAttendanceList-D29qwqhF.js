import{a as Ys,r as i,j as e,H as Gs}from"./app-7K62fd2B.js";import{A as Qs}from"./AuthenticatedLayout-DQzQmHv9.js";import{S as Zs}from"./Sidebar-Bpho9Ubl.js";import{A as ke,a as _e}from"./alert-Cw6Swk3l.js";import{B as x}from"./Button-B-ixrUdq.js";import{C as $,a as et,b as st,c as L}from"./card-Bd2He_oM.js";import tt from"./AttendanceEditModal-cKqLB9-6.js";import rt from"./AttendanceInfoModal-DtOHN60-.js";import{C as X}from"./circle-check-big-CdHds-fH.js";import{T as _}from"./triangle-alert-BFKAbd31.js";import{R as y}from"./refresh-cw-DqcGqKqT.js";import{S as Ie}from"./send-B0KHlLyg.js";import{C as Ue}from"./calculator-NMlYC2-D.js";import{D as at}from"./download-DiYogtYp.js";import{U as ts}from"./upload-BWFV_Ypm.js";import{T as rs}from"./target-8x4dVK3I.js";import{F as qe}from"./file-text-B0cEX_Vi.js";import{T as $e}from"./trash-2-CLTfogtc.js";import{S as lt}from"./search-BmV-knWW.js";import{C as as}from"./calendar-CWo9dUpk.js";import{U as nt}from"./users-D-OfZtV9.js";import{S as ls}from"./square-pen-BeqsqNZt.js";import{M as ns,S as it}from"./sun-DGcVySav.js";import{C as is}from"./clock-r6FcyLKi.js";import{C as os}from"./car-HfwOmSbn.js";import{I as ot}from"./info-CNKW5Dcc.js";import{X as ne}from"./x-4sBMcqny.js";import{C as ct}from"./circle-check-ms9Kxya9.js";import{C as dt}from"./circle-alert-CGQbi50W.js";import"./ApplicationLogo-IpRttWhS.js";import"./Dropdown-Yo6Rw43S.js";import"./transition-Di9UDWSH.js";import"./createLucideIcon-BK5csKvN.js";/* empty css                */import"./clsx-B-dksMZM.js";import"./loader-circle-CCcIPQox.js";import"./save-BqIq9Yvz.js";import"./user-BKBpk05w.js";import"./building-D6co_3Ut.js";const Qt=()=>{const{auth:cs,attendances:ds=[],pagination:ie={},recalculated_count:Y=0}=Ys().props,[A,Se]=i.useState(ds),[Te,Le]=i.useState(!1),[Ce,Xe]=i.useState(!1),[oe,ce]=i.useState(!1),[de,me]=i.useState(!1),[G,ze]=i.useState(!1),[U,De]=i.useState(!1),[N,Q]=i.useState(!1),[z,l]=i.useState(""),[W,h]=i.useState(""),[Z,ms]=i.useState(!1),[p,F]=i.useState(ie.current_page||1),[j,xs]=i.useState(ie.last_page||1),[We,mt]=i.useState(ie.per_page||25),[S,ps]=i.useState(""),[u,hs]=i.useState(""),[g,us]=i.useState(""),[w,gs]=i.useState(!1),[T,xt]=i.useState(!1),[C,fs]=i.useState(""),[xe,ys]=i.useState([]),[O,pe]=i.useState(null),[js,he]=i.useState(!1),[Pe,ue]=i.useState(!1),[bs,Re]=i.useState(!1),[Je,Ee]=i.useState([]),[D,Fe]=i.useState(null),[ge,ee]=i.useState(null),[Ve,se]=i.useState(!1),[Be,fe]=i.useState(!1),[b,J]=i.useState([]),[Ns,Oe]=i.useState(!1),[ws,te]=i.useState(!1),[q,ye]=i.useState("selected"),[v,V]=i.useState({start_date:"",end_date:"",employee_id:"",department:""}),[M,Ke]=i.useState(!1),[vs,je]=i.useState(!1),[Me,be]=i.useState(null),[ks,Ne]=i.useState(!1),[f,B]=i.useState({date:"",multiplier:"2.0",department:"",employee_ids:[]}),[Ae,we]=i.useState(!1),[m,re]=i.useState({year:new Date().getFullYear(),month:new Date().getMonth()+1,period_type:"1st_half",department:"",employee_ids:[]}),[K,ve]=i.useState(null),[ae,Ye]=i.useState(!1),P=i.useCallback(s=>{const t=[],r=s.time_in||s.time_out||s.break_in||s.break_out||s.next_day_timeout;if(!r)return t;if(!s.time_in&&r&&t.push({type:"missing_time_in",message:"Missing Time In",severity:"high",icon:"clock"}),s.time_in&&!s.time_out&&!(s.is_nightshift&&s.next_day_timeout)&&t.push({type:"missing_time_out",message:"Missing Time Out",severity:"high",icon:"clock"}),r&&(s.break_in&&!s.break_out||!s.break_in&&s.break_out)&&t.push({type:"missing_break_times",message:"Incomplete Break Times",severity:"medium",icon:"coffee"}),s.hours_worked&&s.hours_worked>16&&t.push({type:"excessive_hours",message:`Excessive Hours: ${s.hours_worked}h`,severity:"high",icon:"alert-triangle"}),s.hours_worked&&s.hours_worked<0&&t.push({type:"negative_hours",message:`Negative Hours: ${s.hours_worked}h`,severity:"high",icon:"alert-triangle"}),s.is_nightshift&&s.time_in&&!s.next_day_timeout&&t.push({type:"night_shift_issues",message:"Night Shift Missing Next Day Timeout",severity:"medium",icon:"moon"}),r&&s.attendance_date)try{const a=new Date(s.attendance_date).getDay();(a===0||a===6)&&!s.restday&&!s.overtime&&t.push({type:"weekend_attendance",message:"Weekend Work Without OT/Rest Day Marker",severity:"low",icon:"calendar"})}catch{}return t},[]),R=i.useRef(null),H=i.useRef(!1),Ge=i.useCallback(s=>s.map(t=>{const r={...t,employee_name:t.employee_name||"Unknown Employee",idno:t.idno||"N/A",department:t.department||"N/A",line:t.line||"N/A",hours_worked:t.hours_worked||0,late_minutes:t.late_minutes||0,undertime_minutes:t.undertime_minutes||0,overtime:t.overtime||0,travel_order:t.travel_order||0,slvl:t.slvl||0,trip:t.trip||0,ct:t.ct||!1,cs:t.cs||!1,holiday:t.holiday||0,ot_reg_holiday:t.ot_reg_holiday||0,ot_special_holiday:t.ot_special_holiday||0,retromultiplier:t.retromultiplier||0,restday:t.restday||!1,offset:t.offset||0,ob:t.ob||!1,is_nightshift:t.is_nightshift||!1,source:t.source||"unknown",posting_status:t.posting_status||"not_posted"};return r.problems=P(r),r.hasProblems=r.problems.length>0,r}),[P]),I=i.useCallback(async(s=!1)=>{Le(!0),l("");try{const t=new URLSearchParams;t.append("page",p),t.append("per_page",We),S&&t.append("search",S),u&&t.append("date",u),g&&t.append("department",g),w&&t.append("edits_only","true"),T&&t.append("night_shift_only","true"),C&&t.append("posting_status",C),Z&&t.append("problems_only","true");const n=await(await fetch("/attendance/list?"+t.toString(),{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}})).json();if(n.success){let a=Ge(n.data);Z&&(a=a.filter(c=>{const o=P(c);return o&&o.length>0})),Se(a),xs(n.pagination.last_page),F(n.pagination.current_page),s&&n.recalculated_count>0&&h(`Loaded data and recalculated ${n.recalculated_count} attendance records`),J([]),Oe(!1)}else l("Failed to load attendance data")}catch(t){console.error("Error loading attendance data:",t),l("Error loading attendance data: "+(t.message||"Unknown error"))}finally{Le(!1)}},[p,We,S,u,g,w,T,C,Z,Ge,P]),_s=async()=>{var s;if(!(!m.year||!m.month||!m.period_type)){Ye(!0),l("");try{const t=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"),r=await fetch("/attendance/posting-preview",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:JSON.stringify({year:m.year,month:m.month,period_type:m.period_type,department:m.department||null,employee_ids:m.employee_ids.length>0?m.employee_ids:null})});if(!r.ok)throw new Error(`Preview failed with status: ${r.status}`);const n=await r.json();n.success?ve(n):l("Failed to load posting preview: "+(n.message||"Unknown error"))}catch(t){console.error("Error loading post preview:",t),l("Failed to load posting preview: "+(t.message||"Unknown error"))}finally{Ye(!1)}}},Ss=async()=>{var s;if(!K||K.totals.employees===0){l("No employees to post");return}Q(!0),l("");try{const t=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content");if(!t){l("Session expired. Please refresh the page and try again."),Q(!1);return}const r={year:parseInt(m.year),month:parseInt(m.month),period_type:m.period_type,department:m.department||null,employee_ids:Array.isArray(m.employee_ids)&&m.employee_ids.length>0?m.employee_ids.map(c=>parseInt(c)):[]};if(!r.year||!r.month||!r.period_type){l("Year, Month, and Period Type are required for posting"),Q(!1);return}console.log("Sending POST to payroll request:",r);const n=await fetch("/attendance/post-to-payroll",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:JSON.stringify(r)});if(!n.ok){let c=`Posting failed with status: ${n.status}`;try{const o=await n.json();console.error("Response error data:",o),n.status===422?o.errors?c="Validation failed: "+Object.values(o.errors).flat().join(", "):c="Validation failed: "+(o.message||"Invalid data provided"):n.status===404?c=o.message||"No eligible attendance records found for the specified criteria":n.status>=500?c="Server error occurred. Please try again later.":c=o.message||c}catch(o){console.error("Error parsing response:",o),c=`Request failed with status ${n.status}. Please check the server logs.`}l(c),Q(!1);return}const a=await n.json();console.log("POST response data:",a),a.success?(h(a.message||"Posted to payroll successfully"),we(!1),ve(null),re({year:new Date().getFullYear(),month:new Date().getMonth()+1,period_type:"1st_half",department:"",employee_ids:[]}),await I(!1)):(l("Posting failed: "+(a.message||"Unknown error occurred")),a.errors&&a.errors.length>0&&l(a.message+`

Errors:
`+a.errors.slice(0,3).join(`
`)))}catch(t){console.error("Posting error:",t),t.name==="TypeError"&&t.message.includes("Failed to fetch")?l("Network error. Please check your internet connection and try again."):t.message.includes("JSON")?l("Invalid response from server. Please try again."):l("Failed to post to payroll: "+(t.message||"Unknown error occurred"))}finally{Q(!1)}},Qe=async()=>{F(1),await I(!0)},Ts=i.useCallback(s=>{const t=P(s);if(t.length===0)return e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(X,{className:"h-4 w-4 text-green-500",title:"No problems detected"})});const r=t.filter(o=>o.severity==="high"),n=t.filter(o=>o.severity==="medium");t.filter(o=>o.severity==="low");const a=()=>r.length>0?"text-red-500 bg-red-50 border-red-200":n.length>0?"text-orange-500 bg-orange-50 border-orange-200":"text-yellow-500 bg-yellow-50 border-yellow-200",c=()=>r.length>0?"HIGH":n.length>0?"MED":"LOW";return e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full border-2 ${a()}`,children:e.jsx(_,{className:"h-4 w-4"})}),e.jsx("span",{className:`text-xs font-medium px-1 py-0.5 rounded ${a()}`,children:c()}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.length," issue",t.length>1?"s":""]})]})},[P]),Cs=i.useCallback(s=>{const t=P(s);return t.length===0?null:e.jsx("div",{className:"absolute z-50 w-80 p-3 bg-white border border-gray-200 rounded-lg shadow-lg top-full left-0 mt-1",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium text-gray-900 flex items-center",children:[e.jsx(_,{className:"h-4 w-4 mr-1 text-red-500"}),"DTR Problems Detected"]}),t.map((r,n)=>e.jsxs("div",{className:`flex items-start space-x-2 p-2 rounded text-sm ${r.severity==="high"?"bg-red-50 text-red-800":r.severity==="medium"?"bg-orange-50 text-orange-800":"bg-yellow-50 text-yellow-800"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full mt-1.5 ${r.severity==="high"?"bg-red-500":r.severity==="medium"?"bg-orange-500":"bg-yellow-500"}`}),e.jsx("span",{children:r.message})]},n)),e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-600",children:"💡 Double-click this row to edit and fix these issues"})})]})})},[P]),Ds=async()=>{me(!0),l("");try{const s=new URLSearchParams;S&&s.append("search",S),u&&s.append("date",u),g&&s.append("department",g),w&&s.append("edits_only","true"),T&&s.append("night_shift_only","true"),C&&s.append("posting_status",C);const t=await fetch("/processattendance/download-template?"+s.toString(),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/octet-stream"}});if(!t.ok)throw new Error(`Download failed with status: ${t.status}`);const r=await t.blob(),n=window.URL.createObjectURL(r),a=document.createElement("a");a.href=n;let d=`attendance_data_${new Date().toISOString().split("T")[0]}`;u&&(d+=`_${u}`),g&&(d+=`_${g.replace(/\s+/g,"_")}`),w&&(d+="_edited_only"),T&&(d+="_night_shift"),a.download=`${d}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(n),h("Attendance data downloaded successfully")}catch(s){console.error("Download error:",s),l("Failed to download attendance data: "+(s.message||"Unknown error"))}finally{me(!1)}},Ps=async()=>{var s;if(!Pe){ue(!0),l("");try{const t=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content");if(!t){l("Session expired. Please refresh the page and try again."),ue(!1);return}const r={date:u||null,department:g||null,employee_ids:b.length>0?b:null};console.log("Detecting DTR problems with filters:",r);const n=await fetch("/attendance/detect-dtr-problems",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:JSON.stringify(r)});if(!n.ok){let c=`DTR problem detection failed with status: ${n.status}`;try{const o=await n.json();console.error("DTR detection error response:",o),n.status===422?o.errors?c="Validation failed: "+Object.values(o.errors).flat().join(", "):c="Validation failed: "+(o.message||"Invalid data provided"):n.status>=500?c="Server error during DTR problem detection. Please check the server logs.":c=o.message||c}catch(o){console.error("Error parsing DTR detection response:",o),c=`DTR problem detection failed with status ${n.status}. Please check the server logs.`}l(c),ue(!1);return}const a=await n.json();console.log("DTR problem detection response:",a),a.success?(Ee(a.data),Fe(a.summary),Re(!0),a.summary.problem_records===0?h("Great! No DTR problems detected in the current view."):h(`DTR analysis complete: Found ${a.summary.problem_records} records with problems`)):l("DTR problem detection failed: "+(a.message||"Unknown error occurred"))}catch(t){console.error("DTR problem detection error:",t),t.name==="TypeError"&&t.message.includes("Failed to fetch")?l("Network error. Please check your internet connection and try again."):t.message.includes("JSON")?l("Invalid response from server. Please try again."):l("Failed to detect DTR problems: "+(t.message||"Unknown error occurred"))}finally{ue(!1)}}},Rs=async()=>{me(!0),l("");try{const s=new URLSearchParams;S&&s.append("search",S),u&&s.append("date",u),g&&s.append("department",g),w&&s.append("edits_only","true"),T&&s.append("night_shift_only","true"),C&&s.append("posting_status",C);const t=await fetch("/attendance/export?"+s.toString(),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/octet-stream"}});if(!t.ok)throw new Error(`Export failed with status: ${t.status}`);const r=await t.blob(),n=window.URL.createObjectURL(r),a=document.createElement("a");a.href=n;let d=`attendance_export_${new Date().toISOString().split("T")[0]}`;u&&(d+=`_${u}`),g&&(d+=`_${g.replace(/\s+/g,"_")}`),w&&(d+="_edited_only"),T&&(d+="_night_shift"),a.download=`${d}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(n),h("Attendance data exported successfully")}catch(s){console.error("Export error:",s),l("Failed to export attendance data: "+(s.message||"Unknown error"))}finally{me(!1)}},Es=async()=>{var s;if(!Me){l("Please select a file to import");return}ze(!0),l("");try{const t=new FormData;t.append("file",Me);const r=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"),n=await fetch("/processattendance/import",{method:"POST",headers:{"X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:t});if(!n.ok)throw new Error(`Import failed with status: ${n.status}`);const a=await n.json();a.success?(h(a.message||"Import completed successfully"),je(!1),be(null),await I(!1)):(l("Import failed: "+(a.message||"Unknown error")),a.errors&&a.errors.length>0&&l(a.message+`

Errors:
`+a.errors.slice(0,5).join(`
`)))}catch(t){console.error("Import error:",t),l("Failed to import attendance data: "+(t.message||"Unknown error"))}finally{ze(!1)}},Fs=async()=>{var t;if(!f.date){l("Please select a holiday date");return}if(!f.multiplier||isNaN(parseFloat(f.multiplier))){l("Please provide a valid holiday multiplier");return}const s=parseFloat(f.multiplier);if(s<.1||s>10){l("Holiday multiplier must be between 0.1 and 10");return}De(!0),l("");try{const r=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content");if(!r){l("Session expired. Please refresh the page and try again."),De(!1);return}const n={date:f.date,multiplier:s,department:f.department||null,employee_ids:Array.isArray(f.employee_ids)&&f.employee_ids.length>0?f.employee_ids:[]};console.log("Sending holiday request:",n);const a=await fetch("/attendance/set-holiday",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:JSON.stringify(n)});if(!a.ok)if(a.status===422){const o=await a.json();if(o.errors){const d=Object.values(o.errors).flat();l("Validation failed: "+d.join(", "))}else l("Validation failed: "+(o.message||"Invalid data provided"));return}else if(a.status===404){const o=await a.json();l(o.message||"No eligible attendance records found for the specified criteria");return}else if(a.status>=500){l("Server error occurred. Please try again later.");return}else throw new Error(`Request failed with status: ${a.status}`);const c=await a.json();c.success?(h(c.message||"Holiday set successfully"),Ne(!1),B({date:"",multiplier:"2.0",department:"",employee_ids:[]}),await I(!1)):l("Set holiday failed: "+(c.message||"Unknown error occurred"))}catch(r){console.error("Set holiday error:",r),r.name==="TypeError"&&r.message.includes("Failed to fetch")?l("Network error. Please check your internet connection and try again."):r.message.includes("JSON")?l("Invalid response from server. Please try again."):l("Failed to set holiday: "+(r.message||"Unknown error occurred"))}finally{De(!1)}},Ze=async(s=!1)=>{var t;if(!oe){ce(!0),l("");try{const r=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content");if(!r){l("Session expired. Please refresh the page and try again."),ce(!1);return}const n={date:u||null,department:g||null};console.log("Sending recalculation request:",n);const a=await fetch("/attendance/recalculate-all",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:JSON.stringify(n)});if(!a.ok){let o=`Recalculation failed with status: ${a.status}`;try{const d=await a.json();console.error("Recalculation error response:",d),a.status===422?d.errors?o="Validation failed: "+Object.values(d.errors).flat().join(", "):o="Validation failed: "+(d.message||"Invalid data provided"):a.status>=500?o="Server error during recalculation. Please check the server logs.":o=d.message||o}catch(d){console.error("Error parsing recalculation response:",d),o=`Recalculation failed with status ${a.status}. Please check the server logs.`}l(o),ce(!1);return}const c=await a.json();console.log("Recalculation response:",c),c.success?(s&&c.recalculated_count>0?h(`Recalculated ${c.recalculated_count} attendance records`):s&&h("Recalculation completed - all records are up to date"),await I(!1)):l("Recalculation failed: "+(c.message||"Unknown error occurred"))}catch(r){console.error("Recalculation error:",r),r.name==="TypeError"&&r.message.includes("Failed to fetch")?l("Network error. Please check your internet connection and try again."):r.message.includes("JSON")?l("Invalid response from server. Please try again."):l("Failed to recalculate attendance data: "+(r.message||"Unknown error occurred"))}finally{ce(!1)}}},Os=async()=>{var s;if(!Ce){Xe(!0),l("");try{const t=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"),r=await fetch("/attendance/sync",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});if(!r.ok)throw new Error(`Sync failed with status: ${r.status}`);const n=await r.json();n.success?(h(n.message||"Sync completed successfully"),await I(!1)):l("Sync failed: "+(n.message||"Unknown error"))}catch(t){console.error("Sync error:",t),l("Failed to sync attendance data: "+(t.message||"Unknown error"))}finally{Xe(!1)}}},Ms=async s=>{var t;try{l("");const r=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"),n=await fetch(`/attendance/${s}/sync`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});if(!n.ok)throw new Error(`Individual sync failed with status: ${n.status}`);const a=await n.json();a.success?(h(a.message||"Record synced successfully"),a.data&&Se(c=>c.map(o=>o.id===s?{...o,...a.data}:o))):l("Individual sync failed: "+(a.message||"Unknown error"))}catch(r){console.error("Individual sync error:",r),l("Failed to sync individual record: "+(r.message||"Unknown error"))}},As=async s=>{var t;try{l(""),h("");const r=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content");if(!r){l("Session expired. Please refresh the page and try again.");return}const n={id:s.id,time_in:s.time_in,break_in:s.break_in,break_out:s.break_out,time_out:s.time_out,next_day_timeout:s.next_day_timeout,is_nightshift:s.is_nightshift,trip:s.trip};console.log("Sending payload:",n);const a=await fetch(`/attendance/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:JSON.stringify(n)});if(console.log("Response status:",a.status),console.log("Response headers:",Object.fromEntries(a.headers.entries())),a.status===401){l("Session expired. Please refresh the page and login again.");return}if(a.status===419){l("Security token expired. Please refresh the page and try again.");return}if(a.status===422)try{const k=(await a.json()).message||"Validation failed";l(k);return}catch{l("Validation failed. Please check your input and try again.");return}const c=a.headers.get("content-type");if(console.log("Content-Type:",c),!a.ok){let d=`HTTP error! status: ${a.status}`;if(c&&c.includes("application/json"))try{d=(await a.json()).message||d}catch(k){console.warn("Could not parse error response as JSON:",k)}else try{const k=await a.text();console.log("Error response text:",k.substring(0,500)),d="Server error occurred. Please try again."}catch(k){console.warn("Could not get error response text:",k)}l(d);return}if(!c||!c.includes("application/json")){console.warn("Success response is not JSON:",c),h("Update completed successfully!"),setTimeout(()=>{window.location.reload()},1500);return}let o;try{const d=await a.text();console.log("Response text:",d),o=JSON.parse(d)}catch(d){console.error("JSON parse error:",d),console.error("Response text that failed to parse:",await a.text()),h("Update completed successfully!"),setTimeout(()=>{window.location.reload()},1500);return}if(o.success){h("Attendance record updated successfully");const d={...o.data,source:"manual_edit",is_edited:!0};Se(k=>k.map(ss=>ss.id===s.id?d:ss)),se(!1)}else o.redirect?(l("Session expired. Redirecting to login..."),setTimeout(()=>{window.location.href=o.redirect},2e3)):l("Failed to update attendance: "+(o.message||"Unknown error"))}catch(r){console.error("Error updating attendance:",r),r.name==="TypeError"&&r.message.includes("Failed to fetch")?l("Network error. Please check your internet connection and try again."):r.name==="SyntaxError"&&r.message.includes("JSON")?(console.error("JSON parsing failed - likely receiving HTML instead of JSON"),h("Update may have completed. Please refresh the page to see changes.")):r.message.includes("HTTP error")?l(`Server error (${r.message}). Please try again or contact support.`):l("Error updating attendance: "+(r.message||"Unknown error"))}},Hs=(s,t)=>{s.stopPropagation(),s.target.checked?J(r=>[...r,t]):J(r=>r.filter(n=>n!==t))},Is=s=>{Oe(s),J(s?A.map(t=>t.id):[])},Us=(s,t)=>{s.preventDefault(),he(!0);const r=setTimeout(()=>{ee(t),fe(!0),he(!1)},1e3);pe(r)},qs=()=>{O&&(clearTimeout(O),pe(null)),he(!1)},$s=()=>{O&&(clearTimeout(O),pe(null)),he(!1)},Ls=(s,t)=>{s.preventDefault(),s.stopPropagation(),O&&(clearTimeout(O),pe(null)),!H.current&&(R.current&&clearTimeout(R.current),H.current=!0,ee(t),se(!0),R.current=setTimeout(()=>{H.current=!1},500))},Xs=(s,t)=>{s.preventDefault(),s.stopPropagation(),!H.current&&(R.current&&clearTimeout(R.current),H.current=!0,ee(t),se(!0),R.current=setTimeout(()=>{H.current=!1},500))},es=()=>{se(!1),fe(!1),ee(null),H.current=!1,R.current&&clearTimeout(R.current)},zs=async()=>{var s;try{Ke(!0),l("");const t=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content");let r={};if(q==="selected"){if(b.length===0){l("Please select attendance records to delete");return}r={ids:b}}else{if(!v.start_date||!v.end_date){l("Please provide both start and end dates");return}r={start_date:v.start_date,end_date:v.end_date,employee_id:v.employee_id||null,department:v.department||null}}const n=await fetch("/attendance/bulk-delete",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:JSON.stringify(r)});if(!n.ok)throw new Error(`Delete failed with status: ${n.status}`);const a=await n.json();a.success?(h(a.message||`Deleted ${a.deleted_count} records successfully`),await I(!1),J([]),Oe(!1),te(!1),V({start_date:"",end_date:"",employee_id:"",department:""})):l("Delete failed: "+(a.message||"Unknown error"))}catch(t){console.error("Bulk delete error:",t),l("Failed to delete records: "+(t.message||"Unknown error"))}finally{Ke(!1)}},Ws=async()=>{try{const s=await fetch("/attendance/departments",{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});if(s.ok){const t=await s.json();t.success&&ys(t.data)}}catch(s){console.error("Error loading departments:",s)}},Js=s=>{if(!s)return"N/A";try{return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid Date"}},le=s=>{if(!s)return"-";try{let t;if(s.includes("T")){const[,d]=s.split("T");t=d.slice(0,5)}else{const d=s.split(" ");t=d[d.length-1].slice(0,5)}const[r,n]=t.split(":"),a=parseInt(r,10),c=a>=12?"PM":"AM";return`${a%12||12}:${n} ${c}`}catch(t){return console.error("Time formatting error:",t),"-"}},E=(s,t=2)=>{if(s==null||s==="")return"-";const r=parseFloat(s);return isNaN(r)?"-":r.toFixed(t)},Vs=s=>{const t=parseFloat(s.late_minutes||0),r=parseFloat(s.undertime_minutes||0);return t===0&&r===0?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(X,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"On Time"})]}):e.jsxs("div",{className:"space-y-1",children:[t>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(is,{className:"h-3 w-3 text-red-500"}),e.jsxs("span",{className:"text-xs text-red-600",children:[Math.floor(t/60)>0?`${Math.floor(t/60)}h `:"",Math.round(t%60),"m late"]})]}),r>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(_,{className:"h-3 w-3 text-orange-500"}),e.jsxs("span",{className:"text-xs text-orange-600",children:[Math.floor(r/60)>0?`${Math.floor(r/60)}h `:"",Math.round(r%60),"m under"]})]})]})},Bs=s=>s.is_nightshift?e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs",children:[e.jsx(ns,{className:"h-3 w-3"}),e.jsx("span",{children:"Night"})]}):e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs",children:[e.jsx(it,{className:"h-3 w-3"}),e.jsx("span",{children:"Day"})]}),He=(s,t="boolean")=>{if(t==="source"){const r={manual_edit:"bg-red-100 text-red-800",slvl_sync:"bg-indigo-100 text-indigo-800",import:"bg-blue-100 text-blue-800",biometric:"bg-green-100 text-green-800",unknown:"bg-gray-100 text-gray-800"},n=r[s]||r.unknown,a=s==="manual_edit"?"Edited":s==="slvl_sync"?"SLVL":s==="import"?"Import":s==="biometric"?"Bio":"Unknown";return e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${n}`,children:a})}return s?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"✓"}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"-"})},Ks=s=>s.posting_status==="posted"?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(ct,{className:"h-3 w-3 mr-1"}),"Posted"]}):e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(dt,{className:"h-3 w-3 mr-1"}),"Not Posted"]});return i.useEffect(()=>{if(Ae&&m.year&&m.month&&m.period_type){const s=setTimeout(()=>{_s()},300);return()=>clearTimeout(s)}},[Ae,m.year,m.month,m.period_type,m.department,m.employee_ids]),i.useEffect(()=>{Y>0&&h(`Auto-recalculated ${Y} attendance records for accurate display`)},[Y]),i.useEffect(()=>{if(W){const s=setTimeout(()=>h(""),5e3);return()=>clearTimeout(s)}},[W]),i.useEffect(()=>{if(z){const s=setTimeout(()=>l(""),1e4);return()=>clearTimeout(s)}},[z]),i.useEffect(()=>()=>{R.current&&clearTimeout(R.current),O&&clearTimeout(O)},[O]),i.useEffect(()=>{if(A.length>0&&(u||g||w||T)){const t=setTimeout(()=>{Ze(!1)},1e3);return()=>clearTimeout(t)}},[u,g,w,T]),i.useEffect(()=>{Ws()},[]),i.useEffect(()=>{p!==ie.current_page&&I(!1)},[p]),i.useEffect(()=>{const s=setTimeout(()=>{(S!==""||u!==""||g!==""||w!==!1||T!==!1||C!=="")&&Qe()},500);return()=>clearTimeout(s)},[S]),i.useEffect(()=>{Qe()},[u,g,w,T,C,Z]),e.jsxs(Qs,{user:cs.user,children:[e.jsx(Gs,{title:"Processed Attendance List"}),e.jsxs("div",{className:"flex min-h-screen bg-gray-50/50",children:[e.jsx(Zs,{}),e.jsx("div",{className:"flex-1 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 mb-1",children:"Processed Attendance Records (Non-Posted Only)"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"View and manage non-posted attendance records with automatic recalculation and payroll posting."}),e.jsx("p",{className:"text-xs sm:text-sm text-blue-600 mt-1",children:"💡 Tip: Hold any row for 1 second to view details, double-click to edit attendance times"}),Y>0&&e.jsxs("p",{className:"text-xs sm:text-sm text-green-600 mt-1",children:["✅ Auto-recalculated ",Y," records for accurate display"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(x,{onClick:()=>we(!0),disabled:N,size:"sm",className:"bg-green-600 hover:bg-green-700 text-white border-green-600 text-xs sm:text-sm",children:N?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Posting..."}),e.jsx("span",{className:"sm:hidden",children:"Post..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"POST to Payroll"}),e.jsx("span",{className:"sm:hidden",children:"POST"})]})}),e.jsx(x,{onClick:Ps,disabled:Pe||Te,variant:"outline",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white border-red-600 text-xs sm:text-sm",title:"Detect DTR problems in current view",children:Pe?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Detecting..."}),e.jsx("span",{className:"sm:hidden",children:"Det..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Detect DTR Problems"}),e.jsx("span",{className:"sm:hidden",children:"DTR Check"})]})}),e.jsx(x,{onClick:()=>Ze(!0),disabled:oe||Te,variant:"outline",size:"sm",className:"bg-purple-600 hover:bg-purple-700 text-white border-purple-600 text-xs sm:text-sm",title:"Manually recalculate late/undertime for current view",children:oe?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Recalculating..."}),e.jsx("span",{className:"sm:hidden",children:"Calc..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Recalculate"}),e.jsx("span",{className:"sm:hidden",children:"Calc"})]})}),e.jsx(x,{onClick:Ds,disabled:de,variant:"outline",size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 text-xs sm:text-sm",children:de?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Downloading..."}),e.jsx("span",{className:"sm:hidden",children:"Down..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Download"}),e.jsx("span",{className:"sm:hidden",children:"Down"})]})}),e.jsxs(x,{onClick:()=>je(!0),variant:"outline",size:"sm",className:"bg-indigo-600 hover:bg-indigo-700 text-white border-indigo-600 text-xs sm:text-sm",children:[e.jsx(ts,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),"Import"]}),e.jsxs(x,{onClick:()=>Ne(!0),variant:"outline",size:"sm",className:"bg-orange-600 hover:bg-orange-700 text-white border-orange-600 text-xs sm:text-sm",children:[e.jsx(rs,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Set Holiday"}),e.jsx("span",{className:"sm:hidden",children:"Holiday"})]}),e.jsx(x,{onClick:Rs,disabled:de,variant:"outline",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white border-green-600 text-xs sm:text-sm",children:de?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Exporting..."}),e.jsx("span",{className:"sm:hidden",children:"Exp..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),"Export"]})}),b.length>0&&e.jsxs(x,{onClick:()=>{ye("selected"),te(!0)},variant:"outline",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white border-red-600 text-xs sm:text-sm",children:[e.jsx($e,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),e.jsxs("span",{className:"hidden sm:inline",children:["Delete (",b.length,")"]}),e.jsxs("span",{className:"sm:hidden",children:["Del (",b.length,")"]})]}),e.jsxs(x,{onClick:()=>{ye("range"),te(!0)},variant:"outline",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white border-red-600 text-xs sm:text-sm",children:[e.jsx($e,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Delete Range"}),e.jsx("span",{className:"sm:hidden",children:"Del Range"})]}),e.jsx(x,{onClick:Os,disabled:Ce,size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white text-xs sm:text-sm",children:Ce?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Syncing..."}),e.jsx("span",{className:"sm:hidden",children:"Sync..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Sync Data"}),e.jsx("span",{className:"sm:hidden",children:"Sync"})]})})]})]}),z&&e.jsxs(ke,{variant:"destructive",className:"mb-4",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),e.jsx(_e,{children:z})]}),W&&e.jsxs(ke,{className:"mb-4 border-green-200 bg-green-50",children:[e.jsx(X,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx(_e,{className:"text-green-800",children:W})]}),oe&&e.jsxs(ke,{className:"mb-4 border-purple-200 bg-purple-50",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2 text-purple-600 animate-pulse"}),e.jsx(_e,{className:"text-purple-800",children:"Recalculating attendance metrics for accurate late/undertime display..."})]}),N&&e.jsxs(ke,{className:"mb-4 border-green-200 bg-green-50",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2 text-green-600 animate-pulse"}),e.jsx(_e,{className:"text-green-800",children:"Posting attendance records to payroll summaries..."})]}),e.jsxs($,{className:"mb-4",children:[e.jsx(et,{className:"pb-3",children:e.jsxs(st,{className:"text-lg flex items-center justify-between",children:[e.jsx("span",{children:"Filters"}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx("span",{children:"Auto-recalculation: Enabled"}),e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]})]})}),e.jsxs(L,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(lt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Search by ID or Name...",className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:S,onChange:s=>ps(s.target.value)})]}),e.jsx("div",{children:e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"date",className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:u,onChange:s=>hs(s.target.value)})]})}),e.jsx("div",{children:e.jsxs("select",{className:"w-full pl-4 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:g,onChange:s=>us(s.target.value),children:[e.jsx("option",{value:"",children:"All Departments"}),xe.map(s=>e.jsx("option",{value:s,children:s},s))]})}),e.jsx("div",{children:e.jsxs("select",{className:"w-full pl-4 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:C,onChange:s=>fs(s.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"posted",children:"Posted"}),e.jsx("option",{value:"not_posted",children:"Not Posted"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500",checked:w,onChange:s=>gs(s.target.checked)}),e.jsx("span",{className:"text-gray-700",children:"Edited Records Only"})]})}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox h-5 w-5 text-red-600 rounded focus:ring-red-500",checked:Z,onChange:s=>ms(s.target.checked)}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(_,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-gray-700",children:"Problems Only"})]})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 mb-4",children:[e.jsx($,{children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(nt,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.length})]})]})})}),e.jsx($,{children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-8 w-8 text-red-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Problem Records"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.filter(s=>{const t=P(s);return t&&t.length>0}).length})]})]})})}),e.jsx($,{children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ls,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Edited Records"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.filter(s=>s.source==="manual_edit").length})]})]})})}),e.jsx($,{children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ns,{className:"h-8 w-8 text-purple-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Night Shifts"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.filter(s=>s.is_nightshift).length})]})]})})}),e.jsx($,{children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Selected"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:b.length})]})]})})}),e.jsx($,{children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(qe,{className:"h-8 w-8 text-purple-500"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Current Page"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[p," of ",j]})]})]})})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow h-[70vh] flex flex-col w-full",children:Te?e.jsxs("div",{className:"flex justify-center items-center h-full",children:[e.jsx(y,{className:"h-8 w-8 animate-spin text-blue-500"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading..."})]}):A.length===0?e.jsxs("div",{className:"text-center py-12 flex-1 flex flex-col justify-center",children:[e.jsx(is,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"No attendance records found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your filters or adding new attendance data."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:e.jsx("div",{className:"overflow-x-auto flex-1",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 h-full",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsx("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-blue-600 rounded focus:ring-blue-500",checked:Ns,onChange:s=>Is(s.target.checked)})}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dept"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time In"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Break Out"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Break In"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time Out"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Late/Under"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Night Shift"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hours"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"OT"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Travel"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SLVL"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CT"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CS"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Holiday"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Offset"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rest Day"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Retro"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(os,{className:"h-4 w-4"}),e.jsx("span",{children:"Trip"})]})}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"OT Reg"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"OT Spl"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Source"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(_,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{children:"DTR Status"})]})}),e.jsx("th",{className:"px-2 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200 overflow-y-auto",children:A.map(s=>e.jsxs("tr",{className:`hover:bg-blue-50 cursor-pointer transition-colors select-none ${s.source==="manual_edit"?"bg-red-50":""} ${js?"bg-blue-100":""} ${(()=>{const t=P(s);return t&&t.length>0?"border-l-4 border-red-400":""})()}`,onMouseDown:t=>Us(t,s),onMouseUp:qs,onMouseLeave:$s,onDoubleClick:t=>Ls(t,s),title:"Hold for 1 second to view details, double-click to edit attendance times",children:[e.jsx("td",{className:"px-2 py-4 whitespace-nowrap",onClick:t=>t.stopPropagation(),children:e.jsx("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-blue-600 rounded focus:ring-blue-500",checked:b.includes(s.id),onChange:t=>Hs(t,s.id)})}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.employee_name||"Unknown Employee"}),e.jsx("div",{className:"text-xs text-gray-500",children:s.idno||"N/A"})]})})}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:s.department||"N/A"}),e.jsxs("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:[Js(s.attendance_date),s.day&&e.jsx("span",{className:"block text-xs mt-1 text-gray-400",children:s.day})]}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:le(s.time_in)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:le(s.break_out)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:le(s.break_in)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:s.is_nightshift&&s.next_day_timeout?le(s.next_day_timeout):le(s.time_out)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap",children:Vs(s)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap",children:Bs(s)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:E(s.hours_worked)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:E(s.overtime)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:E(s.travel_order,1)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:E(s.slvl,1)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:He(s.ct)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:He(s.cs)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:E(s.holiday)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx("div",{className:"flex items-center space-x-1",children:e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${parseFloat(s.offset||0)>0?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-500"}`,children:[E(s.offset)," hrs"]})})}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:s.restday?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:[e.jsx(as,{className:"h-3 w-3 mr-1"}),"Rest Day"]}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-500",children:"Regular"})}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx("div",{className:"flex items-center space-x-1",children:e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${parseFloat(s.retromultiplier||0)>0?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-500"}`,children:["₱",E(s.retromultiplier,2)]})})}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(os,{className:"h-3 w-3 text-blue-500"}),e.jsx("span",{children:E(s.trip,1)})]})}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:E(s.ot_reg_holiday)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-sm text-gray-500",children:E(s.ot_special_holiday)}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap",children:He(s.source,"source")}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap",children:Ks(s)}),e.jsxs("td",{className:"px-2 py-4 whitespace-nowrap relative group",children:[Ts(s),e.jsx("div",{className:"invisible group-hover:visible absolute z-50",children:Cs(s)})]}),e.jsx("td",{className:"px-2 py-4 whitespace-nowrap text-right text-sm font-medium",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex justify-end space-x-1",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),ee(s),fe(!0)},className:"text-blue-600 hover:text-blue-900",type:"button",title:"View Details",children:e.jsx(ot,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:t=>Xs(t,s),disabled:H.current,className:"text-blue-600 hover:text-blue-900 disabled:opacity-50 disabled:cursor-not-allowed",type:"button",title:"Edit Attendance",children:e.jsx(ls,{className:"h-4 w-4"})})]})})]},s.id))})]})})}),e.jsxs("div",{className:"px-6 py-4 flex items-center justify-between border-t border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx(x,{onClick:()=>F(Math.max(1,p-1)),disabled:p===1,variant:"outline",size:"sm",children:"Previous"}),e.jsx(x,{onClick:()=>F(Math.min(j,p+1)),disabled:p===j,variant:"outline",size:"sm",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing page ",e.jsx("span",{className:"font-medium",children:p})," of"," ",e.jsx("span",{className:"font-medium",children:j})]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsx(x,{onClick:()=>F(1),disabled:p===1,variant:"outline",size:"sm",className:"rounded-l-md",children:"First"}),e.jsx(x,{onClick:()=>F(Math.max(1,p-1)),disabled:p===1,variant:"outline",size:"sm",children:"Previous"}),Array.from({length:Math.min(5,j)},(s,t)=>{const r=p<=3?t+1:p>=j-2?j-4+t:p-2+t;return r>0&&r<=j?e.jsx(x,{onClick:()=>F(r),variant:p===r?"default":"outline",size:"sm",className:p===r?"bg-blue-500 text-white":"",children:r},r):null}),e.jsx(x,{onClick:()=>F(Math.min(j,p+1)),disabled:p===j,variant:"outline",size:"sm",children:"Next"}),e.jsx(x,{onClick:()=>F(j),disabled:p===j,variant:"outline",size:"sm",className:"rounded-r-md",children:"Last"})]})})]})]})]})})]})})]}),bs&&D&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"DTR Problems Detection"}),e.jsx("button",{onClick:()=>{Re(!1),Ee([]),Fe(null)},className:"text-gray-500 hover:text-gray-700","aria-label":"Close",children:e.jsx(ne,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(qe,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:D.total_records})]})]})}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-8 w-8 text-red-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Problem Records"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:D.problem_records})]})]})}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Clean Records"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:D.total_records-D.problem_records})]})]})}),e.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ue,{className:"h-8 w-8 text-purple-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[D.total_records>0?Math.round((D.total_records-D.problem_records)/D.total_records*100):0,"%"]})]})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Problem Types Breakdown"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3",children:Object.entries(D.problems).map(([s,t])=>t>0&&e.jsxs("div",{className:"bg-gray-50 border rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 capitalize",children:s.replace(/_/g," ")}),e.jsx("p",{className:"text-lg font-bold text-red-600",children:t})]},s))})]}),Je.length>0?e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Records with Problems"}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Employee"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Severity"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Problems"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Time In/Out"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Hours"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Je.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.employee_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.employee_no})]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-500",children:s.attendance_date}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s.severity==="high"?"bg-red-100 text-red-800":s.severity==="medium"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:s.severity.toUpperCase()})}),e.jsx("td",{className:"px-3 py-4",children:e.jsx("div",{className:"space-y-1",children:s.problems.map((t,r)=>e.jsx("div",{className:"text-xs",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs ${t.severity==="high"?"bg-red-50 text-red-700":t.severity==="medium"?"bg-yellow-50 text-yellow-700":"bg-gray-50 text-gray-700"}`,children:t.message})},r))})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{children:[e.jsxs("div",{children:["In: ",s.time_in||"-"]}),e.jsxs("div",{children:["Out: ",s.time_out||"-"]})]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-500",children:s.hours_worked||"-"})]},s.id))})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"h-12 w-12 mx-auto text-green-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Problems Found!"}),e.jsx("p",{className:"text-gray-500",children:"All DTR records in the current view are clean and valid."})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(x,{onClick:()=>{Re(!1),Ee([]),Fe(null)},className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Close"})})]})]})}),Ve&&ge&&e.jsx(tt,{isOpen:Ve,attendance:ge,onClose:es,onSave:As,onSync:Ms}),Be&&ge&&e.jsx(rt,{isOpen:Be,attendance:ge,onClose:es,onEdit:()=>{fe(!1),se(!0)}}),Ae&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"POST to Payroll"}),e.jsx("button",{onClick:()=>{we(!1),ve(null),l("")},className:"text-gray-500 hover:text-gray-700","aria-label":"Close",disabled:N,children:e.jsx(ne,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[z&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(_,{className:"h-5 w-5 text-red-600 mt-0.5 mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-1 text-sm text-red-700",children:z.split(`
`).map((s,t)=>e.jsx("div",{children:s},t))})]})]})}),W&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(X,{className:"h-5 w-5 text-green-600 mt-0.5 mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-800",children:"Success"}),e.jsx("p",{className:"mt-1 text-sm text-green-700",children:W})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Year *"}),e.jsx("input",{type:"number",min:"2020",max:"2030",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:m.year,onChange:s=>{l(""),re(t=>({...t,year:parseInt(s.target.value)||new Date().getFullYear()}))},disabled:N||ae})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Month *"}),e.jsx("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:m.month,onChange:s=>{l(""),re(t=>({...t,month:parseInt(s.target.value)}))},disabled:N||ae,children:Array.from({length:12},(s,t)=>e.jsx("option",{value:t+1,children:new Date(2024,t,1).toLocaleString("default",{month:"long"})},t+1))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Period *"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:m.period_type,onChange:s=>{l(""),re(t=>({...t,period_type:s.target.value}))},disabled:N||ae,children:[e.jsx("option",{value:"1st_half",children:"1st Half (1-15)"}),e.jsx("option",{value:"2nd_half",children:"2nd Half (16-30/31)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department (Optional)"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:m.department,onChange:s=>{l(""),re(t=>({...t,department:s.target.value}))},disabled:N||ae,children:[e.jsx("option",{value:"",children:"All Departments"}),xe.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]}),ae&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{className:"h-5 w-5 text-blue-600 animate-spin mr-2"}),e.jsx("span",{className:"text-blue-800",children:"Loading preview..."})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t",children:[e.jsx(x,{variant:"outline",onClick:()=>{we(!1),ve(null),l("")},disabled:N,children:"Cancel"}),e.jsx(x,{onClick:Ss,disabled:N||!K||K.totals.employees===0||!m.year||!m.month||!m.period_type,className:"bg-green-600 hover:bg-green-700 text-white",children:N?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-4 w-4 mr-2 animate-spin"}),"Posting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Confirm POST (",K?K.totals.employees:0," employees)"]})})]})]})]})}),vs&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Import Attendance Data"}),e.jsx("button",{onClick:()=>{je(!1),be(null)},className:"text-gray-500 hover:text-gray-700","aria-label":"Close",disabled:G,children:e.jsx(ne,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select CSV File"}),e.jsx("input",{type:"file",accept:".csv,.txt",onChange:s=>be(s.target.files[0]),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:G}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Upload a CSV file with attendance data. Maximum size: 10MB"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Required CSV Format:"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Employee Number, Employee Name, Department, Date, Day, Time In, Break Out, Break In, Time Out, Next Day Timeout, Hours Worked, Night Shift, Trip"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(x,{variant:"outline",onClick:()=>{je(!1),be(null)},disabled:G,children:"Cancel"}),e.jsx(x,{onClick:Es,disabled:G||!Me,className:"bg-indigo-600 hover:bg-indigo-700",children:G?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-4 w-4 mr-2 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Import Data"]})})]})]})]})}),ks&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Set Holiday"}),e.jsx("button",{onClick:()=>{Ne(!1),B({date:"",multiplier:"2.0",department:"",employee_ids:[]})},className:"text-gray-500 hover:text-gray-700","aria-label":"Close",disabled:U,children:e.jsx(ne,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Holiday Date *"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",value:f.date,onChange:s=>B(t=>({...t,date:s.target.value})),disabled:U})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Holiday Multiplier *"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",value:f.multiplier,onChange:s=>B(t=>({...t,multiplier:s.target.value})),disabled:U,children:[e.jsx("option",{value:"1.3",children:"1.3 (Special Holiday)"}),e.jsx("option",{value:"2.0",children:"2.0 (Regular Holiday)"}),e.jsx("option",{value:"2.6",children:"2.6 (Regular Holiday + OT)"}),e.jsx("option",{value:"1.69",children:"1.69 (Special Holiday + OT)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department (Optional)"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",value:f.department,onChange:s=>B(t=>({...t,department:s.target.value})),disabled:U,children:[e.jsx("option",{value:"",children:"All Departments"}),xe.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Leave empty to apply to all departments"})]})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mt-4",children:[e.jsx("h4",{className:"font-medium text-orange-800 mb-2",children:"Note:"}),e.jsx("p",{className:"text-sm text-orange-700",children:"This will set the holiday multiplier for all eligible attendance records on the selected date. Records with existing overtime will be excluded."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx(x,{variant:"outline",onClick:()=>{Ne(!1),B({date:"",multiplier:"2.0",department:"",employee_ids:[]})},disabled:U,children:"Cancel"}),e.jsx(x,{onClick:Fs,disabled:U||!f.date||!f.multiplier,className:"bg-orange-600 hover:bg-orange-700",children:U?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-4 w-4 mr-2 animate-spin"}),"Setting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"Set Holiday"]})})]})]})]})}),ws&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Delete Attendance Records"}),e.jsx("button",{onClick:()=>{te(!1),V({start_date:"",end_date:"",employee_id:"",department:""})},className:"text-gray-500 hover:text-gray-700","aria-label":"Close",disabled:M,children:e.jsx(ne,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"deleteMode",value:"selected",checked:q==="selected",onChange:s=>ye(s.target.value),disabled:M,className:"form-radio h-4 w-4 text-red-600"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-700",children:["Delete Selected (",b.length," records)"]})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"deleteMode",value:"range",checked:q==="range",onChange:s=>ye(s.target.value),disabled:M,className:"form-radio h-4 w-4 text-red-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Delete by Date Range"})]})]})}),q==="range"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date *"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",value:v.start_date,onChange:s=>V(t=>({...t,start_date:s.target.value})),disabled:M})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date *"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",value:v.end_date,onChange:s=>V(t=>({...t,end_date:s.target.value})),disabled:M})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department (Optional)"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",value:v.department,onChange:s=>V(t=>({...t,department:s.target.value})),disabled:M,children:[e.jsx("option",{value:"",children:"All Departments"}),xe.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mt-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(_,{className:"h-5 w-5 text-red-600 mt-0.5 mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-800",children:"Warning"}),e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["This action cannot be undone. ",q==="selected"?`${b.length} selected records will be permanently deleted.`:"All attendance records in the specified date range will be permanently deleted."]})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx(x,{variant:"outline",onClick:()=>{te(!1),V({start_date:"",end_date:"",employee_id:"",department:""})},disabled:M,children:"Cancel"}),e.jsx(x,{onClick:zs,disabled:M||q==="selected"&&b.length===0||q==="range"&&(!v.start_date||!v.end_date),className:"bg-red-600 hover:bg-red-700 text-white",children:M?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Confirm Delete"]})})]})]})]})})]})};export{Qt as default};
