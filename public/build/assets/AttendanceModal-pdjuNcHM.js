import{r as f,j as t}from"./app-7K62fd2B.js";import{B as k}from"./Button-B-ixrUdq.js";import{X as j}from"./x-4sBMcqny.js";import"./clsx-B-dksMZM.js";import"./createLucideIcon-BK5csKvN.js";const v=({isOpen:b,onClose:r,title:l,children:n})=>b?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:d=>d.target===d.currentTarget&&r(),children:t.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full",children:[t.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[t.jsx("h3",{className:"text-lg font-semibold",children:l}),t.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded","aria-label":"Close modal",children:t.jsx(j,{className:"h-5 w-5"})})]}),n]})}):null,o=({label:b,name:r,type:l="text",value:n,onChange:d,disabled:e,className:u="",min:c,max:s})=>t.jsxs("div",{className:u,children:[t.jsx("label",{className:"block text-sm font-medium mb-1",htmlFor:r,children:b}),t.jsx("input",{id:r,type:l,name:r,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:n||"",onChange:d,disabled:e,min:c,max:s})]}),E=({isOpen:b,onClose:r,attendance:l,mode:n="view",onSave:d})=>{const[e,u]=f.useState({id:"",idno:"",employee_id:"",attendance_date:"",time_in:"",break_in:"",break_out:"",time_out:"",is_nightshift:!1,next_day_timeout:"",hours_worked:""}),c=i=>{if(!i)return"";try{const a=new Date(i);return isNaN(a.getTime())?"":a.toISOString().slice(0,16)}catch(a){return console.error("Error formatting datetime:",a),""}};f.useEffect(()=>{var i;if(l){const a=JSON.parse(JSON.stringify(l));u({...a,attendance_date:((i=a.attendance_date)==null?void 0:i.split("T")[0])||"",time_in:c(a.time_in),break_in:c(a.break_in),break_out:c(a.break_out),time_out:c(a.time_out),next_day_timeout:c(a.next_day_timeout),hours_worked:a.hours_worked||""})}},[l]);const s=i=>{const{name:a,value:m,type:x,checked:_}=i.target;u(h=>({...h,[a]:x==="checkbox"?_:m}))},N=()=>{if(!e.time_in)return;let i=e.is_nightshift&&e.next_day_timeout?e.next_day_timeout:e.time_out;if(!i)return;const a=new Date(e.time_in),m=new Date(i);if(isNaN(a.getTime())||isNaN(m.getTime()))return;let x=m-a;if(e.break_in&&e.break_out){const _=new Date(e.break_in),h=new Date(e.break_out);if(!isNaN(_.getTime())&&!isNaN(h.getTime())){const p=h-_;p>0&&(x-=p)}}if(x>0){const _=x/36e5;u(h=>({...h,hours_worked:_.toFixed(2)}))}};f.useEffect(()=>{n==="edit"&&N()},[e.time_in,e.time_out,e.break_in,e.break_out,e.next_day_timeout,e.is_nightshift]);const y=i=>{if(i.preventDefault(),n==="edit"&&d){const a={...e,hours_worked:e.hours_worked?parseFloat(e.hours_worked):null};d(a)}},w=i=>{const a=i.target.checked;u(m=>({...m,is_nightshift:a,next_day_timeout:a?m.next_day_timeout:""}))},g=()=>{if(!e.attendance_date)return"";const i=new Date(e.attendance_date);return i.setDate(i.getDate()+1),i.toISOString().split("T")[0]};return t.jsx(v,{isOpen:b,onClose:r,title:n==="view"?"View Attendance":"Edit Attendance",children:t.jsxs("form",{onSubmit:y,className:"p-4 space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(o,{label:"Employee ID",name:"idno",value:e.idno,onChange:s,disabled:!0,className:"col-span-2"}),t.jsx(o,{label:"Date",name:"attendance_date",type:"date",value:e.attendance_date,onChange:s,disabled:n==="view"}),t.jsxs("div",{className:"flex items-center mt-6",children:[t.jsx("input",{type:"checkbox",name:"is_nightshift",id:"is_nightshift",className:"mr-2 h-4 w-4",checked:e.is_nightshift,onChange:w,disabled:n==="view"}),t.jsx("label",{htmlFor:"is_nightshift",className:"text-sm font-medium",children:"Night Shift"})]}),t.jsx(o,{label:"Time In",name:"time_in",type:"datetime-local",value:e.time_in,onChange:s,disabled:n==="view",className:"col-span-2",min:`${e.attendance_date}T00:00`,max:`${e.attendance_date}T23:59`}),t.jsx(o,{label:"Break In",name:"break_in",type:"datetime-local",value:e.break_in,onChange:s,disabled:n==="view",className:"col-span-2",min:e.time_in||`${e.attendance_date}T00:00`,max:`${e.attendance_date}T23:59`}),t.jsx(o,{label:"Break Out",name:"break_out",type:"datetime-local",value:e.break_out,onChange:s,disabled:n==="view",className:"col-span-2",min:e.break_in||`${e.attendance_date}T00:00`,max:`${e.attendance_date}T23:59`}),t.jsx(o,{label:"Time Out",name:"time_out",type:"datetime-local",value:e.time_out,onChange:s,disabled:n==="view"||e.is_nightshift&&e.next_day_timeout,className:"col-span-2",min:e.break_out||e.time_in||`${e.attendance_date}T00:00`,max:`${e.attendance_date}T23:59`}),e.is_nightshift&&t.jsx(o,{label:"Next Day Timeout",name:"next_day_timeout",type:"datetime-local",value:e.next_day_timeout,onChange:s,disabled:n==="view",className:"col-span-2",min:`${g()}T00:00`,max:`${g()}T23:59`}),t.jsx(o,{label:"Hours Worked",name:"hours_worked",type:"number",value:e.hours_worked,onChange:s,disabled:n==="view",className:"col-span-2",min:"0",step:"0.01"})]}),t.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[t.jsx(k,{variant:"secondary",type:"button",onClick:r,children:"Close"}),n==="edit"&&t.jsx(k,{type:"submit",children:"Save Changes"})]})]})})};export{E as default};
